
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Steel temperature prediction &#8212; Data Science course</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'regression_metallurgy';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Age prediction by photo" href="computer_vision.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
  
    <p class="title logo__title">Data Science course</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Data Science course
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="credit_scoring.html">Credit scoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="real_estate_market_analysis.html">Real estate market analysis in St. Petersburg</a></li>
<li class="toctree-l1"><a class="reference internal" href="tariff_stats.html">Tariff statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="computer_games.html">Analysis of the computer games market</a></li>
<li class="toctree-l1"><a class="reference internal" href="tariff_recommendation.html">Tariff recommendation</a></li>
<li class="toctree-l1"><a class="reference internal" href="supervised_classification.html">Customer churn</a></li>
<li class="toctree-l1"><a class="reference internal" href="oil_bootstrap.html">Selection of a location for a well</a></li>
<li class="toctree-l1"><a class="reference internal" href="gold_recovery.html">Gold recovery</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_transformation.html">Protection of customers’ personal data</a></li>

<li class="toctree-l1"><a class="reference internal" href="cars_boosting.html">Cars cost determination</a></li>
<li class="toctree-l1"><a class="reference internal" href="taxi_time_series.html">Taxi orders prediction</a></li>
<li class="toctree-l1"><a class="reference internal" href="text_classification.html">Classification of comments</a></li>
<li class="toctree-l1"><a class="reference internal" href="computer_vision.html">Age prediction by photo</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Steel temperature prediction</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/regression_metallurgy.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Steel temperature prediction</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#steel-treatment-process">Steel treatment process</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-description">Data description</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exploratory-data-analysis">Exploratory data analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#electrode-data">Electrode data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bulk-material-feed-data-volume">Bulk material feed data (volume)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bulk-material-feed-data-time">Bulk material feed data (time)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#alloy-gas-purge-data">Alloy gas purge data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#temperature-measurement-results">Temperature measurement results</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#wire-materials-data-volume">Wire materials data (volume)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#wire-materials-data-time">Wire materials data (time)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plan">Plan</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preprocessing">Data preprocessing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-types">Data Types</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#missing-values">Missing values</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#duplicates">Duplicates</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#anomalies">Anomalies</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-creation">Feature creation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-study">Feature study</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#work">Work</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#treatment-time">Treatment time</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#starting-temperature">Starting temperature</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#correlation">Correlation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#samples">Samples</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#outliers">Outliers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#scaling">Scaling</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#training">Training</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-regression">Linear regression</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#elastic-net">Elastic Net</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#random-forest">Random Forest</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#catboost">CatBoost</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lightgbm">LightGBM</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#results">Results</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sanity-check">Sanity check</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-of-the-feature-significance">Analysis of the feature significance</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing">Testing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusions">Conclusions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#report">Report</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="steel-temperature-prediction">
<h1>Steel temperature prediction<a class="headerlink" href="#steel-temperature-prediction" title="Link to this heading">#</a></h1>
<p>In order to optimize production costs, a steel mill has decided to reduce power consumption at the steel processing stage.</p>
<p>It is required to build a model that predicts the temperature of the steel. This will reduce electrical and maintenance costs.
The model should predict temperature with an error of less than 6.8 degrees (<strong>MAE&lt; 6.8</strong>).</p>
<section id="steel-treatment-process">
<h2>Steel treatment process<a class="headerlink" href="#steel-treatment-process" title="Link to this heading">#</a></h2>
<p>To improve the quality of steel, this steel mill performs an out-of-furnace steel treatment.</p>
<p>Steel is treated in a ladle furnace with a capacity of about 100 tons. To ensure that the metal ladle can withstand high temperatures, it is lined with fire bricks on the inside. The molten steel is poured into the ladle and heated to the required temperature using graphite electrodes. They are installed in the ladle lid.</p>
<p>Sulphur is removed from the alloy (desulphurization), the chemical composition is adjusted by adding impurities, and samples are taken. Steel is alloyed — its composition is changed — by feeding pieces of alloy from a bulk hopper or wire through a special wire feeding machine.</p>
<p>Before adding alloying agents for the first time, the temperature of the steel is measured. It is also chemically analyzed. Then the temperature is raised for a few minutes, alloying materials are added and the alloy is purged with inert gas. The alloy is then stirred and measured again. This cycle is repeated until the target chemical composition and optimum melting temperature are achieved.</p>
<p>The molten steel is then sent for metal finishing or fed into a continuous casting machine. From there, the finished product comes out in the form of slabs.</p>
</section>
<section id="data-description">
<h2>Data description<a class="headerlink" href="#data-description" title="Link to this heading">#</a></h2>
<p>The data consists of files obtained from different sources:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">data_arc_new.csv</span></code> — electrode data;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data_bulk_new.csv</span></code> — bulk material feed data (volume);</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data_bulk_time_new.csv</span></code> — bulk material feeding data (time);</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data_gas_new.csv</span></code> — data on gas purging of the alloy;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data_temp_new.csv</span></code> — temperature measurement results;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data_wire_new.csv</span></code> — data on wire materials (volume);</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data_wire_time_new.csv</span></code> — data on wire materials (time).</p></li>
</ul>
<p>In all files, the <code class="docutils literal notranslate"><span class="pre">key</span></code> column contains the batch number. There may be several lines in the files with the same <code class="docutils literal notranslate"><span class="pre">key</span></code> value: they correspond to different treatment iterations.</p>
</section>
<section id="exploratory-data-analysis">
<h2>Exploratory data analysis<a class="headerlink" href="#exploratory-data-analysis" title="Link to this heading">#</a></h2>
<p>Let’s have a look at the data and identify the attributes that affect the temperature of steel.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">catboost</span>
<span class="kn">import</span> <span class="nn">lightgbm</span> <span class="k">as</span> <span class="nn">lgb</span>

<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span> 
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span> <span class="k">as</span> <span class="n">mae</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span><span class="p">,</span> <span class="n">cross_val_score</span><span class="p">,</span> <span class="n">KFold</span><span class="p">,</span> <span class="n">cross_val_score</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span><span class="p">,</span> <span class="n">RandomizedSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.utils._testing</span> <span class="kn">import</span> <span class="n">ignore_warnings</span>
<span class="kn">from</span> <span class="nn">sklearn.exceptions</span> <span class="kn">import</span> <span class="n">ConvergenceWarning</span>

<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span><span class="p">,</span> <span class="n">ElasticNet</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span> 
<span class="kn">from</span> <span class="nn">sklearn.dummy</span> <span class="kn">import</span> <span class="n">DummyRegressor</span>
<span class="kn">from</span> <span class="nn">catboost</span> <span class="kn">import</span> <span class="n">CatBoostRegressor</span><span class="p">,</span> <span class="n">Pool</span><span class="p">,</span> <span class="n">cv</span>

<span class="kn">from</span> <span class="nn">tensorflow.keras.optimizers</span> <span class="kn">import</span> <span class="n">Adam</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.models</span> <span class="kn">import</span> <span class="n">Sequential</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.applications.resnet</span> <span class="kn">import</span> <span class="n">ResNet50</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">GlobalAveragePooling2D</span><span class="p">,</span> <span class="n">Dense</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">data_arc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data_arc_new.csv&#39;</span><span class="p">)</span>
    <span class="n">data_bulk</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data_bulk_new.csv&#39;</span><span class="p">)</span>
    <span class="n">data_bulk_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data_bulk_time_new.csv&#39;</span><span class="p">)</span>
    <span class="n">data_gas</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data_gas_new.csv&#39;</span><span class="p">)</span>
    <span class="n">data_temp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data_temp_new.csv&#39;</span><span class="p">)</span>
    <span class="n">data_wire</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data_wire_new.csv&#39;</span><span class="p">)</span>
    <span class="n">data_wire_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data_wire_time_new.csv&#39;</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">data_arc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/datasets/data_arc_new.csv&#39;</span><span class="p">)</span>
    <span class="n">data_bulk</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/datasets/data_bulk_new.csv&#39;</span><span class="p">)</span>
    <span class="n">data_bulk_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/datasets/data_bulk_time_new.csv&#39;</span><span class="p">)</span>
    <span class="n">data_gas</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/datasets/data_gas_new.csv&#39;</span><span class="p">)</span>
    <span class="n">data_temp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/datasets/data_temp_new.csv&#39;</span><span class="p">)</span>
    <span class="n">data_wire</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/datasets/data_wire_new.csv&#39;</span><span class="p">)</span>
    <span class="n">data_wire_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/datasets/data_wire_time_new.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="electrode-data">
<h3>Electrode data<a class="headerlink" href="#electrode-data" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_arc</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key</th>
      <th>Start of arc heating</th>
      <th>End of arc heating</th>
      <th>Active power</th>
      <th>Reactive power</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>2019-05-03 11:02:14</td>
      <td>2019-05-03 11:06:02</td>
      <td>0.305130</td>
      <td>0.211253</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>2019-05-03 11:07:28</td>
      <td>2019-05-03 11:10:33</td>
      <td>0.765658</td>
      <td>0.477438</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>2019-05-03 11:11:44</td>
      <td>2019-05-03 11:14:36</td>
      <td>0.580313</td>
      <td>0.430460</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>2019-05-03 11:18:14</td>
      <td>2019-05-03 11:24:19</td>
      <td>0.518496</td>
      <td>0.379979</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>2019-05-03 11:26:09</td>
      <td>2019-05-03 11:28:37</td>
      <td>0.867133</td>
      <td>0.643691</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_arc</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 14876 entries, 0 to 14875
Data columns (total 5 columns):
 #   Column                Non-Null Count  Dtype  
---  ------                --------------  -----  
 0   key                   14876 non-null  int64  
 1   Start of arc heating  14876 non-null  object 
 2   End of arc heating    14876 non-null  object 
 3   Active power          14876 non-null  float64
 4   Reactive power        14876 non-null  float64
dtypes: float64(2), int64(1), object(2)
memory usage: 581.2+ KB
</pre></div>
</div>
</div>
</div>
<p>There are no missing values, dates are represented by strings.
Let’s look at the dataframe statistics.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_arc</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key</th>
      <th>Active power</th>
      <th>Reactive power</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>14876.000000</td>
      <td>14876.000000</td>
      <td>14876.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>1615.220422</td>
      <td>0.662752</td>
      <td>0.438986</td>
    </tr>
    <tr>
      <th>std</th>
      <td>934.571502</td>
      <td>0.258885</td>
      <td>5.873485</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.000000</td>
      <td>0.223120</td>
      <td>-715.479924</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>806.000000</td>
      <td>0.467115</td>
      <td>0.337175</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>1617.000000</td>
      <td>0.599587</td>
      <td>0.441639</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>2429.000000</td>
      <td>0.830070</td>
      <td>0.608201</td>
    </tr>
    <tr>
      <th>max</th>
      <td>3241.000000</td>
      <td>1.463773</td>
      <td>1.270284</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>There are negative values in the reactive power numbers. This may be the reason why the dispersion of this parameter is higher.</p>
<p>The period for which data are available.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;First date:&#39;</span><span class="p">,</span> <span class="n">data_arc</span><span class="p">[</span><span class="s1">&#39;Start of arc heating&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Last date:&#39;</span><span class="p">,</span> <span class="n">data_arc</span><span class="p">[</span><span class="s1">&#39;End of arc heating&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>First date: 2019-05-03 11:02:14
Last date: 2019-09-06 17:26:15
</pre></div>
</div>
</div>
</div>
<p>Apparently, the May through September 2019 interval is covered.</p>
<p>Let’s see how many arc heatings are averaged per ladle.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_arc</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2108    16
1689    15
1513    15
2567    14
46      13
        ..
977      1
247      1
2582     1
248      1
530      1
Name: key, Length: 3214, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_arc</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribution of the number of arc heatings&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Number of arc heatings&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Number of batches&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/228a03a5c05ac3c827914b3da88853ab83812c30b14907247485b576c737bd75.png" src="_images/228a03a5c05ac3c827914b3da88853ab83812c30b14907247485b576c737bd75.png" />
</div>
</div>
<p>On average about 4 times, although there have been some that have been heated 16 times.</p>
<p>Let’s estimate the number of negative reactive power values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_arc</span><span class="p">[</span><span class="n">data_arc</span><span class="p">[</span><span class="s1">&#39;Reactive power&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key</th>
      <th>Start of arc heating</th>
      <th>End of arc heating</th>
      <th>Active power</th>
      <th>Reactive power</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>9780</th>
      <td>2116</td>
      <td>2019-07-28 02:22:08</td>
      <td>2019-07-28 02:23:57</td>
      <td>0.705344</td>
      <td>-715.479924</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>One single line. Let’s look at all the data on this ladle.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_arc</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;key == 2116&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key</th>
      <th>Start of arc heating</th>
      <th>End of arc heating</th>
      <th>Active power</th>
      <th>Reactive power</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>9778</th>
      <td>2116</td>
      <td>2019-07-28 02:07:12</td>
      <td>2019-07-28 02:09:14</td>
      <td>0.787549</td>
      <td>0.693881</td>
    </tr>
    <tr>
      <th>9779</th>
      <td>2116</td>
      <td>2019-07-28 02:13:10</td>
      <td>2019-07-28 02:15:25</td>
      <td>0.580263</td>
      <td>0.411498</td>
    </tr>
    <tr>
      <th>9780</th>
      <td>2116</td>
      <td>2019-07-28 02:22:08</td>
      <td>2019-07-28 02:23:57</td>
      <td>0.705344</td>
      <td>-715.479924</td>
    </tr>
    <tr>
      <th>9781</th>
      <td>2116</td>
      <td>2019-07-28 02:29:11</td>
      <td>2019-07-28 02:30:18</td>
      <td>0.563641</td>
      <td>0.408513</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let’s get rid of the entire series at the preprocessing stage. Even one abnormal value casts doubt on the rest of the measurements.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_arc_pos</span> <span class="o">=</span> <span class="n">data_arc</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">data_arc</span><span class="p">[</span><span class="n">data_arc</span><span class="p">[</span><span class="s1">&#39;Reactive power&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">data_arc_pos</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key</th>
      <th>Start of arc heating</th>
      <th>End of arc heating</th>
      <th>Active power</th>
      <th>Reactive power</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>2019-05-03 11:02:14</td>
      <td>2019-05-03 11:06:02</td>
      <td>0.305130</td>
      <td>0.211253</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>2019-05-03 11:07:28</td>
      <td>2019-05-03 11:10:33</td>
      <td>0.765658</td>
      <td>0.477438</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>2019-05-03 11:11:44</td>
      <td>2019-05-03 11:14:36</td>
      <td>0.580313</td>
      <td>0.430460</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>2019-05-03 11:18:14</td>
      <td>2019-05-03 11:24:19</td>
      <td>0.518496</td>
      <td>0.379979</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>2019-05-03 11:26:09</td>
      <td>2019-05-03 11:28:37</td>
      <td>0.867133</td>
      <td>0.643691</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let’s estimate the correlation between active and reactive powers:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_arc</span><span class="p">[</span><span class="s1">&#39;Active power&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">data_arc</span><span class="p">[</span><span class="s1">&#39;Reactive power&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.031164148606199774
</pre></div>
</div>
</div>
</div>
<p>Если без выброса:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_arc_pos</span><span class="p">[</span><span class="s1">&#39;Active power&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">data_arc_pos</span><span class="p">[</span><span class="s1">&#39;Reactive power&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.9663734456187298
</pre></div>
</div>
</div>
</div>
<p>Это больше похоже на правду. Убедимся на графике:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_arc_pos</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Active power&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Reactive power&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Power distribution for all arc heatings&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/leonid/anaconda3/envs/practicum/lib/python3.9/site-packages/pandas/plotting/_matplotlib/core.py:1041: UserWarning: No data for colormapping provided via &#39;c&#39;. Parameters &#39;cmap&#39; will be ignored
  scatter = ax.scatter(
</pre></div>
</div>
<img alt="_images/d1f4a19479c344fcb772e2898f21f63c7f7d424747f40be72e1d24cdd0ff2235.png" src="_images/d1f4a19479c344fcb772e2898f21f63c7f7d424747f40be72e1d24cdd0ff2235.png" />
</div>
</div>
<p>Here is the coefficient.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data_arc_pos</span><span class="p">[</span><span class="s1">&#39;Active power&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> 
          <span class="n">data_arc_pos</span><span class="p">[</span><span class="s1">&#39;Reactive power&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">coef_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0.73762827]])
</pre></div>
</div>
</div>
</div>
<p>It may be better to take only one of these two features for training.</p>
<p>For each ladle, we will also calculate the total heating time and the total time from the start of heating to the end.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_arc</span><span class="p">[</span><span class="s1">&#39;Heating time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data_arc</span><span class="p">[</span><span class="s1">&#39;End of arc heating&#39;</span><span class="p">])</span> <span class="o">-</span> 
                             <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data_arc</span><span class="p">[</span><span class="s1">&#39;Start of arc heating&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
<span class="n">data_arc</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key</th>
      <th>Start of arc heating</th>
      <th>End of arc heating</th>
      <th>Active power</th>
      <th>Reactive power</th>
      <th>Heating time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>2019-05-03 11:02:14</td>
      <td>2019-05-03 11:06:02</td>
      <td>0.305130</td>
      <td>0.211253</td>
      <td>228.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>2019-05-03 11:07:28</td>
      <td>2019-05-03 11:10:33</td>
      <td>0.765658</td>
      <td>0.477438</td>
      <td>185.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>2019-05-03 11:11:44</td>
      <td>2019-05-03 11:14:36</td>
      <td>0.580313</td>
      <td>0.430460</td>
      <td>172.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>2019-05-03 11:18:14</td>
      <td>2019-05-03 11:24:19</td>
      <td>0.518496</td>
      <td>0.379979</td>
      <td>365.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>2019-05-03 11:26:09</td>
      <td>2019-05-03 11:28:37</td>
      <td>0.867133</td>
      <td>0.643691</td>
      <td>148.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_arc_stat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">data_arc</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;Heating time&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">)</span>
<span class="n">data_arc_stat</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Heating time</th>
    </tr>
    <tr>
      <th>key</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>1098.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>811.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>655.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>741.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>869.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Note that there are gaps in the key numbers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_arc_stat</span><span class="o">.</span><span class="n">index</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data_arc_stat</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
41
42
195
279
355
382
506
529
540
607
683
710
766
1133
1300
1437
2031
2103
2278
2356
2373
2446
2469
2491
2683
3200
3207
</pre></div>
</div>
</div>
</div>
<p>Although it’s hardly significant.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_arc_stat</span><span class="p">[</span><span class="s1">&#39;Treatment time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
    <span class="n">data_arc</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;End of arc heating&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">)[</span><span class="s1">&#39;End of arc heating&#39;</span><span class="p">])</span> <span class="o">-</span> 
                                    <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
    <span class="n">data_arc</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;Start of arc heating&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">)[</span><span class="s1">&#39;Start of arc heating&#39;</span><span class="p">])</span>
                                   <span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
<span class="n">data_arc_stat</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Heating time</th>
      <th>Treatment time</th>
    </tr>
    <tr>
      <th>key</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>1098.0</td>
      <td>1583.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>811.0</td>
      <td>1144.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>655.0</td>
      <td>1525.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>741.0</td>
      <td>1093.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>869.0</td>
      <td>1362.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We can also calculate work from the power and time. This physical quantity can possibly have a more direct link to the temperature.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_arc</span><span class="p">[</span><span class="s1">&#39;Total power&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_arc</span><span class="p">[</span><span class="s1">&#39;Active power&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">data_arc</span><span class="p">[</span><span class="s1">&#39;Reactive power&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
<span class="n">data_arc</span><span class="p">[</span><span class="s1">&#39;Work&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_arc</span><span class="p">[</span><span class="s1">&#39;Total power&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">data_arc</span><span class="p">[</span><span class="s1">&#39;Heating time&#39;</span><span class="p">]</span>
<span class="n">data_arc</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key</th>
      <th>Start of arc heating</th>
      <th>End of arc heating</th>
      <th>Active power</th>
      <th>Reactive power</th>
      <th>Heating time</th>
      <th>Total power</th>
      <th>Work</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>2019-05-03 11:02:14</td>
      <td>2019-05-03 11:06:02</td>
      <td>0.305130</td>
      <td>0.211253</td>
      <td>228.0</td>
      <td>0.371123</td>
      <td>84.616003</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>2019-05-03 11:07:28</td>
      <td>2019-05-03 11:10:33</td>
      <td>0.765658</td>
      <td>0.477438</td>
      <td>185.0</td>
      <td>0.902319</td>
      <td>166.928978</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>2019-05-03 11:11:44</td>
      <td>2019-05-03 11:14:36</td>
      <td>0.580313</td>
      <td>0.430460</td>
      <td>172.0</td>
      <td>0.722536</td>
      <td>124.276277</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>2019-05-03 11:18:14</td>
      <td>2019-05-03 11:24:19</td>
      <td>0.518496</td>
      <td>0.379979</td>
      <td>365.0</td>
      <td>0.642824</td>
      <td>234.630603</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>2019-05-03 11:26:09</td>
      <td>2019-05-03 11:28:37</td>
      <td>0.867133</td>
      <td>0.643691</td>
      <td>148.0</td>
      <td>1.079934</td>
      <td>159.830252</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Seems like work reflects the consumed energy better. Let’s take it instead of active power and heating time.</p>
<p>The anomaly in reactive power has not gone anywhere and this batch will have to be weeded out before getting the samples.</p>
<p>Besides that, these features can be taken for training after preprocessing the data.</p>
<p><strong>Summary</strong></p>
<ul class="simple">
<li><p>The data covers the period from May through September 2019.</p></li>
<li><p>Most batches were heated between 2 and 8 times.</p></li>
<li><p>The active and reactive power data correlate with each other. It makes sense to keep only one of them.</p></li>
<li><p>There are 27 gaps in the batch numbering. It’s not important for training.</p></li>
<li><p>There is one anomaly in the reactive power data. The batch with this anomaly will be excluded at the preprocessing stage.</p></li>
<li><p>Two new features have been created: total batch heating time and total batch treatment time. The latter includes the former, but is more reflective of the effect of metal cooling over time, so it will be taken for the training.</p></li>
<li><p>Instead of power and total batch heating time, a feature of total work was calculated and will be taken for training.</p></li>
</ul>
</section>
<section id="bulk-material-feed-data-volume">
<h3>Bulk material feed data (volume)<a class="headerlink" href="#bulk-material-feed-data-volume" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_bulk</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key</th>
      <th>Bulk 1</th>
      <th>Bulk 2</th>
      <th>Bulk 3</th>
      <th>Bulk 4</th>
      <th>Bulk 5</th>
      <th>Bulk 6</th>
      <th>Bulk 7</th>
      <th>Bulk 8</th>
      <th>Bulk 9</th>
      <th>Bulk 10</th>
      <th>Bulk 11</th>
      <th>Bulk 12</th>
      <th>Bulk 13</th>
      <th>Bulk 14</th>
      <th>Bulk 15</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>43.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>206.0</td>
      <td>NaN</td>
      <td>150.0</td>
      <td>154.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>73.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>206.0</td>
      <td>NaN</td>
      <td>149.0</td>
      <td>154.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>34.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>205.0</td>
      <td>NaN</td>
      <td>152.0</td>
      <td>153.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>81.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>207.0</td>
      <td>NaN</td>
      <td>153.0</td>
      <td>154.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>78.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>203.0</td>
      <td>NaN</td>
      <td>151.0</td>
      <td>152.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Apparently not all types of bulk solids are fed at one time.<br />
I assume the units of measure are liters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_bulk</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 3129 entries, 0 to 3128
Data columns (total 16 columns):
 #   Column   Non-Null Count  Dtype  
---  ------   --------------  -----  
 0   key      3129 non-null   int64  
 1   Bulk 1   252 non-null    float64
 2   Bulk 2   22 non-null     float64
 3   Bulk 3   1298 non-null   float64
 4   Bulk 4   1014 non-null   float64
 5   Bulk 5   77 non-null     float64
 6   Bulk 6   576 non-null    float64
 7   Bulk 7   25 non-null     float64
 8   Bulk 8   1 non-null      float64
 9   Bulk 9   19 non-null     float64
 10  Bulk 10  176 non-null    float64
 11  Bulk 11  177 non-null    float64
 12  Bulk 12  2450 non-null   float64
 13  Bulk 13  18 non-null     float64
 14  Bulk 14  2806 non-null   float64
 15  Bulk 15  2248 non-null   float64
dtypes: float64(15), int64(1)
memory usage: 391.2 KB
</pre></div>
</div>
</div>
</div>
<p>A lot of missing values are present. In our case they can be replaced by zeros without affecting the model training.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_bulk</span><span class="p">[</span><span class="o">~</span><span class="n">data_bulk</span><span class="p">[</span><span class="s1">&#39;Bulk 8&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key</th>
      <th>Bulk 1</th>
      <th>Bulk 2</th>
      <th>Bulk 3</th>
      <th>Bulk 4</th>
      <th>Bulk 5</th>
      <th>Bulk 6</th>
      <th>Bulk 7</th>
      <th>Bulk 8</th>
      <th>Bulk 9</th>
      <th>Bulk 10</th>
      <th>Bulk 11</th>
      <th>Bulk 12</th>
      <th>Bulk 13</th>
      <th>Bulk 14</th>
      <th>Bulk 15</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1725</th>
      <td>1786</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>123.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>49.0</td>
      <td>147.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>For some bulk materials the data is clearly insufficient.
For training and testing, we will take those that are more than 500. It will be necessary to warn the customer that the rest are not included in the calculation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_bulk</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key</th>
      <th>Bulk 1</th>
      <th>Bulk 2</th>
      <th>Bulk 3</th>
      <th>Bulk 4</th>
      <th>Bulk 5</th>
      <th>Bulk 6</th>
      <th>Bulk 7</th>
      <th>Bulk 8</th>
      <th>Bulk 9</th>
      <th>Bulk 10</th>
      <th>Bulk 11</th>
      <th>Bulk 12</th>
      <th>Bulk 13</th>
      <th>Bulk 14</th>
      <th>Bulk 15</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>3129.0</td>
      <td>252.0</td>
      <td>22.0</td>
      <td>1298.0</td>
      <td>1014.0</td>
      <td>77.0</td>
      <td>576.0</td>
      <td>25.0</td>
      <td>1.0</td>
      <td>19.0</td>
      <td>176.0</td>
      <td>177.0</td>
      <td>2450.0</td>
      <td>18.0</td>
      <td>2806.0</td>
      <td>2248.0</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>1624.0</td>
      <td>39.0</td>
      <td>253.0</td>
      <td>114.0</td>
      <td>104.0</td>
      <td>107.0</td>
      <td>119.0</td>
      <td>306.0</td>
      <td>49.0</td>
      <td>76.0</td>
      <td>83.0</td>
      <td>77.0</td>
      <td>260.0</td>
      <td>181.0</td>
      <td>170.0</td>
      <td>161.0</td>
    </tr>
    <tr>
      <th>std</th>
      <td>933.0</td>
      <td>18.0</td>
      <td>21.0</td>
      <td>75.0</td>
      <td>48.0</td>
      <td>82.0</td>
      <td>72.0</td>
      <td>191.0</td>
      <td>NaN</td>
      <td>22.0</td>
      <td>26.0</td>
      <td>60.0</td>
      <td>121.0</td>
      <td>46.0</td>
      <td>66.0</td>
      <td>52.0</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.0</td>
      <td>10.0</td>
      <td>228.0</td>
      <td>6.0</td>
      <td>12.0</td>
      <td>11.0</td>
      <td>17.0</td>
      <td>47.0</td>
      <td>49.0</td>
      <td>63.0</td>
      <td>24.0</td>
      <td>8.0</td>
      <td>53.0</td>
      <td>151.0</td>
      <td>16.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>816.0</td>
      <td>27.0</td>
      <td>242.0</td>
      <td>58.0</td>
      <td>72.0</td>
      <td>70.0</td>
      <td>70.0</td>
      <td>155.0</td>
      <td>49.0</td>
      <td>66.0</td>
      <td>64.0</td>
      <td>25.0</td>
      <td>204.0</td>
      <td>153.0</td>
      <td>119.0</td>
      <td>105.0</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>1622.0</td>
      <td>31.0</td>
      <td>252.0</td>
      <td>98.0</td>
      <td>102.0</td>
      <td>86.0</td>
      <td>100.0</td>
      <td>298.0</td>
      <td>49.0</td>
      <td>68.0</td>
      <td>86.0</td>
      <td>64.0</td>
      <td>208.0</td>
      <td>156.0</td>
      <td>151.0</td>
      <td>160.0</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>2431.0</td>
      <td>46.0</td>
      <td>258.0</td>
      <td>152.0</td>
      <td>133.0</td>
      <td>132.0</td>
      <td>157.0</td>
      <td>406.0</td>
      <td>49.0</td>
      <td>70.0</td>
      <td>102.0</td>
      <td>106.0</td>
      <td>316.0</td>
      <td>204.0</td>
      <td>206.0</td>
      <td>205.0</td>
    </tr>
    <tr>
      <th>max</th>
      <td>3241.0</td>
      <td>185.0</td>
      <td>325.0</td>
      <td>454.0</td>
      <td>281.0</td>
      <td>603.0</td>
      <td>503.0</td>
      <td>772.0</td>
      <td>49.0</td>
      <td>147.0</td>
      <td>159.0</td>
      <td>313.0</td>
      <td>1849.0</td>
      <td>305.0</td>
      <td>636.0</td>
      <td>405.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The mean values do not differ very much. Although 1849 liters are out of the general picture.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data_bulk</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Bulk material volume distribution&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Additive&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Volume&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">())):</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">tick</span><span class="p">,</span> <span class="o">-</span><span class="mi">60</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">data_bulk</span><span class="p">[</span><span class="s1">&#39;Bulk &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tick</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()),</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0d110b6c1eb05f550cde340539476dcf7b63787e4e174db46d935cf8a28fbf7a.png" src="_images/0d110b6c1eb05f550cde340539476dcf7b63787e4e174db46d935cf8a28fbf7a.png" />
</div>
</div>
<p>Without the outlier:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">fig</span> <span class="o">=</span> <span class="p">(</span><span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data_bulk</span>
                  <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;`Bulk 12` &lt; 1849 | `Bulk 12`.isnull()&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;python&#39;</span><span class="p">)</span>
                  <span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;key&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Bulk material volume distribution&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Additive&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Volume&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">())):</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">tick</span><span class="p">,</span> <span class="o">-</span><span class="mi">25</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">data_bulk</span><span class="p">[</span><span class="s1">&#39;Bulk &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tick</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()),</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/422988c8c8b47ff4a861fd15e929eff3495573d568c30397d4706440573039ce.png" src="_images/422988c8c8b47ff4a861fd15e929eff3495573d568c30397d4706440573039ce.png" />
</div>
</div>
<p>Those that have been added to more than 500 batches are distributed quite standardly. Although the number of outliers is different everywhere.
The only thing that catches my eye is the proximity of the first and second quartiles for Bulk 12. Apparently, about 200 liters are added quite often.</p>
<p><strong>Summary</strong></p>
<ul class="simple">
<li><p>The data reflect the addition of 15 types of bulk materials.</p></li>
<li><p>Gaps in the data can be replaced with zeros.</p></li>
<li><p>Additives are used unevenly. Some have been used only a few times.</p></li>
<li><p>For training and testing, we will take those that have been added more than 500 times. With scaling.</p></li>
<li><p>Let’s remove outliers in the training sample.</p></li>
</ul>
</section>
<section id="bulk-material-feed-data-time">
<h3>Bulk material feed data (time)<a class="headerlink" href="#bulk-material-feed-data-time" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_bulk_time</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key</th>
      <th>Bulk 1</th>
      <th>Bulk 2</th>
      <th>Bulk 3</th>
      <th>Bulk 4</th>
      <th>Bulk 5</th>
      <th>Bulk 6</th>
      <th>Bulk 7</th>
      <th>Bulk 8</th>
      <th>Bulk 9</th>
      <th>Bulk 10</th>
      <th>Bulk 11</th>
      <th>Bulk 12</th>
      <th>Bulk 13</th>
      <th>Bulk 14</th>
      <th>Bulk 15</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2019-05-03 11:28:48</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2019-05-03 11:24:31</td>
      <td>NaN</td>
      <td>2019-05-03 11:14:50</td>
      <td>2019-05-03 11:10:43</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2019-05-03 11:36:50</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2019-05-03 11:53:30</td>
      <td>NaN</td>
      <td>2019-05-03 11:48:37</td>
      <td>2019-05-03 11:44:39</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2019-05-03 12:32:39</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2019-05-03 12:27:13</td>
      <td>NaN</td>
      <td>2019-05-03 12:21:01</td>
      <td>2019-05-03 12:16:16</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2019-05-03 12:43:22</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2019-05-03 12:58:00</td>
      <td>NaN</td>
      <td>2019-05-03 12:51:11</td>
      <td>2019-05-03 12:46:36</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2019-05-03 13:30:47</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2019-05-03 13:30:47</td>
      <td>NaN</td>
      <td>2019-05-03 13:34:12</td>
      <td>2019-05-03 13:30:47</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_bulk_time</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 3129 entries, 0 to 3128
Data columns (total 16 columns):
 #   Column   Non-Null Count  Dtype 
---  ------   --------------  ----- 
 0   key      3129 non-null   int64 
 1   Bulk 1   252 non-null    object
 2   Bulk 2   22 non-null     object
 3   Bulk 3   1298 non-null   object
 4   Bulk 4   1014 non-null   object
 5   Bulk 5   77 non-null     object
 6   Bulk 6   576 non-null    object
 7   Bulk 7   25 non-null     object
 8   Bulk 8   1 non-null      object
 9   Bulk 9   19 non-null     object
 10  Bulk 10  176 non-null    object
 11  Bulk 11  177 non-null    object
 12  Bulk 12  2450 non-null   object
 13  Bulk 13  18 non-null     object
 14  Bulk 14  2806 non-null   object
 15  Bulk 15  2248 non-null   object
dtypes: int64(1), object(15)
memory usage: 391.2+ KB
</pre></div>
</div>
</div>
</div>
<p>Apparently, there is a full match with the volume data.<br />
Let’s look at the periods when different types of bulk materials were added. And count the number of additions by week.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_bulk_time_weeks</span> <span class="o">=</span> <span class="n">data_bulk_time</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">data_bulk_time_weeks</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_bulk_time_weeks</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data_bulk_time_weeks</span>
                   <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                   <span class="o">.</span><span class="n">stack</span><span class="p">())</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;datetime64[W]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unstack</span><span class="p">())</span>
<span class="n">data_bulk_time_weeks</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key</th>
      <th>Bulk 1</th>
      <th>Bulk 2</th>
      <th>Bulk 3</th>
      <th>Bulk 4</th>
      <th>Bulk 5</th>
      <th>Bulk 6</th>
      <th>Bulk 7</th>
      <th>Bulk 8</th>
      <th>Bulk 9</th>
      <th>Bulk 10</th>
      <th>Bulk 11</th>
      <th>Bulk 12</th>
      <th>Bulk 13</th>
      <th>Bulk 14</th>
      <th>Bulk 15</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>2019-05-02</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>2019-05-02</td>
      <td>NaT</td>
      <td>2019-05-02</td>
      <td>2019-05-02</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>2019-05-02</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>2019-05-02</td>
      <td>NaT</td>
      <td>2019-05-02</td>
      <td>2019-05-02</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>2019-05-02</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>2019-05-02</td>
      <td>NaT</td>
      <td>2019-05-02</td>
      <td>2019-05-02</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>2019-05-02</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>2019-05-02</td>
      <td>NaT</td>
      <td>2019-05-02</td>
      <td>2019-05-02</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>2019-05-02</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>2019-05-02</td>
      <td>NaT</td>
      <td>2019-05-02</td>
      <td>2019-05-02</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Посчитаем количество партий для каждой недели.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_bulk_time_stat</span> <span class="o">=</span> <span class="n">data_bulk_time_weeks</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">value_counts</span><span class="p">)</span>
<span class="n">data_bulk_time_stat</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Bulk 1</th>
      <th>Bulk 2</th>
      <th>Bulk 3</th>
      <th>Bulk 4</th>
      <th>Bulk 5</th>
      <th>Bulk 6</th>
      <th>Bulk 7</th>
      <th>Bulk 8</th>
      <th>Bulk 9</th>
      <th>Bulk 10</th>
      <th>Bulk 11</th>
      <th>Bulk 12</th>
      <th>Bulk 13</th>
      <th>Bulk 14</th>
      <th>Bulk 15</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2019-05-02</th>
      <td>18</td>
      <td>6.0</td>
      <td>35</td>
      <td>38</td>
      <td>6.0</td>
      <td>36</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>8.0</td>
      <td>6</td>
      <td>99</td>
      <td>1.0</td>
      <td>110</td>
      <td>93</td>
    </tr>
    <tr>
      <th>2019-05-09</th>
      <td>19</td>
      <td>NaN</td>
      <td>69</td>
      <td>49</td>
      <td>8.0</td>
      <td>38</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>10.0</td>
      <td>2.0</td>
      <td>6</td>
      <td>138</td>
      <td>2.0</td>
      <td>159</td>
      <td>116</td>
    </tr>
    <tr>
      <th>2019-05-16</th>
      <td>20</td>
      <td>NaN</td>
      <td>46</td>
      <td>85</td>
      <td>2.0</td>
      <td>16</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>22.0</td>
      <td>5</td>
      <td>157</td>
      <td>1.0</td>
      <td>168</td>
      <td>152</td>
    </tr>
    <tr>
      <th>2019-05-23</th>
      <td>7</td>
      <td>NaN</td>
      <td>44</td>
      <td>80</td>
      <td>NaN</td>
      <td>29</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>7.0</td>
      <td>6</td>
      <td>142</td>
      <td>1.0</td>
      <td>152</td>
      <td>126</td>
    </tr>
    <tr>
      <th>2019-05-30</th>
      <td>8</td>
      <td>NaN</td>
      <td>90</td>
      <td>47</td>
      <td>NaN</td>
      <td>21</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>11.0</td>
      <td>4</td>
      <td>122</td>
      <td>1.0</td>
      <td>154</td>
      <td>100</td>
    </tr>
    <tr>
      <th>2019-06-06</th>
      <td>22</td>
      <td>NaN</td>
      <td>100</td>
      <td>39</td>
      <td>1.0</td>
      <td>50</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>14</td>
      <td>142</td>
      <td>1.0</td>
      <td>167</td>
      <td>130</td>
    </tr>
    <tr>
      <th>2019-06-13</th>
      <td>17</td>
      <td>NaN</td>
      <td>83</td>
      <td>84</td>
      <td>3.0</td>
      <td>22</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>3.0</td>
      <td>8</td>
      <td>146</td>
      <td>NaN</td>
      <td>169</td>
      <td>128</td>
    </tr>
    <tr>
      <th>2019-06-20</th>
      <td>19</td>
      <td>NaN</td>
      <td>100</td>
      <td>66</td>
      <td>NaN</td>
      <td>23</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>11.0</td>
      <td>3</td>
      <td>163</td>
      <td>1.0</td>
      <td>168</td>
      <td>156</td>
    </tr>
    <tr>
      <th>2019-06-27</th>
      <td>15</td>
      <td>NaN</td>
      <td>73</td>
      <td>61</td>
      <td>NaN</td>
      <td>31</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>15.0</td>
      <td>4</td>
      <td>141</td>
      <td>2.0</td>
      <td>159</td>
      <td>131</td>
    </tr>
    <tr>
      <th>2019-07-04</th>
      <td>22</td>
      <td>NaN</td>
      <td>83</td>
      <td>52</td>
      <td>16.0</td>
      <td>26</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>14.0</td>
      <td>6</td>
      <td>143</td>
      <td>1.0</td>
      <td>176</td>
      <td>128</td>
    </tr>
    <tr>
      <th>2019-07-11</th>
      <td>7</td>
      <td>NaN</td>
      <td>31</td>
      <td>18</td>
      <td>NaN</td>
      <td>8</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>6</td>
      <td>46</td>
      <td>1.0</td>
      <td>51</td>
      <td>44</td>
    </tr>
    <tr>
      <th>2019-07-18</th>
      <td>3</td>
      <td>NaN</td>
      <td>47</td>
      <td>43</td>
      <td>NaN</td>
      <td>53</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>28</td>
      <td>90</td>
      <td>NaN</td>
      <td>113</td>
      <td>87</td>
    </tr>
    <tr>
      <th>2019-07-25</th>
      <td>12</td>
      <td>7.0</td>
      <td>64</td>
      <td>65</td>
      <td>14.0</td>
      <td>34</td>
      <td>7.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>21.0</td>
      <td>14</td>
      <td>143</td>
      <td>1.0</td>
      <td>155</td>
      <td>126</td>
    </tr>
    <tr>
      <th>2019-08-01</th>
      <td>6</td>
      <td>NaN</td>
      <td>61</td>
      <td>68</td>
      <td>3.0</td>
      <td>51</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>16.0</td>
      <td>13</td>
      <td>151</td>
      <td>1.0</td>
      <td>175</td>
      <td>138</td>
    </tr>
    <tr>
      <th>2019-08-08</th>
      <td>21</td>
      <td>9.0</td>
      <td>91</td>
      <td>39</td>
      <td>8.0</td>
      <td>46</td>
      <td>8.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>26</td>
      <td>133</td>
      <td>NaN</td>
      <td>160</td>
      <td>132</td>
    </tr>
    <tr>
      <th>2019-08-15</th>
      <td>4</td>
      <td>NaN</td>
      <td>89</td>
      <td>38</td>
      <td>3.0</td>
      <td>42</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.0</td>
      <td>10.0</td>
      <td>14</td>
      <td>127</td>
      <td>NaN</td>
      <td>173</td>
      <td>127</td>
    </tr>
    <tr>
      <th>2019-08-22</th>
      <td>13</td>
      <td>NaN</td>
      <td>66</td>
      <td>72</td>
      <td>1.0</td>
      <td>24</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.0</td>
      <td>7</td>
      <td>153</td>
      <td>2.0</td>
      <td>167</td>
      <td>133</td>
    </tr>
    <tr>
      <th>2019-08-29</th>
      <td>15</td>
      <td>NaN</td>
      <td>105</td>
      <td>65</td>
      <td>12.0</td>
      <td>20</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>16.0</td>
      <td>3</td>
      <td>178</td>
      <td>2.0</td>
      <td>187</td>
      <td>162</td>
    </tr>
    <tr>
      <th>2019-09-05</th>
      <td>4</td>
      <td>NaN</td>
      <td>21</td>
      <td>5</td>
      <td>NaN</td>
      <td>6</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4</td>
      <td>36</td>
      <td>NaN</td>
      <td>43</td>
      <td>39</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_bulk_time_stat</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.07</span><span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Number of batches by week&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.07</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Number of batches&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Week&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e0d04ac0d0f42ecafffea7dd9c46c59f1fed948bc4658889b5ddb84be4c2a69e.png" src="_images/e0d04ac0d0f42ecafffea7dd9c46c59f1fed948bc4658889b5ddb84be4c2a69e.png" />
</div>
</div>
<p>The correlation is clearly traceable. The summer dip may be related to vacations.</p>
<p>The exact feeding time of the bulk solids probably has no effect on the final temperature. This data will not be used for training.</p>
<p><strong>Summary</strong></p>
<ul class="simple">
<li><p>Additives were used uniformly.</p></li>
<li><p>These data will not be used in training.</p></li>
</ul>
</section>
<section id="alloy-gas-purge-data">
<h3>Alloy gas purge data<a class="headerlink" href="#alloy-gas-purge-data" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_gas</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key</th>
      <th>Gas 1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>29.749986</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>12.555561</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>28.554793</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>18.841219</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>5.413692</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_gas</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 3239 entries, 0 to 3238
Data columns (total 2 columns):
 #   Column  Non-Null Count  Dtype  
---  ------  --------------  -----  
 0   key     3239 non-null   int64  
 1   Gas 1   3239 non-null   float64
dtypes: float64(1), int64(1)
memory usage: 50.7 KB
</pre></div>
</div>
</div>
</div>
<p>Пропусков нет.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_gas</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
</pre></div>
</div>
</div>
</div>
<p>There are batches for which there is no electrode data. They’ll be weeded out later with the <code class="docutils literal notranslate"><span class="pre">.join(how='inner')</span></code> method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_gas</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key</th>
      <th>Gas 1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>3239.000000</td>
      <td>3239.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>1621.861377</td>
      <td>11.002062</td>
    </tr>
    <tr>
      <th>std</th>
      <td>935.386334</td>
      <td>6.220327</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.000000</td>
      <td>0.008399</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>812.500000</td>
      <td>7.043089</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>1622.000000</td>
      <td>9.836267</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>2431.500000</td>
      <td>13.769915</td>
    </tr>
    <tr>
      <th>max</th>
      <td>3241.000000</td>
      <td>77.995040</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let’s estimate the distribution of this parameter.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data_gas</span><span class="p">[</span><span class="s1">&#39;Gas 1&#39;</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Gas purging&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Gas 1&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/1778d470af1a651ac0deb5601bdae97aea4b4f11ae8cfadcbe91637570f5e91e.png" src="_images/1778d470af1a651ac0deb5601bdae97aea4b4f11ae8cfadcbe91637570f5e91e.png" />
</div>
</div>
<p>Outliers are to be included in the test sample, but not taken in the training sample.</p>
<p><strong>Summary</strong></p>
<ul class="simple">
<li><p>It is not clear what Gas 1 is measured in.</p></li>
<li><p>There are outliers that are not anomalies. They should be kept in the test sample, but excluded from the training sample.</p></li>
</ul>
</section>
<section id="temperature-measurement-results">
<h3>Temperature measurement results<a class="headerlink" href="#temperature-measurement-results" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_temp</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key</th>
      <th>Time of measurement</th>
      <th>Temperature</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>2019-05-03 11:02:04</td>
      <td>1571.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>2019-05-03 11:07:18</td>
      <td>1604.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>2019-05-03 11:11:34</td>
      <td>1618.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>2019-05-03 11:18:04</td>
      <td>1601.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>2019-05-03 11:25:59</td>
      <td>1606.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Now to the missing values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_temp</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 18092 entries, 0 to 18091
Data columns (total 3 columns):
 #   Column               Non-Null Count  Dtype  
---  ------               --------------  -----  
 0   key                  18092 non-null  int64  
 1   Time of measurement  18092 non-null  object 
 2   Temperature          14665 non-null  float64
dtypes: float64(1), int64(1), object(1)
memory usage: 424.2+ KB
</pre></div>
</div>
</div>
</div>
<p>Temperature is a key parameter. Batches for which the temperature is unknown should be excluded from analysis.</p>
<p>Let’s build a histogram of the number of batches by the number of measurements.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_temp</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribution of the number of temperature measurements&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Number of batches&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Number of temperature measurements&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/ba5354caad90647c0a2fe29f5644d7775abbddaee5cc46847372104a89a06036.png" src="_images/ba5354caad90647c0a2fe29f5644d7775abbddaee5cc46847372104a89a06036.png" />
</div>
</div>
<p>No abnormal values are observed. Although the few for which there is only one dimension will need to be removed because the prediction coincides with the training feature.</p>
<p>Here is the boxplot of the temperature itself.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data_temp</span><span class="p">[</span><span class="s1">&#39;Temperature&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Temperature distribution (all measurements)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Temperature&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a8a228574a3e3ccd118315a99aee0e20ee6f1e1ad3eaf1450604ef94fdbd5852.png" src="_images/a8a228574a3e3ccd118315a99aee0e20ee6f1e1ad3eaf1450604ef94fdbd5852.png" />
</div>
</div>
<p>The melting point of alloy steel starts somewhere around 1400 °C, so values around 1200 degrees are abnormal. The batches with them should be discarded.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_temp</span><span class="p">[</span><span class="s1">&#39;Temperature&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count    14665.000000
mean      1590.722741
std         20.394381
min       1191.000000
25%       1580.000000
50%       1590.000000
75%       1599.000000
max       1705.000000
Name: Temperature, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data_temp</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;Temperature &gt; 1400&#39;</span><span class="p">)[</span><span class="s1">&#39;Temperature&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Temperature distribution (all measurements)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Temperature&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/2d59927202e00cb84efc0418dfc02585cf0bb1c4fd1fa29f054cc1604499f98c.png" src="_images/2d59927202e00cb84efc0418dfc02585cf0bb1c4fd1fa29f054cc1604499f98c.png" />
</div>
</div>
<p>The rest of the numbers look plausible. I think even outliers should not be excluded from the test sample.</p>
<p>Let’s also look at the average temperature of batch.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_temp_stat</span> <span class="o">=</span> <span class="n">data_temp</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;Temperature &gt; 1400&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">)[</span><span class="s1">&#39;Temperature&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
<span class="n">data_temp_stat</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>key
1    1602.166667
2    1590.600000
3    1598.166667
4    1616.800000
5    1589.000000
Name: Temperature, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data_temp_stat</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()[</span><span class="s1">&#39;Temperature&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Temperature distribution (batch mean)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Temperature&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f9ec596516f98a180f5df268fb32230bb5c50c355fad6a63175a2054b9581631.png" src="_images/f9ec596516f98a180f5df268fb32230bb5c50c355fad6a63175a2054b9581631.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">data_temp</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3216
</pre></div>
</div>
</div>
</div>
<p><strong>Summary</strong></p>
<ul class="simple">
<li><p>On average temperature is measured about 5 times.</p></li>
<li><p>There are missing values, the batches with which must be dropped.</p></li>
<li><p>There are abnormally low temperatures with which we should do the same.</p></li>
<li><p>The rest of the temperature values can be taken for training and testing.</p></li>
</ul>
</section>
<section id="wire-materials-data-volume">
<h3>Wire materials data (volume)<a class="headerlink" href="#wire-materials-data-volume" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_wire</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key</th>
      <th>Wire 1</th>
      <th>Wire 2</th>
      <th>Wire 3</th>
      <th>Wire 4</th>
      <th>Wire 5</th>
      <th>Wire 6</th>
      <th>Wire 7</th>
      <th>Wire 8</th>
      <th>Wire 9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>60.059998</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>96.052315</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>91.160157</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>89.063515</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>89.238236</td>
      <td>9.11456</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_wire</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 3081 entries, 0 to 3080
Data columns (total 10 columns):
 #   Column  Non-Null Count  Dtype  
---  ------  --------------  -----  
 0   key     3081 non-null   int64  
 1   Wire 1  3055 non-null   float64
 2   Wire 2  1079 non-null   float64
 3   Wire 3  63 non-null     float64
 4   Wire 4  14 non-null     float64
 5   Wire 5  1 non-null      float64
 6   Wire 6  73 non-null     float64
 7   Wire 7  11 non-null     float64
 8   Wire 8  19 non-null     float64
 9   Wire 9  29 non-null     float64
dtypes: float64(9), int64(1)
memory usage: 240.8 KB
</pre></div>
</div>
</div>
</div>
<p>There are a lot of gaps again. Let’s fill them in with zeros.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_wire</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key</th>
      <th>Wire 1</th>
      <th>Wire 2</th>
      <th>Wire 3</th>
      <th>Wire 4</th>
      <th>Wire 5</th>
      <th>Wire 6</th>
      <th>Wire 7</th>
      <th>Wire 8</th>
      <th>Wire 9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>3081.000000</td>
      <td>3055.000000</td>
      <td>1079.000000</td>
      <td>63.000000</td>
      <td>14.000000</td>
      <td>1.000</td>
      <td>73.000000</td>
      <td>11.000000</td>
      <td>19.000000</td>
      <td>29.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>1623.426485</td>
      <td>100.895853</td>
      <td>50.577323</td>
      <td>189.482681</td>
      <td>57.442841</td>
      <td>15.132</td>
      <td>48.016974</td>
      <td>10.039007</td>
      <td>53.625193</td>
      <td>34.155752</td>
    </tr>
    <tr>
      <th>std</th>
      <td>932.996726</td>
      <td>42.012518</td>
      <td>39.320216</td>
      <td>99.513444</td>
      <td>28.824667</td>
      <td>NaN</td>
      <td>33.919845</td>
      <td>8.610584</td>
      <td>16.881728</td>
      <td>19.931616</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.000000</td>
      <td>1.918800</td>
      <td>0.030160</td>
      <td>0.144144</td>
      <td>24.148801</td>
      <td>15.132</td>
      <td>0.034320</td>
      <td>0.234208</td>
      <td>45.076721</td>
      <td>4.622800</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>823.000000</td>
      <td>72.115684</td>
      <td>20.193680</td>
      <td>95.135044</td>
      <td>40.807002</td>
      <td>15.132</td>
      <td>25.053600</td>
      <td>6.762756</td>
      <td>46.094879</td>
      <td>22.058401</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>1619.000000</td>
      <td>100.158234</td>
      <td>40.142956</td>
      <td>235.194977</td>
      <td>45.234282</td>
      <td>15.132</td>
      <td>42.076324</td>
      <td>9.017009</td>
      <td>46.279999</td>
      <td>30.066399</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>2434.000000</td>
      <td>126.060483</td>
      <td>70.227558</td>
      <td>276.252014</td>
      <td>76.124619</td>
      <td>15.132</td>
      <td>64.212723</td>
      <td>11.886057</td>
      <td>48.089603</td>
      <td>43.862003</td>
    </tr>
    <tr>
      <th>max</th>
      <td>3241.000000</td>
      <td>330.314424</td>
      <td>282.780152</td>
      <td>385.008668</td>
      <td>113.231044</td>
      <td>15.132</td>
      <td>180.454575</td>
      <td>32.847674</td>
      <td>102.762401</td>
      <td>90.053604</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data_wire</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;key&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Wire materials volume distribution&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Additive&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Volume&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">())):</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">tick</span><span class="p">,</span> <span class="o">-</span><span class="mi">12</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">data_wire</span><span class="p">[</span><span class="s1">&#39;Wire &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tick</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()),</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e8e04d70a1d2f4113d77e8156f09bc50146b78be14f4053513ff23ddd1b1e7fd.png" src="_images/e8e04d70a1d2f4113d77e8156f09bc50146b78be14f4053513ff23ddd1b1e7fd.png" />
</div>
</div>
<p>Let’s take the first two. There’s plenty of data on them.<br />
There are suspiciously low values, but I don’t think they are anomalies.</p>
<p><strong>Summary</strong></p>
<ul class="simple">
<li><p>There are many gaps in the data that need to be filled in with zeros.</p></li>
<li><p>For the two wires alone, there is enough data. Let’s take them for training, with scaling.</p></li>
<li><p>No abnormal volume values are observed.</p></li>
</ul>
</section>
<section id="wire-materials-data-time">
<h3>Wire materials data (time)<a class="headerlink" href="#wire-materials-data-time" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_wire_time</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key</th>
      <th>Wire 1</th>
      <th>Wire 2</th>
      <th>Wire 3</th>
      <th>Wire 4</th>
      <th>Wire 5</th>
      <th>Wire 6</th>
      <th>Wire 7</th>
      <th>Wire 8</th>
      <th>Wire 9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>2019-05-03 11:06:19</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>2019-05-03 11:36:50</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>2019-05-03 12:11:46</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>2019-05-03 12:43:22</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>2019-05-03 13:20:44</td>
      <td>2019-05-03 13:15:34</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_wire_time</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 3081 entries, 0 to 3080
Data columns (total 10 columns):
 #   Column  Non-Null Count  Dtype 
---  ------  --------------  ----- 
 0   key     3081 non-null   int64 
 1   Wire 1  3055 non-null   object
 2   Wire 2  1079 non-null   object
 3   Wire 3  63 non-null     object
 4   Wire 4  14 non-null     object
 5   Wire 5  1 non-null      object
 6   Wire 6  73 non-null     object
 7   Wire 7  11 non-null     object
 8   Wire 8  19 non-null     object
 9   Wire 9  29 non-null     object
dtypes: int64(1), object(9)
memory usage: 240.8+ KB
</pre></div>
</div>
</div>
</div>
<p>Also a full match. Let’s look at the number of additives by week.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_wire_time_weeks</span> <span class="o">=</span> <span class="n">data_wire_time</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">data_wire_time_weeks</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_wire_time_weeks</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data_wire_time_weeks</span>
                   <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                   <span class="o">.</span><span class="n">stack</span><span class="p">())</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;datetime64[W]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unstack</span><span class="p">())</span>
<span class="n">data_wire_time_weeks</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key</th>
      <th>Wire 1</th>
      <th>Wire 2</th>
      <th>Wire 3</th>
      <th>Wire 4</th>
      <th>Wire 5</th>
      <th>Wire 6</th>
      <th>Wire 7</th>
      <th>Wire 8</th>
      <th>Wire 9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>2019-05-02</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>2019-05-02</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>2019-05-02</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>2019-05-02</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>2019-05-02</td>
      <td>2019-05-02</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
      <td>NaT</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_wire_time_stat</span> <span class="o">=</span> <span class="n">data_wire_time_weeks</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">value_counts</span><span class="p">)</span>
<span class="n">data_wire_time_stat</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Wire 1</th>
      <th>Wire 2</th>
      <th>Wire 3</th>
      <th>Wire 4</th>
      <th>Wire 5</th>
      <th>Wire 6</th>
      <th>Wire 7</th>
      <th>Wire 8</th>
      <th>Wire 9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2019-05-02</th>
      <td>117</td>
      <td>44</td>
      <td>10.0</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>21.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2019-05-09</th>
      <td>176</td>
      <td>75</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>10.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2019-05-16</th>
      <td>173</td>
      <td>56</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2019-05-23</th>
      <td>168</td>
      <td>45</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2019-05-30</th>
      <td>157</td>
      <td>52</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>2019-06-06</th>
      <td>191</td>
      <td>72</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>9.0</td>
    </tr>
    <tr>
      <th>2019-06-13</th>
      <td>192</td>
      <td>37</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2019-06-20</th>
      <td>190</td>
      <td>50</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2019-06-27</th>
      <td>187</td>
      <td>92</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2019-07-04</th>
      <td>188</td>
      <td>69</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>2019-07-11</th>
      <td>53</td>
      <td>16</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2019-07-18</th>
      <td>136</td>
      <td>50</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2019-07-25</th>
      <td>176</td>
      <td>51</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>NaN</td>
      <td>20.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2019-08-01</th>
      <td>180</td>
      <td>91</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2019-08-08</th>
      <td>181</td>
      <td>81</td>
      <td>14.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>19.0</td>
      <td>7.0</td>
      <td>NaN</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>2019-08-15</th>
      <td>174</td>
      <td>75</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>9.0</td>
      <td>NaN</td>
      <td>6.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2019-08-22</th>
      <td>171</td>
      <td>47</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2019-08-29</th>
      <td>197</td>
      <td>60</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2019-09-05</th>
      <td>48</td>
      <td>16</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_wire_time_stat</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.07</span><span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Number of batches by week&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.07</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Number of batches&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Week&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/87e804c2f92c7775a5e10aa644fb21ae1f607be274c983351a06f4357469b222.png" src="_images/87e804c2f92c7775a5e10aa644fb21ae1f607be274c983351a06f4357469b222.png" />
</div>
</div>
<p>The picture is similar. Even wire materials with a small number of batches were used periodically. For the two main ones the time series are similar.</p>
<p><strong>Summary</strong></p>
<ul class="simple">
<li><p>Two common types of wire materials were used throughout the whole time period.</p></li>
<li><p>We will not use these data.</p></li>
</ul>
</section>
</section>
<section id="plan">
<h2>Plan<a class="headerlink" href="#plan" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Load data from all datasets except for two datasets about the time of feeding additives.</p></li>
<li><p>Process the gaps as follows:</p>
<ul class="simple">
<li><p>Fill with zeros for bulk and wire materials volume data</p></li>
<li><p>Discard batches with gaps for temperature values</p></li>
</ul>
</li>
<li><p>Process the anomalies as follows:</p>
<ul class="simple">
<li><p>Remove the batch with a negative reactive power value for the electrode data.</p></li>
<li><p>Remove the batches with temperature values around 1200 degrees.</p></li>
</ul>
</li>
<li><p>Take the following attributes for training and testing:</p>
<ul class="simple">
<li><p>Work calculated from active and reactive power multiplied by heating time</p></li>
<li><p>Total treament time in seconds (heating time + breaks)</p></li>
<li><p>Volume of added bulk materials 3, 4, 6, 12, 14 and 15</p></li>
<li><p>Volume of wire materials 1 and 2</p></li>
<li><p>Initial temperature of the alloy</p></li>
<li><p>Gas purge values (they reflect cooling)</p></li>
</ul>
</li>
<li><p>Take the last temperature for each batch as the target feature</p></li>
<li><p>Carry out an exploratory analysis of the resulting features, see the correlation</p></li>
<li><p>Split into training and test datasets</p></li>
<li><p>Remove from the training dataset:</p>
<ul class="simple">
<li><p>Outliers in bulk and wire volume values</p></li>
<li><p>Outliers in gas purge values</p></li>
</ul>
</li>
<li><p>Perform data scaling (trained on the training sample only).</p></li>
<li><p>Train and cross-validate the following models:</p>
<ul class="simple">
<li><p>Linear Regression</p></li>
<li><p>Elastic Net</p></li>
<li><p>Random Forest</p></li>
<li><p>LightGBM</p></li>
<li><p>CatBoost</p></li>
</ul>
</li>
<li><p>Compare MAE of the best of them with MAE of models predicting always mean and median temperature</p></li>
<li><p>Analyze the importance of the features of the tested model</p></li>
<li><p>Test the model</p></li>
<li><p>Write a report</p></li>
</ol>
</section>
<section id="data-preprocessing">
<h2>Data preprocessing<a class="headerlink" href="#data-preprocessing" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">data_arc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data_arc_new.csv&#39;</span><span class="p">)</span>
    <span class="n">data_bulk</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data_bulk_new.csv&#39;</span><span class="p">)</span>
    <span class="n">data_gas</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data_gas_new.csv&#39;</span><span class="p">)</span>
    <span class="n">data_temp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data_temp_new.csv&#39;</span><span class="p">)</span>
    <span class="n">data_wire</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data_wire_new.csv&#39;</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">data_arc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/datasets/data_arc_new.csv&#39;</span><span class="p">)</span>
    <span class="n">data_bulk</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/datasets/data_bulk_new.csv&#39;</span><span class="p">)</span>
    <span class="n">data_gas</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/datasets/data_gas_new.csv&#39;</span><span class="p">)</span>
    <span class="n">data_temp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/datasets/data_temp_new.csv&#39;</span><span class="p">)</span>
    <span class="n">data_wire</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/datasets/data_wire_new.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="data-types">
<h3>Data Types<a class="headerlink" href="#data-types" title="Link to this heading">#</a></h3>
<p>Let’s convert strings to datetime.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_arc</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 14876 entries, 0 to 14875
Data columns (total 5 columns):
 #   Column                Non-Null Count  Dtype  
---  ------                --------------  -----  
 0   key                   14876 non-null  int64  
 1   Start of arc heating  14876 non-null  object 
 2   End of arc heating    14876 non-null  object 
 3   Active power          14876 non-null  float64
 4   Reactive power        14876 non-null  float64
dtypes: float64(2), int64(1), object(2)
memory usage: 581.2+ KB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_arc</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s1">&#39;Start of arc heating&#39;</span><span class="p">,</span> <span class="s1">&#39;End of arc heating&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">data_arc</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s1">&#39;Start of arc heating&#39;</span><span class="p">,</span> <span class="s1">&#39;End of arc heating&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_arc</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 14876 entries, 0 to 14875
Data columns (total 5 columns):
 #   Column                Non-Null Count  Dtype         
---  ------                --------------  -----         
 0   key                   14876 non-null  int64         
 1   Start of arc heating  14876 non-null  datetime64[ns]
 2   End of arc heating    14876 non-null  datetime64[ns]
 3   Active power          14876 non-null  float64       
 4   Reactive power        14876 non-null  float64       
dtypes: datetime64[ns](2), float64(2), int64(1)
memory usage: 581.2 KB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_temp</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 18092 entries, 0 to 18091
Data columns (total 3 columns):
 #   Column               Non-Null Count  Dtype  
---  ------               --------------  -----  
 0   key                  18092 non-null  int64  
 1   Time of measurement  18092 non-null  object 
 2   Temperature          14665 non-null  float64
dtypes: float64(1), int64(1), object(1)
memory usage: 424.2+ KB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_temp</span><span class="p">[</span><span class="s1">&#39;Time of measurement&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data_temp</span><span class="p">[</span><span class="s1">&#39;Time of measurement&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_temp</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 18092 entries, 0 to 18091
Data columns (total 3 columns):
 #   Column               Non-Null Count  Dtype         
---  ------               --------------  -----         
 0   key                  18092 non-null  int64         
 1   Time of measurement  18092 non-null  datetime64[ns]
 2   Temperature          14665 non-null  float64       
dtypes: datetime64[ns](1), float64(1), int64(1)
memory usage: 424.2 KB
</pre></div>
</div>
</div>
</div>
</section>
<section id="missing-values">
<h3>Missing values<a class="headerlink" href="#missing-values" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_bulk</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 3129 entries, 0 to 3128
Data columns (total 16 columns):
 #   Column   Non-Null Count  Dtype  
---  ------   --------------  -----  
 0   key      3129 non-null   int64  
 1   Bulk 1   252 non-null    float64
 2   Bulk 2   22 non-null     float64
 3   Bulk 3   1298 non-null   float64
 4   Bulk 4   1014 non-null   float64
 5   Bulk 5   77 non-null     float64
 6   Bulk 6   576 non-null    float64
 7   Bulk 7   25 non-null     float64
 8   Bulk 8   1 non-null      float64
 9   Bulk 9   19 non-null     float64
 10  Bulk 10  176 non-null    float64
 11  Bulk 11  177 non-null    float64
 12  Bulk 12  2450 non-null   float64
 13  Bulk 13  18 non-null     float64
 14  Bulk 14  2806 non-null   float64
 15  Bulk 15  2248 non-null   float64
dtypes: float64(15), int64(1)
memory usage: 391.2 KB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_bulk</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">data_wire</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_bulk</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key</th>
      <th>Bulk 1</th>
      <th>Bulk 2</th>
      <th>Bulk 3</th>
      <th>Bulk 4</th>
      <th>Bulk 5</th>
      <th>Bulk 6</th>
      <th>Bulk 7</th>
      <th>Bulk 8</th>
      <th>Bulk 9</th>
      <th>Bulk 10</th>
      <th>Bulk 11</th>
      <th>Bulk 12</th>
      <th>Bulk 13</th>
      <th>Bulk 14</th>
      <th>Bulk 15</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>43.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>206.0</td>
      <td>0.0</td>
      <td>150.0</td>
      <td>154.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>73.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>206.0</td>
      <td>0.0</td>
      <td>149.0</td>
      <td>154.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>34.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>205.0</td>
      <td>0.0</td>
      <td>152.0</td>
      <td>153.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>81.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>207.0</td>
      <td>0.0</td>
      <td>153.0</td>
      <td>154.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>78.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>203.0</td>
      <td>0.0</td>
      <td>151.0</td>
      <td>152.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_wire</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 3081 entries, 0 to 3080
Data columns (total 10 columns):
 #   Column  Non-Null Count  Dtype  
---  ------  --------------  -----  
 0   key     3081 non-null   int64  
 1   Wire 1  3081 non-null   float64
 2   Wire 2  3081 non-null   float64
 3   Wire 3  3081 non-null   float64
 4   Wire 4  3081 non-null   float64
 5   Wire 5  3081 non-null   float64
 6   Wire 6  3081 non-null   float64
 7   Wire 7  3081 non-null   float64
 8   Wire 8  3081 non-null   float64
 9   Wire 9  3081 non-null   float64
dtypes: float64(9), int64(1)
memory usage: 240.8 KB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_temp</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 18092 entries, 0 to 18091
Data columns (total 3 columns):
 #   Column               Non-Null Count  Dtype         
---  ------               --------------  -----         
 0   key                  18092 non-null  int64         
 1   Time of measurement  18092 non-null  datetime64[ns]
 2   Temperature          14665 non-null  float64       
dtypes: datetime64[ns](1), float64(1), int64(1)
memory usage: 424.2 KB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">keys_with_nan</span> <span class="o">=</span> <span class="n">data_temp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_temp</span><span class="p">[</span><span class="s1">&#39;Temperature&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">(),</span> <span class="s1">&#39;key&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
<span class="n">keys_with_nan</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>13927    2500
13932    2501
13939    2502
13944    2503
13949    2504
         ... 
18062    3237
18068    3238
18072    3239
18081    3240
18087    3241
Name: key, Length: 739, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Let’s see what we’re going to keep.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_temp</span> <span class="o">=</span> <span class="n">data_temp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">data_temp</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">keys_with_nan</span><span class="p">)]</span>
<span class="n">data_temp</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key</th>
      <th>Time of measurement</th>
      <th>Temperature</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>2019-05-03 11:02:04</td>
      <td>1571.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>2019-05-03 11:07:18</td>
      <td>1604.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>2019-05-03 11:11:34</td>
      <td>1618.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>2019-05-03 11:18:04</td>
      <td>1601.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>2019-05-03 11:25:59</td>
      <td>1606.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="duplicates">
<h3>Duplicates<a class="headerlink" href="#duplicates" title="Link to this heading">#</a></h3>
<p>We’ll check for duplicates just in case.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Electrodes:&#39;</span><span class="p">,</span> <span class="n">data_arc</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Electrodes, start time:&#39;</span><span class="p">,</span> <span class="n">data_arc</span><span class="p">[</span><span class="s1">&#39;Start of arc heating&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Electrodes, end time:&#39;</span><span class="p">,</span> <span class="n">data_arc</span><span class="p">[</span><span class="s1">&#39;End of arc heating&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Gas purging:&#39;</span><span class="p">,</span> <span class="n">data_gas</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Temperature:&#39;</span><span class="p">,</span> <span class="n">data_temp</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Temperature, time of measurement:&#39;</span><span class="p">,</span> <span class="n">data_temp</span><span class="p">[</span><span class="s1">&#39;Time of measurement&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Bulk materials:&#39;</span><span class="p">,</span> <span class="n">data_bulk</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wire materials:&#39;</span><span class="p">,</span> <span class="n">data_wire</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Electrodes: 0
Electrodes, start time: 0
Electrodes, end time: 0
Gas purging: 0
Temperature: 0
Temperature, time of measurement: 0
Bulk materials: 0
Wire materials: 0
</pre></div>
</div>
</div>
</div>
</section>
<section id="anomalies">
<h3>Anomalies<a class="headerlink" href="#anomalies" title="Link to this heading">#</a></h3>
<p>Let’s remove the batch with negative reactive power for the electrode data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_arc_neg</span> <span class="o">=</span> <span class="n">data_arc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_arc</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">data_arc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_arc</span><span class="p">[</span><span class="s1">&#39;Reactive power&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;key&#39;</span><span class="p">])]</span>
<span class="n">data_arc_neg</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key</th>
      <th>Start of arc heating</th>
      <th>End of arc heating</th>
      <th>Active power</th>
      <th>Reactive power</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>9778</th>
      <td>2116</td>
      <td>2019-07-28 02:07:12</td>
      <td>2019-07-28 02:09:14</td>
      <td>0.787549</td>
      <td>0.693881</td>
    </tr>
    <tr>
      <th>9779</th>
      <td>2116</td>
      <td>2019-07-28 02:13:10</td>
      <td>2019-07-28 02:15:25</td>
      <td>0.580263</td>
      <td>0.411498</td>
    </tr>
    <tr>
      <th>9780</th>
      <td>2116</td>
      <td>2019-07-28 02:22:08</td>
      <td>2019-07-28 02:23:57</td>
      <td>0.705344</td>
      <td>-715.479924</td>
    </tr>
    <tr>
      <th>9781</th>
      <td>2116</td>
      <td>2019-07-28 02:29:11</td>
      <td>2019-07-28 02:30:18</td>
      <td>0.563641</td>
      <td>0.408513</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_arc</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">data_arc_neg</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">data_arc</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key</th>
      <th>Active power</th>
      <th>Reactive power</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>14872.000000</td>
      <td>14872.000000</td>
      <td>14872.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>1615.085732</td>
      <td>0.662753</td>
      <td>0.487112</td>
    </tr>
    <tr>
      <th>std</th>
      <td>934.661090</td>
      <td>0.258916</td>
      <td>0.197623</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.000000</td>
      <td>0.223120</td>
      <td>0.153777</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>806.000000</td>
      <td>0.467114</td>
      <td>0.337175</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>1616.000000</td>
      <td>0.599587</td>
      <td>0.441667</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>2429.000000</td>
      <td>0.830314</td>
      <td>0.608201</td>
    </tr>
    <tr>
      <th>max</th>
      <td>3241.000000</td>
      <td>1.463773</td>
      <td>1.270284</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Now the minimum positive.</p>
<p>Let’s remove batches with temperature values around 1200 degrees.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_temp_low</span> <span class="o">=</span> <span class="n">data_temp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_temp</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">data_temp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_temp</span><span class="p">[</span><span class="s1">&#39;Temperature&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">1400</span><span class="p">,</span> <span class="s1">&#39;key&#39;</span><span class="p">])]</span>
<span class="n">data_temp_low</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key</th>
      <th>Time of measurement</th>
      <th>Temperature</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>4883</th>
      <td>867</td>
      <td>2019-06-06 08:03:39</td>
      <td>1191.0</td>
    </tr>
    <tr>
      <th>4884</th>
      <td>867</td>
      <td>2019-06-06 08:18:52</td>
      <td>1575.0</td>
    </tr>
    <tr>
      <th>4885</th>
      <td>867</td>
      <td>2019-06-06 08:22:38</td>
      <td>1576.0</td>
    </tr>
    <tr>
      <th>4886</th>
      <td>867</td>
      <td>2019-06-06 08:25:11</td>
      <td>1571.0</td>
    </tr>
    <tr>
      <th>4887</th>
      <td>867</td>
      <td>2019-06-06 08:29:49</td>
      <td>1600.0</td>
    </tr>
    <tr>
      <th>4888</th>
      <td>867</td>
      <td>2019-06-06 08:36:49</td>
      <td>1522.0</td>
    </tr>
    <tr>
      <th>4889</th>
      <td>867</td>
      <td>2019-06-06 08:43:02</td>
      <td>1521.0</td>
    </tr>
    <tr>
      <th>4890</th>
      <td>867</td>
      <td>2019-06-06 08:48:23</td>
      <td>1599.0</td>
    </tr>
    <tr>
      <th>6784</th>
      <td>1214</td>
      <td>2019-06-18 08:01:03</td>
      <td>1208.0</td>
    </tr>
    <tr>
      <th>6785</th>
      <td>1214</td>
      <td>2019-06-18 08:17:56</td>
      <td>1608.0</td>
    </tr>
    <tr>
      <th>6786</th>
      <td>1214</td>
      <td>2019-06-18 08:31:10</td>
      <td>1608.0</td>
    </tr>
    <tr>
      <th>6787</th>
      <td>1214</td>
      <td>2019-06-18 08:43:56</td>
      <td>1591.0</td>
    </tr>
    <tr>
      <th>9050</th>
      <td>1619</td>
      <td>2019-07-03 02:34:41</td>
      <td>1218.0</td>
    </tr>
    <tr>
      <th>9051</th>
      <td>1619</td>
      <td>2019-07-03 02:39:29</td>
      <td>1623.0</td>
    </tr>
    <tr>
      <th>9052</th>
      <td>1619</td>
      <td>2019-07-03 02:43:59</td>
      <td>1590.0</td>
    </tr>
    <tr>
      <th>11495</th>
      <td>2052</td>
      <td>2019-07-25 08:49:15</td>
      <td>1227.0</td>
    </tr>
    <tr>
      <th>11496</th>
      <td>2052</td>
      <td>2019-07-25 08:54:39</td>
      <td>1592.0</td>
    </tr>
    <tr>
      <th>11497</th>
      <td>2052</td>
      <td>2019-07-25 09:03:59</td>
      <td>1590.0</td>
    </tr>
    <tr>
      <th>11498</th>
      <td>2052</td>
      <td>2019-07-25 09:07:19</td>
      <td>1591.0</td>
    </tr>
    <tr>
      <th>11499</th>
      <td>2052</td>
      <td>2019-07-25 09:20:11</td>
      <td>1515.0</td>
    </tr>
    <tr>
      <th>11500</th>
      <td>2052</td>
      <td>2019-07-25 09:27:03</td>
      <td>1592.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_temp</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">data_temp_low</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data_temp</span><span class="p">[</span><span class="s1">&#39;Temperature&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Temperature distribution (all measurements)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Temperature&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3a0649219ac9fdcaeb0f6cb2e4afbab6a163248cdcfb077da0983913002f5446.png" src="_images/3a0649219ac9fdcaeb0f6cb2e4afbab6a163248cdcfb077da0983913002f5446.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_temp</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(13905, 3)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_temp</span> <span class="o">=</span> <span class="n">data_temp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_temp</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">data_temp</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">data_temp</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(13903, 3)
</pre></div>
</div>
</div>
</div>
</section>
<section id="feature-creation">
<h3>Feature creation<a class="headerlink" href="#feature-creation" title="Link to this heading">#</a></h3>
<p>Let’s join the necessary features by keys.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_arc</span><span class="p">[</span><span class="s1">&#39;Heating time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_arc</span><span class="p">[</span><span class="s1">&#39;End of arc heating&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_arc</span><span class="p">[</span><span class="s1">&#39;Start of arc heating&#39;</span><span class="p">]</span>
                            <span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
<span class="n">data_arc</span><span class="p">[</span><span class="s1">&#39;Total power&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_arc</span><span class="p">[</span><span class="s1">&#39;Active power&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">data_arc</span><span class="p">[</span><span class="s1">&#39;Reactive power&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
<span class="n">data_arc</span><span class="p">[</span><span class="s1">&#39;Work&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_arc</span><span class="p">[</span><span class="s1">&#39;Total power&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">data_arc</span><span class="p">[</span><span class="s1">&#39;Heating time&#39;</span><span class="p">]</span>
<span class="n">data_arc</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key</th>
      <th>Start of arc heating</th>
      <th>End of arc heating</th>
      <th>Active power</th>
      <th>Reactive power</th>
      <th>Heating time</th>
      <th>Total power</th>
      <th>Work</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>2019-05-03 11:02:14</td>
      <td>2019-05-03 11:06:02</td>
      <td>0.305130</td>
      <td>0.211253</td>
      <td>228.0</td>
      <td>0.371123</td>
      <td>84.616003</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>2019-05-03 11:07:28</td>
      <td>2019-05-03 11:10:33</td>
      <td>0.765658</td>
      <td>0.477438</td>
      <td>185.0</td>
      <td>0.902319</td>
      <td>166.928978</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>2019-05-03 11:11:44</td>
      <td>2019-05-03 11:14:36</td>
      <td>0.580313</td>
      <td>0.430460</td>
      <td>172.0</td>
      <td>0.722536</td>
      <td>124.276277</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>2019-05-03 11:18:14</td>
      <td>2019-05-03 11:24:19</td>
      <td>0.518496</td>
      <td>0.379979</td>
      <td>365.0</td>
      <td>0.642824</td>
      <td>234.630603</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>2019-05-03 11:26:09</td>
      <td>2019-05-03 11:28:37</td>
      <td>0.867133</td>
      <td>0.643691</td>
      <td>148.0</td>
      <td>1.079934</td>
      <td>159.830252</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let’s take the total work and total treatment time (including heating and breaks) for each batch.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_arc_features</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">data_arc</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;Work&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">((</span><span class="n">pd</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
        <span class="n">data_arc</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;End of arc heating&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">)[</span><span class="s1">&#39;End of arc heating&#39;</span><span class="p">]</span> <span class="o">-</span> 
                  <span class="n">pd</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
        <span class="n">data_arc</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;Start of arc heating&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">)[</span><span class="s1">&#39;Start of arc heating&#39;</span><span class="p">]</span>
                 <span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Treatment time&#39;</span><span class="p">]),</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>
<span class="n">data_arc_features</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Work</th>
      <th>Treatment time</th>
    </tr>
    <tr>
      <th>key</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>770.282114</td>
      <td>1583.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>481.760005</td>
      <td>1144.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>722.837668</td>
      <td>1525.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>683.455597</td>
      <td>1093.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>512.169934</td>
      <td>1362.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_arc_features</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(3213, 2)
</pre></div>
</div>
</div>
</div>
<p>Let’s also take the data for bulk materials 3, 4, 6, 12, 14 and 15.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_bulk_features</span> <span class="o">=</span> <span class="n">data_bulk</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="p">:,</span> <span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;Bulk 3&#39;</span><span class="p">,</span> <span class="s1">&#39;Bulk 4&#39;</span><span class="p">,</span> <span class="s1">&#39;Bulk 6&#39;</span><span class="p">,</span> <span class="s1">&#39;Bulk 12&#39;</span><span class="p">,</span> <span class="s1">&#39;Bulk 14&#39;</span><span class="p">,</span> <span class="s1">&#39;Bulk 15&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">)</span>
<span class="n">data_bulk_features</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Bulk 3</th>
      <th>Bulk 4</th>
      <th>Bulk 6</th>
      <th>Bulk 12</th>
      <th>Bulk 14</th>
      <th>Bulk 15</th>
    </tr>
    <tr>
      <th>key</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0.0</td>
      <td>43.0</td>
      <td>0.0</td>
      <td>206.0</td>
      <td>150.0</td>
      <td>154.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.0</td>
      <td>73.0</td>
      <td>0.0</td>
      <td>206.0</td>
      <td>149.0</td>
      <td>154.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.0</td>
      <td>34.0</td>
      <td>0.0</td>
      <td>205.0</td>
      <td>152.0</td>
      <td>153.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.0</td>
      <td>81.0</td>
      <td>0.0</td>
      <td>207.0</td>
      <td>153.0</td>
      <td>154.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.0</td>
      <td>78.0</td>
      <td>0.0</td>
      <td>203.0</td>
      <td>151.0</td>
      <td>152.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_bulk_features</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(3129, 6)
</pre></div>
</div>
</div>
</div>
<p>And data on wire materials 1 and 2.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_wire_features</span> <span class="o">=</span> <span class="n">data_wire</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;Wire 1&#39;</span><span class="p">,</span> <span class="s1">&#39;Wire 2&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">)</span>
<span class="n">data_wire_features</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Wire 1</th>
      <th>Wire 2</th>
    </tr>
    <tr>
      <th>key</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>60.059998</td>
      <td>0.00000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>96.052315</td>
      <td>0.00000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>91.160157</td>
      <td>0.00000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>89.063515</td>
      <td>0.00000</td>
    </tr>
    <tr>
      <th>5</th>
      <td>89.238236</td>
      <td>9.11456</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_wire_features</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(3081, 2)
</pre></div>
</div>
</div>
</div>
<p>We also use gas purge numbers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_gas_features</span> <span class="o">=</span> <span class="n">data_gas</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">)</span>
<span class="n">data_gas_features</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Gas 1</th>
    </tr>
    <tr>
      <th>key</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>29.749986</td>
    </tr>
    <tr>
      <th>2</th>
      <td>12.555561</td>
    </tr>
    <tr>
      <th>3</th>
      <td>28.554793</td>
    </tr>
    <tr>
      <th>4</th>
      <td>18.841219</td>
    </tr>
    <tr>
      <th>5</th>
      <td>5.413692</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_gas_features</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(3239, 1)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_temp_features</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">data_temp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_temp</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">)[</span><span class="s1">&#39;Time of measurement&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmin</span><span class="p">(),</span> <span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;Temperature&#39;</span><span class="p">]]</span>\
    <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Temperature&#39;</span><span class="p">:</span> <span class="s1">&#39;Starting temperature&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">data_temp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_temp</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">)[</span><span class="s1">&#39;Time of measurement&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">(),</span> <span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;Temperature&#39;</span><span class="p">]]</span>\
    <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Temperature&#39;</span><span class="p">:</span> <span class="s1">&#39;Final temperature&#39;</span><span class="p">}),</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">))</span>
<span class="n">data_temp_features</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Starting temperature</th>
      <th>Final temperature</th>
    </tr>
    <tr>
      <th>key</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>1571.0</td>
      <td>1613.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1581.0</td>
      <td>1602.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1596.0</td>
      <td>1599.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1601.0</td>
      <td>1625.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1576.0</td>
      <td>1602.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_temp_features</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(2471, 2)
</pre></div>
</div>
</div>
</div>
<p>Now joining them by key identifier.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features</span> <span class="o">=</span> <span class="n">data_arc_features</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="p">[</span><span class="n">data_bulk_features</span><span class="p">,</span> <span class="n">data_wire_features</span><span class="p">,</span> <span class="n">data_gas_features</span><span class="p">,</span> <span class="n">data_temp_features</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>
<span class="n">features</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Work</th>
      <th>Treatment time</th>
      <th>Bulk 3</th>
      <th>Bulk 4</th>
      <th>Bulk 6</th>
      <th>Bulk 12</th>
      <th>Bulk 14</th>
      <th>Bulk 15</th>
      <th>Wire 1</th>
      <th>Wire 2</th>
      <th>Gas 1</th>
      <th>Starting temperature</th>
      <th>Final temperature</th>
    </tr>
    <tr>
      <th>key</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>770.282114</td>
      <td>1583.0</td>
      <td>0.0</td>
      <td>43.0</td>
      <td>0.0</td>
      <td>206.0</td>
      <td>150.0</td>
      <td>154.0</td>
      <td>60.059998</td>
      <td>0.00000</td>
      <td>29.749986</td>
      <td>1571.0</td>
      <td>1613.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>481.760005</td>
      <td>1144.0</td>
      <td>0.0</td>
      <td>73.0</td>
      <td>0.0</td>
      <td>206.0</td>
      <td>149.0</td>
      <td>154.0</td>
      <td>96.052315</td>
      <td>0.00000</td>
      <td>12.555561</td>
      <td>1581.0</td>
      <td>1602.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>722.837668</td>
      <td>1525.0</td>
      <td>0.0</td>
      <td>34.0</td>
      <td>0.0</td>
      <td>205.0</td>
      <td>152.0</td>
      <td>153.0</td>
      <td>91.160157</td>
      <td>0.00000</td>
      <td>28.554793</td>
      <td>1596.0</td>
      <td>1599.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>683.455597</td>
      <td>1093.0</td>
      <td>0.0</td>
      <td>81.0</td>
      <td>0.0</td>
      <td>207.0</td>
      <td>153.0</td>
      <td>154.0</td>
      <td>89.063515</td>
      <td>0.00000</td>
      <td>18.841219</td>
      <td>1601.0</td>
      <td>1625.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>512.169934</td>
      <td>1362.0</td>
      <td>0.0</td>
      <td>78.0</td>
      <td>0.0</td>
      <td>203.0</td>
      <td>151.0</td>
      <td>152.0</td>
      <td>89.238236</td>
      <td>9.11456</td>
      <td>5.413692</td>
      <td>1576.0</td>
      <td>1602.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Work</th>
      <th>Treatment time</th>
      <th>Bulk 3</th>
      <th>Bulk 4</th>
      <th>Bulk 6</th>
      <th>Bulk 12</th>
      <th>Bulk 14</th>
      <th>Bulk 15</th>
      <th>Wire 1</th>
      <th>Wire 2</th>
      <th>Gas 1</th>
      <th>Starting temperature</th>
      <th>Final temperature</th>
    </tr>
    <tr>
      <th>key</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>770.282114</td>
      <td>1583.0</td>
      <td>0.0</td>
      <td>43.0</td>
      <td>0.0</td>
      <td>206.0</td>
      <td>150.0</td>
      <td>154.0</td>
      <td>60.059998</td>
      <td>0.00000</td>
      <td>29.749986</td>
      <td>1571.0</td>
      <td>1613.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>481.760005</td>
      <td>1144.0</td>
      <td>0.0</td>
      <td>73.0</td>
      <td>0.0</td>
      <td>206.0</td>
      <td>149.0</td>
      <td>154.0</td>
      <td>96.052315</td>
      <td>0.00000</td>
      <td>12.555561</td>
      <td>1581.0</td>
      <td>1602.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>722.837668</td>
      <td>1525.0</td>
      <td>0.0</td>
      <td>34.0</td>
      <td>0.0</td>
      <td>205.0</td>
      <td>152.0</td>
      <td>153.0</td>
      <td>91.160157</td>
      <td>0.00000</td>
      <td>28.554793</td>
      <td>1596.0</td>
      <td>1599.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>683.455597</td>
      <td>1093.0</td>
      <td>0.0</td>
      <td>81.0</td>
      <td>0.0</td>
      <td>207.0</td>
      <td>153.0</td>
      <td>154.0</td>
      <td>89.063515</td>
      <td>0.00000</td>
      <td>18.841219</td>
      <td>1601.0</td>
      <td>1625.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>512.169934</td>
      <td>1362.0</td>
      <td>0.0</td>
      <td>78.0</td>
      <td>0.0</td>
      <td>203.0</td>
      <td>151.0</td>
      <td>152.0</td>
      <td>89.238236</td>
      <td>9.11456</td>
      <td>5.413692</td>
      <td>1576.0</td>
      <td>1602.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let’s separate the target feature.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">target</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;Final temperature&#39;</span><span class="p">])</span>
<span class="n">features</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;Final temperature&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(2324, 12)
(2324, 1)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">target</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Final temperature</th>
    </tr>
    <tr>
      <th>key</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>1613.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1602.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1599.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1625.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1602.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="feature-study">
<h2>Feature study<a class="headerlink" href="#feature-study" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># a function to define custom boundaries of the box plot whiskers</span>
<span class="k">def</span> <span class="nf">IQR_borders</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">coef</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">skip_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">skip_zero</span><span class="p">:</span>
        <span class="n">series</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mf">0.0</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">})</span>
    
    <span class="n">IQR</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.75</span><span class="p">)</span> <span class="o">-</span> <span class="n">series</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
    <span class="n">low_border</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span> <span class="o">-</span> <span class="n">coef</span> <span class="o">*</span> <span class="n">IQR</span>
    <span class="n">top_border</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.75</span><span class="p">)</span> <span class="o">+</span> <span class="n">coef</span> <span class="o">*</span> <span class="n">IQR</span>
    
    <span class="k">if</span> <span class="n">low_border</span> <span class="o">&lt;</span> <span class="n">series</span><span class="o">.</span><span class="n">min</span><span class="p">():</span>
        <span class="n">low_border</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">top_border</span> <span class="o">&gt;</span> <span class="n">series</span><span class="o">.</span><span class="n">max</span><span class="p">():</span>
        <span class="n">top_border</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">low_border</span><span class="p">,</span> <span class="n">top_border</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Work</th>
      <th>Treatment time</th>
      <th>Bulk 3</th>
      <th>Bulk 4</th>
      <th>Bulk 6</th>
      <th>Bulk 12</th>
      <th>Bulk 14</th>
      <th>Bulk 15</th>
      <th>Wire 1</th>
      <th>Wire 2</th>
      <th>Gas 1</th>
      <th>Starting temperature</th>
    </tr>
    <tr>
      <th>key</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>770.282114</td>
      <td>1583.0</td>
      <td>0.0</td>
      <td>43.0</td>
      <td>0.0</td>
      <td>206.0</td>
      <td>150.0</td>
      <td>154.0</td>
      <td>60.059998</td>
      <td>0.00000</td>
      <td>29.749986</td>
      <td>1571.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>481.760005</td>
      <td>1144.0</td>
      <td>0.0</td>
      <td>73.0</td>
      <td>0.0</td>
      <td>206.0</td>
      <td>149.0</td>
      <td>154.0</td>
      <td>96.052315</td>
      <td>0.00000</td>
      <td>12.555561</td>
      <td>1581.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>722.837668</td>
      <td>1525.0</td>
      <td>0.0</td>
      <td>34.0</td>
      <td>0.0</td>
      <td>205.0</td>
      <td>152.0</td>
      <td>153.0</td>
      <td>91.160157</td>
      <td>0.00000</td>
      <td>28.554793</td>
      <td>1596.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>683.455597</td>
      <td>1093.0</td>
      <td>0.0</td>
      <td>81.0</td>
      <td>0.0</td>
      <td>207.0</td>
      <td>153.0</td>
      <td>154.0</td>
      <td>89.063515</td>
      <td>0.00000</td>
      <td>18.841219</td>
      <td>1601.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>512.169934</td>
      <td>1362.0</td>
      <td>0.0</td>
      <td>78.0</td>
      <td>0.0</td>
      <td>203.0</td>
      <td>151.0</td>
      <td>152.0</td>
      <td>89.238236</td>
      <td>9.11456</td>
      <td>5.413692</td>
      <td>1576.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<section id="work">
<h3>Work<a class="headerlink" href="#work" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;Work&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Work distribution&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3ff27f87a4e8d44694daf1f6c880b405abe94eb8d838e5b6ca7cf941ed459ada.png" src="_images/3ff27f87a4e8d44694daf1f6c880b405abe94eb8d838e5b6ca7cf941ed459ada.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">IQR_borders</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;Work&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(33.43020759374457, 1417.673049777378)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Work&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Work</th>
      <th>Treatment time</th>
      <th>Bulk 3</th>
      <th>Bulk 4</th>
      <th>Bulk 6</th>
      <th>Bulk 12</th>
      <th>Bulk 14</th>
      <th>Bulk 15</th>
      <th>Wire 1</th>
      <th>Wire 2</th>
      <th>Gas 1</th>
      <th>Starting temperature</th>
    </tr>
    <tr>
      <th>key</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>943</th>
      <td>33.430208</td>
      <td>61.0</td>
      <td>0.0</td>
      <td>124.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>168.105591</td>
      <td>0.000000</td>
      <td>4.144089</td>
      <td>1609.0</td>
    </tr>
    <tr>
      <th>977</th>
      <td>35.525857</td>
      <td>57.0</td>
      <td>70.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>65.098801</td>
      <td>90.087921</td>
      <td>3.143110</td>
      <td>1604.0</td>
    </tr>
    <tr>
      <th>2112</th>
      <td>41.487172</td>
      <td>125.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>25.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>33.065762</td>
      <td>0.000000</td>
      <td>5.302748</td>
      <td>1588.0</td>
    </tr>
    <tr>
      <th>1773</th>
      <td>50.454545</td>
      <td>224.0</td>
      <td>19.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>89.153992</td>
      <td>40.082642</td>
      <td>5.208462</td>
      <td>1609.0</td>
    </tr>
    <tr>
      <th>1281</th>
      <td>56.453138</td>
      <td>132.0</td>
      <td>68.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>130.057190</td>
      <td>0.000000</td>
      <td>9.467235</td>
      <td>1621.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>I don’t think the low work values are anomalies. The steel was already at a fairly high temperature when the measurements started.</p>
<p>The outliers at this upper bound will be cut off in the training sample.</p>
</section>
<section id="treatment-time">
<h3>Treatment time<a class="headerlink" href="#treatment-time" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;Treatment time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">70</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribution of treatment time&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Number of batches&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time in seconds&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/4a880410a397c8e0e7df2a84ecd227fa0f647b62858f7cdcfd0c73aba1f2c36d.png" src="_images/4a880410a397c8e0e7df2a84ecd227fa0f647b62858f7cdcfd0c73aba1f2c36d.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;Treatment time&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribution of treatment time&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b4f917261eb6df5d6bd700cd227f1dddc5efcfc439eb204bc75ceaa0ce61fea3.png" src="_images/b4f917261eb6df5d6bd700cd227f1dddc5efcfc439eb204bc75ceaa0ce61fea3.png" />
</div>
</div>
<p>There’s even more outliers here. Probably due to the long breaks.</p>
</section>
<section id="starting-temperature">
<h3>Starting temperature<a class="headerlink" href="#starting-temperature" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;Starting temperature&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>key
1       1571.0
2       1581.0
3       1596.0
4       1601.0
5       1576.0
         ...  
2495    1570.0
2496    1554.0
2497    1571.0
2498    1591.0
2499    1569.0
Name: Starting temperature, Length: 2324, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;Starting temperature&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribution of starting temperature&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/12f07ccd12c4d21245352b58d5ab2ca877801d37cef6e05978d0e3ea221f2055.png" src="_images/12f07ccd12c4d21245352b58d5ab2ca877801d37cef6e05978d0e3ea221f2055.png" />
</div>
</div>
<p>These data are more clumped. Outliers do not actually look like ones, because they exceed the whiskers only slightly. We will not exclude them from the training sample.</p>
</section>
<section id="correlation">
<h3>Correlation<a class="headerlink" href="#correlation" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">corr</span><span class="p">(),</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Feature correlation&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;First feature&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Second feature&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/12a45ed124dbf4fc4dfcdabfbe5a747ec992537052215e084892c43e0f5e48db.png" src="_images/12a45ed124dbf4fc4dfcdabfbe5a747ec992537052215e084892c43e0f5e48db.png" />
</div>
</div>
<p>Both positive and negative correlations are within acceptable limits. We’re not going to remove anything.</p>
</section>
</section>
<section id="samples">
<h2>Samples<a class="headerlink" href="#samples" title="Link to this heading">#</a></h2>
<p>Let’s split the data into training and test datasets.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features_train</span><span class="p">,</span> <span class="n">features_test</span><span class="p">,</span> <span class="n">target_train</span><span class="p">,</span> <span class="n">target_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">features</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">140823</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">features_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">features_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">target_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">target_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1743, 12)
(581, 12)
(1743, 1)
(581, 1)
</pre></div>
</div>
</div>
</div>
</section>
<section id="outliers">
<h2>Outliers<a class="headerlink" href="#outliers" title="Link to this heading">#</a></h2>
<p>Let’s remove outliers from the training sample.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features_train</span> <span class="o">=</span> <span class="n">features_train</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">features_train</span><span class="p">[</span>
    <span class="p">[</span><span class="s1">&#39;Work&#39;</span><span class="p">,</span> <span class="s1">&#39;Treatment time&#39;</span><span class="p">,</span> <span class="s1">&#39;Bulk 3&#39;</span><span class="p">,</span> <span class="s1">&#39;Bulk 4&#39;</span><span class="p">,</span> <span class="s1">&#39;Bulk 6&#39;</span><span class="p">,</span> 
     <span class="s1">&#39;Bulk 12&#39;</span><span class="p">,</span> <span class="s1">&#39;Bulk 14&#39;</span><span class="p">,</span> <span class="s1">&#39;Bulk 15&#39;</span><span class="p">,</span> <span class="s1">&#39;Wire 1&#39;</span><span class="p">,</span> <span class="s1">&#39;Wire 2&#39;</span><span class="p">,</span> <span class="s1">&#39;Gas 1&#39;</span><span class="p">]</span>
<span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">IQR_borders</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">coef</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span> <span class="n">skip_zero</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features_train</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1672, 12)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features_train</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Work</th>
      <th>Treatment time</th>
      <th>Bulk 3</th>
      <th>Bulk 4</th>
      <th>Bulk 6</th>
      <th>Bulk 12</th>
      <th>Bulk 14</th>
      <th>Bulk 15</th>
      <th>Wire 1</th>
      <th>Wire 2</th>
      <th>Gas 1</th>
      <th>Starting temperature</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>1672.000000</td>
      <td>1672.000000</td>
      <td>1672.000000</td>
      <td>1672.000000</td>
      <td>1672.000000</td>
      <td>1672.000000</td>
      <td>1672.000000</td>
      <td>1672.000000</td>
      <td>1672.000000</td>
      <td>1672.000000</td>
      <td>1672.000000</td>
      <td>1672.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>647.065630</td>
      <td>1857.608254</td>
      <td>45.992225</td>
      <td>37.212919</td>
      <td>21.754187</td>
      <td>205.908493</td>
      <td>152.068182</td>
      <td>119.890550</td>
      <td>101.917658</td>
      <td>16.339297</td>
      <td>10.852831</td>
      <td>1587.251794</td>
    </tr>
    <tr>
      <th>std</th>
      <td>280.889583</td>
      <td>805.990964</td>
      <td>72.257763</td>
      <td>58.947208</td>
      <td>53.855548</td>
      <td>149.545441</td>
      <td>78.055544</td>
      <td>83.726468</td>
      <td>42.620899</td>
      <td>30.622180</td>
      <td>5.193093</td>
      <td>23.105993</td>
    </tr>
    <tr>
      <th>min</th>
      <td>35.525857</td>
      <td>57.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.008399</td>
      <td>1520.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>444.731981</td>
      <td>1314.750000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>105.000000</td>
      <td>105.000000</td>
      <td>0.000000</td>
      <td>72.159360</td>
      <td>0.000000</td>
      <td>7.312645</td>
      <td>1571.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>615.805998</td>
      <td>1712.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>206.000000</td>
      <td>148.000000</td>
      <td>107.000000</td>
      <td>101.041198</td>
      <td>0.000000</td>
      <td>9.947561</td>
      <td>1586.500000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>818.691952</td>
      <td>2320.750000</td>
      <td>77.000000</td>
      <td>78.000000</td>
      <td>0.000000</td>
      <td>271.250000</td>
      <td>203.000000</td>
      <td>204.000000</td>
      <td>127.155593</td>
      <td>21.089379</td>
      <td>13.817779</td>
      <td>1602.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1775.756671</td>
      <td>4918.000000</td>
      <td>372.000000</td>
      <td>276.000000</td>
      <td>359.000000</td>
      <td>685.000000</td>
      <td>417.000000</td>
      <td>258.000000</td>
      <td>242.143203</td>
      <td>180.236161</td>
      <td>30.647331</td>
      <td>1660.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">target_train</span> <span class="o">=</span> <span class="n">target_train</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">features_train</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
<span class="n">target_train</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1672, 1)
</pre></div>
</div>
</div>
</div>
</section>
<section id="scaling">
<h2>Scaling<a class="headerlink" href="#scaling" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features_train</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Work</th>
      <th>Treatment time</th>
      <th>Bulk 3</th>
      <th>Bulk 4</th>
      <th>Bulk 6</th>
      <th>Bulk 12</th>
      <th>Bulk 14</th>
      <th>Bulk 15</th>
      <th>Wire 1</th>
      <th>Wire 2</th>
      <th>Gas 1</th>
      <th>Starting temperature</th>
    </tr>
    <tr>
      <th>key</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>795</th>
      <td>1293.299356</td>
      <td>2186.0</td>
      <td>92.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>377.0</td>
      <td>213.0</td>
      <td>176.0</td>
      <td>65.098801</td>
      <td>10.163919</td>
      <td>8.998206</td>
      <td>1567.0</td>
    </tr>
    <tr>
      <th>1438</th>
      <td>1036.605968</td>
      <td>3108.0</td>
      <td>294.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>186.0</td>
      <td>130.0</td>
      <td>126.0</td>
      <td>207.323990</td>
      <td>11.129040</td>
      <td>3.564328</td>
      <td>1589.0</td>
    </tr>
    <tr>
      <th>1275</th>
      <td>571.302842</td>
      <td>2009.0</td>
      <td>0.0</td>
      <td>113.0</td>
      <td>0.0</td>
      <td>230.0</td>
      <td>103.0</td>
      <td>103.0</td>
      <td>111.103203</td>
      <td>0.000000</td>
      <td>9.616335</td>
      <td>1582.0</td>
    </tr>
    <tr>
      <th>2260</th>
      <td>1712.716410</td>
      <td>3372.0</td>
      <td>0.0</td>
      <td>80.0</td>
      <td>0.0</td>
      <td>314.0</td>
      <td>197.0</td>
      <td>207.0</td>
      <td>106.142402</td>
      <td>30.129841</td>
      <td>13.817066</td>
      <td>1575.0</td>
    </tr>
    <tr>
      <th>1161</th>
      <td>172.230187</td>
      <td>1220.0</td>
      <td>167.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>110.073601</td>
      <td>0.000000</td>
      <td>5.306884</td>
      <td>1600.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Now the scaling itself.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">scaler</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features_train</span><span class="p">)</span>

<span class="n">features_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">features_train</span><span class="p">),</span> 
                              <span class="n">index</span><span class="o">=</span><span class="n">features_train</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> 
                              <span class="n">columns</span><span class="o">=</span><span class="n">features_train</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">features_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">features_test</span><span class="p">),</span> 
                             <span class="n">index</span><span class="o">=</span><span class="n">features_test</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> 
                             <span class="n">columns</span><span class="o">=</span><span class="n">features_test</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features_train</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Work</th>
      <th>Treatment time</th>
      <th>Bulk 3</th>
      <th>Bulk 4</th>
      <th>Bulk 6</th>
      <th>Bulk 12</th>
      <th>Bulk 14</th>
      <th>Bulk 15</th>
      <th>Wire 1</th>
      <th>Wire 2</th>
      <th>Gas 1</th>
      <th>Starting temperature</th>
    </tr>
    <tr>
      <th>key</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>795</th>
      <td>2.301356</td>
      <td>0.407560</td>
      <td>0.636908</td>
      <td>-0.631481</td>
      <td>-0.404057</td>
      <td>1.144419</td>
      <td>0.780855</td>
      <td>0.670352</td>
      <td>-0.864127</td>
      <td>-0.201724</td>
      <td>-0.357240</td>
      <td>-0.876736</td>
    </tr>
    <tr>
      <th>1438</th>
      <td>1.387224</td>
      <td>1.551836</td>
      <td>3.433292</td>
      <td>-0.631481</td>
      <td>-0.404057</td>
      <td>-0.133167</td>
      <td>-0.282809</td>
      <td>0.072991</td>
      <td>2.473854</td>
      <td>-0.170197</td>
      <td>-1.403919</td>
      <td>0.075683</td>
    </tr>
    <tr>
      <th>1275</th>
      <td>-0.269805</td>
      <td>0.187889</td>
      <td>-0.636693</td>
      <td>1.286062</td>
      <td>-0.404057</td>
      <td>0.161146</td>
      <td>-0.628820</td>
      <td>-0.201795</td>
      <td>0.215582</td>
      <td>-0.533737</td>
      <td>-0.238175</td>
      <td>-0.227359</td>
    </tr>
    <tr>
      <th>2260</th>
      <td>3.794977</td>
      <td>1.879481</td>
      <td>-0.636693</td>
      <td>0.726071</td>
      <td>-0.404057</td>
      <td>0.723017</td>
      <td>0.575811</td>
      <td>1.040716</td>
      <td>0.099153</td>
      <td>0.450480</td>
      <td>0.570974</td>
      <td>-0.530402</td>
    </tr>
    <tr>
      <th>1161</th>
      <td>-1.690976</td>
      <td>-0.791323</td>
      <td>1.675169</td>
      <td>-0.631481</td>
      <td>-0.404057</td>
      <td>-1.377308</td>
      <td>-1.948788</td>
      <td>-1.432360</td>
      <td>0.191417</td>
      <td>-0.533737</td>
      <td>-1.068266</td>
      <td>0.551892</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="training">
<h2>Training<a class="headerlink" href="#training" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">STATE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">140823</span><span class="p">)</span>
<span class="n">CV</span> <span class="o">=</span> <span class="mi">5</span>
</pre></div>
</div>
</div>
</div>
<section id="linear-regression">
<h3>Linear regression<a class="headerlink" href="#linear-regression" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_linear_regression</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">model_linear_regression</span><span class="p">,</span> 
                         <span class="n">features_train</span><span class="p">,</span> 
                         <span class="n">target_train</span><span class="p">,</span> 
                         <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_absolute_error&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">CV</span><span class="p">)</span>
<span class="n">scores</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-6.408858098099143
</pre></div>
</div>
</div>
</div>
</section>
<section id="elastic-net">
<h3>Elastic Net<a class="headerlink" href="#elastic-net" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">ConvergenceWarning</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">)</span>
<span class="n">model_elastic_net</span> <span class="o">=</span> <span class="n">ElasticNet</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">STATE</span><span class="p">)</span>

<span class="n">param_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> 
              <span class="s1">&#39;l1_ratio&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]}</span>
<span class="n">gsearch_elastic_net</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">model_elastic_net</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">param_dict</span><span class="p">,</span> 
                                   <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_absolute_error&#39;</span><span class="p">,</span> 
                                   <span class="n">cv</span><span class="o">=</span><span class="n">CV</span><span class="p">)</span>
<span class="n">gsearch_elastic_net</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features_train</span><span class="p">,</span> <span class="n">target_train</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">gsearch_elastic_net</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">gsearch_elastic_net</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;alpha&#39;: 0.1, &#39;l1_ratio&#39;: 0.7}
-6.390966537103227
</pre></div>
</div>
</div>
</div>
</section>
<section id="random-forest">
<h3>Random Forest<a class="headerlink" href="#random-forest" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">model_random_forest</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">STATE</span><span class="p">)</span>

<span class="n">param_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> 
              <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">501</span><span class="p">,</span> <span class="mi">100</span><span class="p">)}</span>
<span class="n">rsearch_random_forest</span> <span class="o">=</span> <span class="n">RandomizedSearchCV</span><span class="p">(</span><span class="n">model_random_forest</span><span class="p">,</span> <span class="n">param_distributions</span><span class="o">=</span><span class="n">param_dict</span><span class="p">,</span> 
                                           <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_absolute_error&#39;</span><span class="p">,</span> 
                                           <span class="n">random_state</span><span class="o">=</span><span class="n">STATE</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">CV</span><span class="p">,</span> 
                                           <span class="n">n_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">rsearch_random_forest</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features_train</span><span class="p">,</span> <span class="n">target_train</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>

<span class="nb">print</span><span class="p">(</span><span class="n">rsearch_random_forest</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rsearch_random_forest</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;n_estimators&#39;: 400, &#39;max_depth&#39;: 13}
-6.15745990761569
CPU times: user 1min 58s, sys: 658 ms, total: 1min 59s
Wall time: 1min 59s
</pre></div>
</div>
</div>
</div>
</section>
<section id="catboost">
<h3>CatBoost<a class="headerlink" href="#catboost" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">model_cat_boost</span> <span class="o">=</span> <span class="n">CatBoostRegressor</span><span class="p">(</span><span class="n">loss_function</span><span class="o">=</span><span class="s1">&#39;MAE&#39;</span><span class="p">,</span> <span class="n">logging_level</span><span class="o">=</span><span class="s1">&#39;Silent&#39;</span><span class="p">)</span>

<span class="n">param_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;iterations&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">700</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">1500</span><span class="p">],</span> 
              <span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span> 
              <span class="s1">&#39;depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> 
              <span class="s1">&#39;l2_leaf_reg&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">]}</span>
<span class="n">rsearch_cat_boost</span> <span class="o">=</span> <span class="n">RandomizedSearchCV</span><span class="p">(</span><span class="n">model_cat_boost</span><span class="p">,</span> <span class="n">param_distributions</span><span class="o">=</span><span class="n">param_dict</span><span class="p">,</span> 
                                       <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_absolute_error&#39;</span><span class="p">,</span> 
                                       <span class="n">random_state</span><span class="o">=</span><span class="n">STATE</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">CV</span><span class="p">,</span> 
                                       <span class="n">n_iter</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">rsearch_cat_boost</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features_train</span><span class="p">,</span> <span class="n">target_train</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>

<span class="nb">print</span><span class="p">(</span><span class="n">rsearch_cat_boost</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rsearch_cat_boost</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;learning_rate&#39;: 0.01, &#39;l2_leaf_reg&#39;: 1.5, &#39;iterations&#39;: 1500, &#39;depth&#39;: 5}
-6.074440345063373
CPU times: user 51min 57s, sys: 5min 22s, total: 57min 19s
Wall time: 9min 2s
</pre></div>
</div>
</div>
</div>
</section>
<section id="lightgbm">
<h3>LightGBM<a class="headerlink" href="#lightgbm" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">model_light_gbm</span> <span class="o">=</span> <span class="n">lgb</span><span class="o">.</span><span class="n">LGBMRegressor</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="s1">&#39;regression&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">STATE</span><span class="p">)</span>

<span class="n">param_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span> 
               <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">200</span><span class="p">],</span> 
               <span class="s1">&#39;colsample_bytree&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]}</span>
<span class="n">rsearch_light_gbm</span> <span class="o">=</span> <span class="n">RandomizedSearchCV</span><span class="p">(</span><span class="n">model_light_gbm</span><span class="p">,</span> <span class="n">param_distributions</span><span class="o">=</span><span class="n">param_dict</span><span class="p">,</span> 
                                       <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_absolute_error&#39;</span><span class="p">,</span> 
                                       <span class="n">random_state</span><span class="o">=</span><span class="n">STATE</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">CV</span><span class="p">,</span> 
                                       <span class="n">n_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">rsearch_light_gbm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features_train</span><span class="p">,</span> <span class="n">target_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rsearch_light_gbm</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rsearch_light_gbm</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;n_estimators&#39;: 150, &#39;learning_rate&#39;: 0.05, &#39;colsample_bytree&#39;: 0.5}
-6.226735418695158
CPU times: user 1min 23s, sys: 1.5 s, total: 1min 25s
Wall time: 10.7 s
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="results">
<h2>Results<a class="headerlink" href="#results" title="Link to this heading">#</a></h2>
<p><a id='results'></a></p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Model</p></th>
<th class="head"><p>Linear Regression</p></th>
<th class="head"><p>Elastic Net</p></th>
<th class="head"><p>Random Forest</p></th>
<th class="head"><p>CatBoost</p></th>
<th class="head"><p>LightGBM</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>MAE</p></td>
<td><p>6.41</p></td>
<td><p>6.39</p></td>
<td><p>6.16</p></td>
<td><p>6.07</p></td>
<td><p>6.23</p></td>
</tr>
<tr class="row-odd"><td><p>Hyperparameter 1</p></td>
<td><p></p></td>
<td><p>‘alpha’: 0.1</p></td>
<td><p>‘n_estimators’: 400</p></td>
<td><p>‘learning_rate’: 0.01</p></td>
<td><p>‘n_estimators’: 150</p></td>
</tr>
<tr class="row-even"><td><p>Hyperparameter 2</p></td>
<td><p></p></td>
<td><p>‘l1_ratio’: 0.7</p></td>
<td><p>‘max_depth’: 13</p></td>
<td><p>‘l2_leaf_reg’: 1.5</p></td>
<td><p>‘learning_rate’: 0.05</p></td>
</tr>
<tr class="row-odd"><td><p>Hyperparameter 3</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p>‘iterations’: 1500</p></td>
<td><p>‘colsample_bytree’: 0.5</p></td>
</tr>
<tr class="row-even"><td><p>Hyperparameter 4</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p>‘depth’: 5</p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="sanity-check">
<h2>Sanity check<a class="headerlink" href="#sanity-check" title="Link to this heading">#</a></h2>
<p>The best result was shown by CatBoost. Let’s compare it with the model that always predicts the mean or median.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_dummy_mean</span> <span class="o">=</span> <span class="n">DummyRegressor</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
<span class="n">cross_val_score</span><span class="p">(</span><span class="n">model_dummy_mean</span><span class="p">,</span> <span class="n">features_train</span><span class="p">,</span> <span class="n">target_train</span><span class="p">,</span> 
                <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_absolute_error&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-7.629712599318441
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_dummy_median</span> <span class="o">=</span> <span class="n">DummyRegressor</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;median&#39;</span><span class="p">)</span>
<span class="n">cross_val_score</span><span class="p">(</span><span class="n">model_dummy_median</span><span class="p">,</span> <span class="n">features_train</span><span class="p">,</span> <span class="n">target_train</span><span class="p">,</span> 
                <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_absolute_error&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-7.6076056841540804
</pre></div>
</div>
</div>
</div>
<p>It’s not that big of a difference. Still, CatBoost is better.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_dummy_mean</span> <span class="o">=</span> <span class="n">DummyRegressor</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
<span class="n">model_dummy_mean</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features_train</span><span class="p">,</span> <span class="n">target_train</span><span class="p">)</span>
<span class="n">predictions_test</span> <span class="o">=</span> <span class="n">model_dummy_mean</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">features_test</span><span class="p">)</span>
<span class="n">mae</span><span class="p">(</span><span class="n">target_test</span><span class="p">,</span> <span class="n">predictions_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>8.676413789127809
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_dummy_median</span> <span class="o">=</span> <span class="n">DummyRegressor</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;median&#39;</span><span class="p">)</span>
<span class="n">model_dummy_median</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features_train</span><span class="p">,</span> <span class="n">target_train</span><span class="p">)</span>
<span class="n">predictions_test</span> <span class="o">=</span> <span class="n">model_dummy_median</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">features_test</span><span class="p">)</span>
<span class="n">mae</span><span class="p">(</span><span class="n">target_test</span><span class="p">,</span> <span class="n">predictions_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>8.6592082616179
</pre></div>
</div>
</div>
</div>
</section>
<section id="analysis-of-the-feature-significance">
<h2>Analysis of the feature significance<a class="headerlink" href="#analysis-of-the-feature-significance" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">feature_importance</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rsearch_cat_boost</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">get_feature_importance</span><span class="p">(),</span> 
                                  <span class="n">index</span><span class="o">=</span><span class="n">features_train</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Significance&#39;</span><span class="p">])</span>
<span class="n">feature_importance</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Significance&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">feature_importance</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Significance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Starting temperature</th>
      <td>21.994527</td>
    </tr>
    <tr>
      <th>Work</th>
      <td>20.674584</td>
    </tr>
    <tr>
      <th>Wire 1</th>
      <td>8.671624</td>
    </tr>
    <tr>
      <th>Bulk 6</th>
      <td>7.593738</td>
    </tr>
    <tr>
      <th>Wire 2</th>
      <td>7.076232</td>
    </tr>
    <tr>
      <th>Treatment time</th>
      <td>6.457542</td>
    </tr>
    <tr>
      <th>Gas 1</th>
      <td>6.186736</td>
    </tr>
    <tr>
      <th>Bulk 12</th>
      <td>5.707024</td>
    </tr>
    <tr>
      <th>Bulk 14</th>
      <td>5.443537</td>
    </tr>
    <tr>
      <th>Bulk 15</th>
      <td>5.077020</td>
    </tr>
    <tr>
      <th>Bulk 3</th>
      <td>2.699718</td>
    </tr>
    <tr>
      <th>Bulk 4</th>
      <td>2.417719</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><a id='importance'></a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">feature_importance</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> 
         <span class="n">width</span><span class="o">=</span><span class="n">feature_importance</span><span class="p">[</span><span class="s1">&#39;Significance&#39;</span><span class="p">],</span> 
         <span class="n">color</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;Set1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">colors</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Feature significance&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Significance in percents&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Feature&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_16256/4099338863.py:4: MatplotlibDeprecationWarning: The get_cmap function was deprecated in Matplotlib 3.7 and will be removed two minor releases later. Use ``matplotlib.colormaps[name]`` or ``matplotlib.colormaps.get_cmap(obj)`` instead.
  color=plt.cm.get_cmap(&#39;Set1&#39;).colors)
</pre></div>
</div>
<img alt="_images/b659a3c343ad89d4a1656d806375c6bd919bde4f0179eb964e83bbbbbe5ae843.png" src="_images/b659a3c343ad89d4a1656d806375c6bd919bde4f0179eb964e83bbbbbe5ae843.png" />
</div>
</div>
<p>Heating work and starting temperature are noticeably in the lead.</p>
</section>
<section id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Link to this heading">#</a></h2>
<p>We train CatBoostRegressor with the selected hyperparameters on the whole training sample.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">CatBoostRegressor</span><span class="p">(</span><span class="n">loss_function</span><span class="o">=</span><span class="s1">&#39;MAE&#39;</span><span class="p">,</span> <span class="n">logging_level</span><span class="o">=</span><span class="s1">&#39;Silent&#39;</span><span class="p">,</span> 
                          <span class="n">depth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">1500</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">l2_leaf_reg</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features_train</span><span class="p">,</span> <span class="n">target_train</span><span class="p">)</span>
<span class="n">predictions_test</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">features_test</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">mae</span><span class="p">(</span><span class="n">target_test</span><span class="p">,</span> <span class="n">predictions_test</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>6.785062392433639
</pre></div>
</div>
</div>
</div>
<p>Technically, this model is already trained in the hyperparameter fitting process.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictions_test</span> <span class="o">=</span> <span class="n">rsearch_cat_boost</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">features_test</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">mae</span><span class="p">(</span><span class="n">target_test</span><span class="p">,</span> <span class="n">predictions_test</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>6.785062392433639
</pre></div>
</div>
</div>
</div>
</section>
<section id="conclusions">
<h2>Conclusions<a class="headerlink" href="#conclusions" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>The following data were used for training:</p>
<ul class="simple">
<li><p>Work calculated from both powers and heating time</p></li>
<li><p>Total treatment time for each batch</p></li>
<li><p>Volume of added bulk materials 3, 4, 6, 12, 14, 15</p></li>
<li><p>Volume of added wire materials 1 and 2</p></li>
<li><p>Data on the Gas 1 alloy purging</p></li>
<li><p>Starting temperature</p></li>
</ul>
</li>
<li><p>Several anomalies have been found in the data: negative reactive power and an implausibly low temperature of about 1200 degrees Celsius.</p></li>
<li><p>Training was performed on data without outliers (values beyond the 3rd quartile + 2.5 interquartile range), testing was performed on data with outliers.</p></li>
<li><p>The tried-and-tested models at cross-validation showed rather close values of MAE in the interval from 6.07 to 6.41. CatBoost showed the best one.</p></li>
<li><p>At testing CatBoostRegressor with selected hyperparameters showed MAE = 6.79</p></li>
<li><p>The default model, predicting always the mean value, showed MAE = 8.68.</p></li>
<li><p>From the feature importance analysis, it is observed that starting temperature and heating work are the determining features. Wire materials also contribute a lot to the prediction result. The role of bulk materials varies.</p></li>
</ol>
</section>
<section id="report">
<h2>Report<a class="headerlink" href="#report" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Comparison of the plan and work by steps</p>
<ol class="arabic simple">
<li><p>Data loading was performed without troubles.</p></li>
<li><p>The processing of missing values was also carried out accordingly.</p></li>
<li><p>An unplanned check was made for <strong>duplicates</strong>. <strong>None of them</strong> were found.</p></li>
<li><p>The defined anomalies were removed.</p></li>
<li><p>Features such as batch total heating work and total treatment time were created according to the formula below.</p></li>
<li><p>In addition to these, all of the planned attributes for bulk and wire materials data, gas purging data, as well as the data on starting and final temperatures of the alloy were taken.</p></li>
<li><p>These 13 attributes were aggregated by batch ID. Only batches for which information on all these attributes was available (after dealing with gaps) were used for training and testing.</p></li>
<li><p>The final (i.e. last measured) temperature was separated as the target feature.</p></li>
<li><p>An exploratory data analysis was performed for the 12 features used in training. Since it was necessary to identify outliers (for further exclusion from the training sample), an off-scheduled <strong>function</strong> was written  <strong>to define the boundaries</strong> beyond which numbers were considered outliers.</p></li>
<li><p>Correlation between features was also studied in a separate section. To get an illustrative picture, a heat map was constructed. The highest correlation was between bulk materials 12 and 15 (0.61).</p></li>
<li><p>The resulting data were divided into training and test sample in the ratio of 3:1. The <code class="docutils literal notranslate"><span class="pre">random_state=140823</span></code> was used in the splitting.</p></li>
<li><p>Using the function written earlier, batches with outliers were removed from the training sample. This was done for all features except starting temperature (precisely, 11 out of 12). The variation from the plan is that <strong>batches with the outliers in the numbers of total work and batch treatment time were also removed</strong>. This was not in the plan because the distributions of these features were not constructed in the primary data analysis.</p></li>
<li><p>Next, the data scaling was performed.</p></li>
<li><p>All 5 models have been successfully trained:</p>
<ul class="simple">
<li><p>Linear Regression</p></li>
<li><p>Elastic Net</p></li>
<li><p>Random Forest</p></li>
<li><p>LightGBM</p></li>
<li><p>CatBoost</p></li>
</ul>
</li>
<li><p>Once the best model (CatBoost) was selected, a comparison was made with constant models that always predicted mean and median. This was done for both the training sample (on cross-validation), and the test sample based on the training sample. In both cases, CatBoostRegressor showed higher accuracy (e.g., 6.79 to 8.66).</p></li>
<li><p>Further according to the plan was the analysis of feature importance. The greatest contribution was made by total work and starting temperature.</p></li>
<li><p>Finally, the model with optimal hyperparameters was tested.</p></li>
</ol>
</li>
<li><p>Project difficulties</p>
<ol class="arabic simple">
<li><p>There were found a lot of missing values in the temperature data. Specifically, there was no temperature data for 739 batches. This significantly reduced the amount of data for training. About 150 rows were also lost when merging features by batch ID. Unfortunately, filling the gaps with medians only deteriorated the metric, so the work was done only with 2324 objects.</p></li>
<li><p>The model overtrained on data without outliers. To improve the situation and increase the metric in testing, batches with numbers up to the 3rd quartile plus 2.5 interquartile ranges had to be added.</p></li>
</ol>
</li>
<li><p>Key solution steps</p>
<ol class="arabic simple">
<li><p>The creation of a feature such as total heating work has made a significant contribution. The first temperature measurement is also very important. Perhaps artificial creation of more features could also improve accuracy.</p></li>
<li><p>Data scaling should also have had a significant impact. Otherwise, the model could “decide” that a feature such as total treatment time was more important than others. Although the analysis of feature importance showed the opposite.</p></li>
<li><p>Removing outliers turned out to result in a low metric. Adding them, accordingly, improved the MAE.</p></li>
</ol>
</li>
<li><p>Features and their preprocessing</p>
<ol class="arabic simple">
<li><p><strong>Total work</strong> for each batch was calculated as
<span class="math notranslate nohighlight">\(\sum_{i=1}^{n} \text{Heating time}_i \cdot \sqrt{\text{Active power}_i^2 + \text{Reactive power}_i^2}\)</span><br />
, where i is the arc heating serial number and n is the number of arc heatings for the batch.</p></li>
<li><p><strong>Total treatment time</strong> for each batch was calculated as
<span class="math notranslate nohighlight">\(\text{End of heating arc}_n -  \text{Start of heating arc}_1\)</span><br />
, where n is the number of arc heatings for the batch.</p></li>
<li><p>The volumes of added bulk materials 3, 4, 6, 12, 14 and 15 and the volumes of added wire materials 1 and 2 were used. Gaps in these data were filled with zeros.</p></li>
<li><p>Batches with gaps in temperature values were removed from the temperature data. The batches with one temperature measurement were also removed. Among the remaining data for each batch, the first temperature measurement was taken as the starting temperature (so, a feature for training), whereas the last one was taken as the final temperature (the target metric).</p></li>
<li><p>The batch with negative reactive power and the batches with alloy temperature around 1200 degrees Celsius were also removed before calculating and processing the features. They were taken as anomalies.</p></li>
<li><p>The numbers characterizing gas purging did not need preprocessing.</p></li>
</ol>
</li>
<li><p>Full model description</p>
<ol class="arabic simple">
<li><p>The CatBoostRegressor model with the following hyperparameters showed the best MAE:</p>
<ul class="simple">
<li><p>‘learning_rate’: 0.01</p></li>
<li><p>‘l2_leaf_reg’: 1.5</p></li>
<li><p>‘iterations’: 1500</p></li>
<li><p>‘depth’: 5</p></li>
</ul>
</li>
<li><p>The parameter selection was done with 20 iterations of <code class="docutils literal notranslate"><span class="pre">RandomizedSearchCV</span></code>. There may be a more optimal combination.</p></li>
</ol>
</li>
<li><p>Final metric</p>
<ol class="arabic simple">
<li><p>CatBoostRegressor showed MAE = 6.79 in testing</p></li>
<li><p>In comparison, the constant model predicting the median of the training sample showed MAE = 8.66</p></li>
</ol>
</li>
<li><p>Recommendations for improving the solution</p>
<ol class="arabic simple">
<li><p>It makes sense to create more features. The feature importance analysis showed that total work plays an important role. There could be quantities that reveal this relationship.</p></li>
<li><p>Based on the test results, it can be assumed that adding outliers has a positive effect on model training. It is worth to check how the model will show itself when trained on all data.</p></li>
</ol>
</li>
</ol>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="computer_vision.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Age prediction by photo</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#steel-treatment-process">Steel treatment process</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-description">Data description</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exploratory-data-analysis">Exploratory data analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#electrode-data">Electrode data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bulk-material-feed-data-volume">Bulk material feed data (volume)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bulk-material-feed-data-time">Bulk material feed data (time)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#alloy-gas-purge-data">Alloy gas purge data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#temperature-measurement-results">Temperature measurement results</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#wire-materials-data-volume">Wire materials data (volume)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#wire-materials-data-time">Wire materials data (time)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plan">Plan</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preprocessing">Data preprocessing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-types">Data Types</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#missing-values">Missing values</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#duplicates">Duplicates</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#anomalies">Anomalies</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-creation">Feature creation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-study">Feature study</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#work">Work</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#treatment-time">Treatment time</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#starting-temperature">Starting temperature</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#correlation">Correlation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#samples">Samples</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#outliers">Outliers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#scaling">Scaling</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#training">Training</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-regression">Linear regression</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#elastic-net">Elastic Net</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#random-forest">Random Forest</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#catboost">CatBoost</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lightgbm">LightGBM</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#results">Results</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sanity-check">Sanity check</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-of-the-feature-significance">Analysis of the feature significance</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing">Testing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusions">Conclusions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#report">Report</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Leonid Dybovskii
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>