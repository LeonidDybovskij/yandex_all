
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Gold recovery &#8212; Data Science course</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'gold_recovery';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Protection of customers’ personal data" href="data_transformation.html" />
    <link rel="prev" title="Selection of a location for a well" href="oil_bootstrap.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
  
    <p class="title logo__title">Data Science course</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Data Science course
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="credit_scoring.html">Credit scoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="real_estate_market_analysis.html">Real estate market analysis in St. Petersburg</a></li>
<li class="toctree-l1"><a class="reference internal" href="tariff_stats.html">Tariff statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="computer_games.html">Analysis of the computer games market</a></li>
<li class="toctree-l1"><a class="reference internal" href="tariff_recommendation.html">Tariff recommendation</a></li>
<li class="toctree-l1"><a class="reference internal" href="supervised_classification.html">Customer churn</a></li>
<li class="toctree-l1"><a class="reference internal" href="oil_bootstrap.html">Selection of a location for a well</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Gold recovery</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_transformation.html">Protection of customers’ personal data</a></li>
<li class="toctree-l1"><a class="reference internal" href="cars_boosting.html">Cars cost determination</a></li>
<li class="toctree-l1"><a class="reference internal" href="taxi_time_series.html">Taxi orders prediction</a></li>
<li class="toctree-l1"><a class="reference internal" href="text_classification.html">Classification of comments</a></li>
<li class="toctree-l1"><a class="reference internal" href="computer_vision.html">Age prediction by photo</a></li>
<li class="toctree-l1"><a class="reference internal" href="regression_metallurgy.html">Steel temperature prediction</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/gold_recovery.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Gold recovery</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#task-information">Task information</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#technological-process">Technological process</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#efficiency-calculation">Efficiency calculation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-metric">Quality Metric</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-structure">Data structure</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#functions">Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preprocessing">Data preprocessing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#samples">Samples</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-types">Data Types</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#missing-values">Missing values</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#duplicates">Duplicates</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-selection">Feature selection</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#scaling">Scaling</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exploratory-data-analysis">Exploratory data analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#concentrations-of-metals-at-different-stages">Concentrations of metals at different stages.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#comparison-of-training-and-test-samples">Comparison of training and test samples</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#training">Training</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-regression">Linear Regression.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#decision-tree">Decision Tree</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#random-forest">Random Forest</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sanity-check">Sanity check</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing">Testing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusions">Conclusions</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="gold-recovery">
<h1>Gold recovery<a class="headerlink" href="#gold-recovery" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">xgboost</span> <span class="k">as</span> <span class="nn">xgb</span>
<span class="kn">import</span> <span class="nn">lightgbm</span> <span class="k">as</span> <span class="nn">lgb</span>

<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">interpolate</span>

<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">make_scorer</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span> <span class="k">as</span> <span class="n">mae</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span><span class="p">,</span> <span class="n">cross_val_score</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_validate</span><span class="p">,</span> <span class="n">LeaveOneOut</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span><span class="p">,</span> <span class="n">RandomizedSearchCV</span>

<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span><span class="p">,</span> <span class="n">Lasso</span><span class="p">,</span> <span class="n">ElasticNet</span><span class="p">,</span> <span class="n">BayesianRidge</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span> 
<span class="kn">from</span> <span class="nn">sklearn.dummy</span> <span class="kn">import</span> <span class="n">DummyRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">AdaBoostRegressor</span><span class="p">,</span> <span class="n">GradientBoostingRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.kernel_ridge</span> <span class="kn">import</span> <span class="n">KernelRidge</span>
<span class="kn">from</span> <span class="nn">catboost</span> <span class="kn">import</span> <span class="n">CatBoostRegressor</span>
<span class="c1"># from keras.models import Sequential</span>
<span class="c1"># from keras.layers import Dense</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">57</span><span class="p">)</span>
<span class="c1"># STATE = np.random.RandomState(57)</span>
</pre></div>
</div>
</div>
</div>
<section id="task-information">
<h2>Task information<a class="headerlink" href="#task-information" title="Link to this heading">#</a></h2>
<p>The project is provided by the company <a class="reference external" href="http://zyfra.com/">“Zyfra”</a>.</p>
<p>The requirement is to build a model that will predict the recovery rate of gold from gold bearing ore.</p>
<p>This will allow optimization of production so that the enterprise is not started with unprofitable characteristics.</p>
<section id="technological-process">
<h3>Technological process<a class="headerlink" href="#technological-process" title="Link to this heading">#</a></h3>
<p>Let’s study the process of gold recovery from ore.</p>
<p>When the mined ore undergoes primary processing, a crushed mixture is obtained. It is sent for flotation (beneficiation) and two stages of purification.</p>
<ol class="arabic simple">
<li><p>Flotation</p></li>
</ol>
<p>A <strong>mixture of gold bearing ore</strong> is fed into a flotation plant. After beneficiation, <strong>rougher concentrate</strong> and <strong>«tailings»</strong> are obtained. The latter is a residual product with low concentration of valuable metals.</p>
<p>The stability of this process is affected by the <ins>inconsistent and suboptimal physical and chemical state of the flotation slurry</ins> (a mixture of solids and liquid).</p>
<ol class="arabic simple" start="2">
<li><p>Cleaning</p></li>
</ol>
<p>The rougher concentrate undergoes two purifications. The output is <strong>final concentrate</strong> and <strong>new tailings</strong>.</p>
</section>
<section id="efficiency-calculation">
<h3>Efficiency calculation<a class="headerlink" href="#efficiency-calculation" title="Link to this heading">#</a></h3>
<p>Recovery efficiency is calculated by the formula: <a id='formula'></a></p>
<div class="math notranslate nohighlight">
\[
\text{Recovery} = \dfrac{C \times (F - T)}{F \times (C - T)} \times 100\text{%}
\]</div>
<p>where</p>
<ul class="simple">
<li><p>C — gold fraction in concentrate after flotation/cleaning</p></li>
<li><p>F — gold fraction in raw material/concentrate before flotation/cleaning</p></li>
<li><p>T — gold fraction in tailings after flotation/cleaning</p></li>
</ul>
<p>This coefficient can be calculated for both final concentrate and rougher concentrate.</p>
</section>
<section id="quality-metric">
<h3>Quality Metric<a class="headerlink" href="#quality-metric" title="Link to this heading">#</a></h3>
<p>To assess the quality of the model, we can use <ins>Symmetric Mean Absolute Percentage Error</ins> (<strong>sMAPE</strong>):</p>
<div class="math notranslate nohighlight">
\[
sMAPE = \dfrac{1}{N} \sum \limits_{i = 1}^{N} \dfrac{|y_i - \hat{y_i}|}{(|y_i| + |\hat{y_i}|)/2} \times 100 \text{%}
\]</div>
<p>where</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(y_i\)</span> — value of the target attribute for the object with serial number <span class="math notranslate nohighlight">\(i\)</span> in the sample on which quality is measured</p></li>
<li><p><span class="math notranslate nohighlight">\(\widehat{y_i}\)</span> — prediction value for the object with serial number <span class="math notranslate nohighlight">\(i\)</span>, for example, in a test sample</p></li>
<li><p><span class="math notranslate nohighlight">\(N\)</span> — number of objects in the sample</p></li>
</ul>
<p>The cumulative deviation is calculated from two values:</p>
<div class="math notranslate nohighlight">
\[
\text{Final sMAPE} = 25 \text{%} \times sMAPE(rougher) + 75 \text{%} \times \text{sMAPE(final)}
\]</div>
<p>where</p>
<ul class="simple">
<li><p>sMAPE(rougher) — beneficiation efficiency of rougher concentrate</p></li>
<li><p>sMAPE(final) — beneficiation efficiency of final concentrate</p></li>
</ul>
</section>
<section id="data-structure">
<h3>Data structure<a class="headerlink" href="#data-structure" title="Link to this heading">#</a></h3>
<p>Data with extraction and purification parameters are available.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">data_full</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;gold_recovery_full_new.csv&#39;</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">data_full</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/datasets/gold_recovery_full_new.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_full</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 19439 entries, 0 to 19438
Data columns (total 87 columns):
 #   Column                                              Non-Null Count  Dtype  
---  ------                                              --------------  -----  
 0   date                                                19439 non-null  object 
 1   final.output.concentrate_ag                         19438 non-null  float64
 2   final.output.concentrate_pb                         19438 non-null  float64
 3   final.output.concentrate_sol                        19228 non-null  float64
 4   final.output.concentrate_au                         19439 non-null  float64
 5   final.output.recovery                               19439 non-null  float64
 6   final.output.tail_ag                                19438 non-null  float64
 7   final.output.tail_pb                                19338 non-null  float64
 8   final.output.tail_sol                               19433 non-null  float64
 9   final.output.tail_au                                19439 non-null  float64
 10  primary_cleaner.input.sulfate                       19415 non-null  float64
 11  primary_cleaner.input.depressant                    19402 non-null  float64
 12  primary_cleaner.input.feed_size                     19439 non-null  float64
 13  primary_cleaner.input.xanthate                      19335 non-null  float64
 14  primary_cleaner.output.concentrate_ag               19439 non-null  float64
 15  primary_cleaner.output.concentrate_pb               19323 non-null  float64
 16  primary_cleaner.output.concentrate_sol              19069 non-null  float64
 17  primary_cleaner.output.concentrate_au               19439 non-null  float64
 18  primary_cleaner.output.tail_ag                      19435 non-null  float64
 19  primary_cleaner.output.tail_pb                      19418 non-null  float64
 20  primary_cleaner.output.tail_sol                     19377 non-null  float64
 21  primary_cleaner.output.tail_au                      19439 non-null  float64
 22  primary_cleaner.state.floatbank8_a_air              19435 non-null  float64
 23  primary_cleaner.state.floatbank8_a_level            19438 non-null  float64
 24  primary_cleaner.state.floatbank8_b_air              19435 non-null  float64
 25  primary_cleaner.state.floatbank8_b_level            19438 non-null  float64
 26  primary_cleaner.state.floatbank8_c_air              19437 non-null  float64
 27  primary_cleaner.state.floatbank8_c_level            19438 non-null  float64
 28  primary_cleaner.state.floatbank8_d_air              19436 non-null  float64
 29  primary_cleaner.state.floatbank8_d_level            19438 non-null  float64
 30  rougher.calculation.sulfate_to_au_concentrate       19437 non-null  float64
 31  rougher.calculation.floatbank10_sulfate_to_au_feed  19437 non-null  float64
 32  rougher.calculation.floatbank11_sulfate_to_au_feed  19437 non-null  float64
 33  rougher.calculation.au_pb_ratio                     19439 non-null  float64
 34  rougher.input.feed_ag                               19439 non-null  float64
 35  rougher.input.feed_pb                               19339 non-null  float64
 36  rougher.input.feed_rate                             19428 non-null  float64
 37  rougher.input.feed_size                             19294 non-null  float64
 38  rougher.input.feed_sol                              19340 non-null  float64
 39  rougher.input.feed_au                               19439 non-null  float64
 40  rougher.input.floatbank10_sulfate                   19405 non-null  float64
 41  rougher.input.floatbank10_xanthate                  19431 non-null  float64
 42  rougher.input.floatbank11_sulfate                   19395 non-null  float64
 43  rougher.input.floatbank11_xanthate                  18986 non-null  float64
 44  rougher.output.concentrate_ag                       19439 non-null  float64
 45  rougher.output.concentrate_pb                       19439 non-null  float64
 46  rougher.output.concentrate_sol                      19416 non-null  float64
 47  rougher.output.concentrate_au                       19439 non-null  float64
 48  rougher.output.recovery                             19439 non-null  float64
 49  rougher.output.tail_ag                              19438 non-null  float64
 50  rougher.output.tail_pb                              19439 non-null  float64
 51  rougher.output.tail_sol                             19439 non-null  float64
 52  rougher.output.tail_au                              19439 non-null  float64
 53  rougher.state.floatbank10_a_air                     19438 non-null  float64
 54  rougher.state.floatbank10_a_level                   19438 non-null  float64
 55  rougher.state.floatbank10_b_air                     19438 non-null  float64
 56  rougher.state.floatbank10_b_level                   19438 non-null  float64
 57  rougher.state.floatbank10_c_air                     19438 non-null  float64
 58  rougher.state.floatbank10_c_level                   19438 non-null  float64
 59  rougher.state.floatbank10_d_air                     19439 non-null  float64
 60  rougher.state.floatbank10_d_level                   19439 non-null  float64
 61  rougher.state.floatbank10_e_air                     19003 non-null  float64
 62  rougher.state.floatbank10_e_level                   19439 non-null  float64
 63  rougher.state.floatbank10_f_air                     19439 non-null  float64
 64  rougher.state.floatbank10_f_level                   19439 non-null  float64
 65  secondary_cleaner.output.tail_ag                    19437 non-null  float64
 66  secondary_cleaner.output.tail_pb                    19427 non-null  float64
 67  secondary_cleaner.output.tail_sol                   17691 non-null  float64
 68  secondary_cleaner.output.tail_au                    19439 non-null  float64
 69  secondary_cleaner.state.floatbank2_a_air            19219 non-null  float64
 70  secondary_cleaner.state.floatbank2_a_level          19438 non-null  float64
 71  secondary_cleaner.state.floatbank2_b_air            19416 non-null  float64
 72  secondary_cleaner.state.floatbank2_b_level          19438 non-null  float64
 73  secondary_cleaner.state.floatbank3_a_air            19426 non-null  float64
 74  secondary_cleaner.state.floatbank3_a_level          19438 non-null  float64
 75  secondary_cleaner.state.floatbank3_b_air            19438 non-null  float64
 76  secondary_cleaner.state.floatbank3_b_level          19438 non-null  float64
 77  secondary_cleaner.state.floatbank4_a_air            19433 non-null  float64
 78  secondary_cleaner.state.floatbank4_a_level          19438 non-null  float64
 79  secondary_cleaner.state.floatbank4_b_air            19438 non-null  float64
 80  secondary_cleaner.state.floatbank4_b_level          19438 non-null  float64
 81  secondary_cleaner.state.floatbank5_a_air            19438 non-null  float64
 82  secondary_cleaner.state.floatbank5_a_level          19438 non-null  float64
 83  secondary_cleaner.state.floatbank5_b_air            19438 non-null  float64
 84  secondary_cleaner.state.floatbank5_b_level          19438 non-null  float64
 85  secondary_cleaner.state.floatbank6_a_air            19437 non-null  float64
 86  secondary_cleaner.state.floatbank6_a_level          19438 non-null  float64
dtypes: float64(86), object(1)
memory usage: 12.9+ MB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_full</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>final.output.concentrate_ag</th>
      <th>final.output.concentrate_pb</th>
      <th>final.output.concentrate_sol</th>
      <th>final.output.concentrate_au</th>
      <th>final.output.recovery</th>
      <th>final.output.tail_ag</th>
      <th>final.output.tail_pb</th>
      <th>final.output.tail_sol</th>
      <th>final.output.tail_au</th>
      <th>...</th>
      <th>secondary_cleaner.state.floatbank4_a_air</th>
      <th>secondary_cleaner.state.floatbank4_a_level</th>
      <th>secondary_cleaner.state.floatbank4_b_air</th>
      <th>secondary_cleaner.state.floatbank4_b_level</th>
      <th>secondary_cleaner.state.floatbank5_a_air</th>
      <th>secondary_cleaner.state.floatbank5_a_level</th>
      <th>secondary_cleaner.state.floatbank5_b_air</th>
      <th>secondary_cleaner.state.floatbank5_b_level</th>
      <th>secondary_cleaner.state.floatbank6_a_air</th>
      <th>secondary_cleaner.state.floatbank6_a_level</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2016-01-15 00:00:00</td>
      <td>6.055403</td>
      <td>9.889648</td>
      <td>5.507324</td>
      <td>42.192020</td>
      <td>70.541216</td>
      <td>10.411962</td>
      <td>0.895447</td>
      <td>16.904297</td>
      <td>2.143149</td>
      <td>...</td>
      <td>14.016835</td>
      <td>-502.488007</td>
      <td>12.099931</td>
      <td>-504.715942</td>
      <td>9.925633</td>
      <td>-498.310211</td>
      <td>8.079666</td>
      <td>-500.470978</td>
      <td>14.151341</td>
      <td>-605.841980</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2016-01-15 01:00:00</td>
      <td>6.029369</td>
      <td>9.968944</td>
      <td>5.257781</td>
      <td>42.701629</td>
      <td>69.266198</td>
      <td>10.462676</td>
      <td>0.927452</td>
      <td>16.634514</td>
      <td>2.224930</td>
      <td>...</td>
      <td>13.992281</td>
      <td>-505.503262</td>
      <td>11.950531</td>
      <td>-501.331529</td>
      <td>10.039245</td>
      <td>-500.169983</td>
      <td>7.984757</td>
      <td>-500.582168</td>
      <td>13.998353</td>
      <td>-599.787184</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2016-01-15 02:00:00</td>
      <td>6.055926</td>
      <td>10.213995</td>
      <td>5.383759</td>
      <td>42.657501</td>
      <td>68.116445</td>
      <td>10.507046</td>
      <td>0.953716</td>
      <td>16.208849</td>
      <td>2.257889</td>
      <td>...</td>
      <td>14.015015</td>
      <td>-502.520901</td>
      <td>11.912783</td>
      <td>-501.133383</td>
      <td>10.070913</td>
      <td>-500.129135</td>
      <td>8.013877</td>
      <td>-500.517572</td>
      <td>14.028663</td>
      <td>-601.427363</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2016-01-15 03:00:00</td>
      <td>6.047977</td>
      <td>9.977019</td>
      <td>4.858634</td>
      <td>42.689819</td>
      <td>68.347543</td>
      <td>10.422762</td>
      <td>0.883763</td>
      <td>16.532835</td>
      <td>2.146849</td>
      <td>...</td>
      <td>14.036510</td>
      <td>-500.857308</td>
      <td>11.999550</td>
      <td>-501.193686</td>
      <td>9.970366</td>
      <td>-499.201640</td>
      <td>7.977324</td>
      <td>-500.255908</td>
      <td>14.005551</td>
      <td>-599.996129</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2016-01-15 04:00:00</td>
      <td>6.148599</td>
      <td>10.142511</td>
      <td>4.939416</td>
      <td>42.774141</td>
      <td>66.927016</td>
      <td>10.360302</td>
      <td>0.792826</td>
      <td>16.525686</td>
      <td>2.055292</td>
      <td>...</td>
      <td>14.027298</td>
      <td>-499.838632</td>
      <td>11.953070</td>
      <td>-501.053894</td>
      <td>9.925709</td>
      <td>-501.686727</td>
      <td>7.894242</td>
      <td>-500.356035</td>
      <td>13.996647</td>
      <td>-601.496691</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 87 columns</p>
</div></div></div>
</div>
<p>Here are the data describing</p>
<ol class="arabic simple">
<li><p>Technological process</p></li>
</ol>
<ul class="simple">
<li><p>Rougher feed — feedstock</p></li>
<li><p>Rougher additions (or reagent additions) — flotation reagents:</p>
<ul>
<li><p>Xanthate — xanthogenate (promoter, or flotation activator)</p></li>
<li><p>Sulphate — sulphate (in this production sodium sulphide)</p></li>
<li><p>Depressant — depressant (sodium silicate)</p></li>
</ul>
</li>
<li><p>Rougher process — flotation</p></li>
<li><p>Rougher tails — tailings</p></li>
<li><p>Float banks — flotation plant</p></li>
<li><p>Cleaner process — cleaning</p></li>
<li><p>Rougher Au — rougher gold concentrate</p></li>
<li><p>Final Au — final gold concentrate</p></li>
</ul>
<ol class="arabic simple" start="2">
<li><p>Parameters of stages</p></li>
</ol>
<ul class="simple">
<li><p>air amount — air volume</p></li>
<li><p>fluid levels — fluid level</p></li>
<li><p>feed size — raw material pellet size</p></li>
<li><p>feed rate — feed rate</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features_names</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data_full</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;feature&#39;</span><span class="p">)</span>
<span class="n">features_names</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0                                           date
1                    final.output.concentrate_ag
2                    final.output.concentrate_pb
3                   final.output.concentrate_sol
4                    final.output.concentrate_au
                         ...                    
82    secondary_cleaner.state.floatbank5_a_level
83      secondary_cleaner.state.floatbank5_b_air
84    secondary_cleaner.state.floatbank5_b_level
85      secondary_cleaner.state.floatbank6_a_air
86    secondary_cleaner.state.floatbank6_a_level
Name: feature, Length: 87, dtype: object
</pre></div>
</div>
</div>
</div>
<p>The name of the attributes has the following structure: <code class="docutils literal notranslate"><span class="pre">stage.parameter_type.parameter_name</span></code>.</p>
<p>Stages:</p>
<ul class="simple">
<li><p>rougher — flotation</p></li>
<li><p>primary_cleaner — primary cleaning</p></li>
<li><p>secondary_cleaner — secondary cleaning</p></li>
<li><p>final — final characteristics</p></li>
</ul>
<p>Parameter types:</p>
<ul class="simple">
<li><p>input — raw material parameters</p></li>
<li><p>output — product parameters</p></li>
<li><p>state — parameters characterizing the current state of the stage</p></li>
<li><p>calculation — calculation characteristics</p></li>
</ul>
<p>Parameter names can be as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">parameters</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">features_names</span><span class="p">:</span>
    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">parameters</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;parameters&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0                   date
1         concentrate_ag
2         concentrate_pb
3        concentrate_sol
4         concentrate_au
             ...        
82    floatbank5_a_level
83      floatbank5_b_air
84    floatbank5_b_level
85      floatbank6_a_air
86    floatbank6_a_level
Name: parameters, Length: 87, dtype: object
65
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_full</span><span class="p">[[</span><span class="s1">&#39;final.output.tail_au&#39;</span><span class="p">,</span> <span class="s1">&#39;secondary_cleaner.output.tail_au&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>final.output.tail_au</th>
      <th>secondary_cleaner.output.tail_au</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2.143149</td>
      <td>2.606185</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2.224930</td>
      <td>2.488248</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2.257889</td>
      <td>2.458187</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2.146849</td>
      <td>2.322062</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2.055292</td>
      <td>2.330448</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>It is not really clear why there are more tailings after secondary treatment than overall.</p>
</section>
</section>
<section id="functions">
<h2>Functions<a class="headerlink" href="#functions" title="Link to this heading">#</a></h2>
<p>Let’s calculate the <a class="reference internal" href="#formula"><span class="xref myst">recovery</span></a>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">recovery</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">stage</span><span class="o">=</span><span class="s1">&#39;final&#39;</span><span class="p">):</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">stage</span> <span class="o">+</span> <span class="s1">&#39;.output.concentrate_au&#39;</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">stage</span> <span class="o">+</span> <span class="s1">&#39;.output.tail_au&#39;</span>
    <span class="k">if</span> <span class="n">stage</span> <span class="o">==</span> <span class="s1">&#39;rougher&#39;</span><span class="p">:</span>
        <span class="n">F</span> <span class="o">=</span> <span class="s1">&#39;rougher.input.feed_au&#39;</span>
    <span class="k">elif</span> <span class="n">stage</span> <span class="o">==</span> <span class="s1">&#39;primary_cleaner&#39;</span><span class="p">:</span>
        <span class="n">F</span> <span class="o">=</span> <span class="s1">&#39;rougher.output.concentrate_au&#39;</span>
    <span class="k">elif</span> <span class="n">stage</span> <span class="o">==</span> <span class="s1">&#39;secondary_cleaner&#39;</span><span class="ow">or</span> <span class="n">stage</span> <span class="o">==</span> <span class="s1">&#39;final&#39;</span><span class="p">:</span>
        <span class="n">C</span> <span class="o">=</span> <span class="s1">&#39;final.output.concentrate_au&#39;</span>
        <span class="n">F</span> <span class="o">=</span> <span class="s1">&#39;primary_cleaner.output.concentrate_au&#39;</span>
        <span class="n">T</span> <span class="o">=</span> <span class="s1">&#39;final.output.tail_au&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Stage is incorrect&#39;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">((</span>
        <span class="n">dataset</span><span class="p">[</span><span class="n">C</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="n">F</span><span class="p">]</span> <span class="o">-</span> <span class="n">dataset</span><span class="p">[</span><span class="n">T</span><span class="p">])</span>
    <span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
        <span class="n">dataset</span><span class="p">[</span><span class="n">F</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="n">C</span><span class="p">]</span> <span class="o">-</span> <span class="n">dataset</span><span class="p">[</span><span class="n">T</span><span class="p">])</span>
    <span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;recovery&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">recovery</span><span class="p">(</span><span class="n">data_full</span><span class="p">,</span> <span class="n">stage</span><span class="o">=</span><span class="s1">&#39;rougher&#39;</span><span class="p">),</span> 
           <span class="n">data_full</span><span class="p">[</span><span class="s1">&#39;rougher.output.recovery&#39;</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>recovery</th>
      <th>rougher.output.recovery</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>87.107763</td>
      <td>87.107763</td>
    </tr>
    <tr>
      <th>1</th>
      <td>86.843261</td>
      <td>86.843261</td>
    </tr>
    <tr>
      <th>2</th>
      <td>86.842308</td>
      <td>86.842308</td>
    </tr>
    <tr>
      <th>3</th>
      <td>87.226430</td>
      <td>87.226430</td>
    </tr>
    <tr>
      <th>4</th>
      <td>86.688794</td>
      <td>86.688794</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>19434</th>
      <td>89.574376</td>
      <td>89.574376</td>
    </tr>
    <tr>
      <th>19435</th>
      <td>87.724007</td>
      <td>87.724007</td>
    </tr>
    <tr>
      <th>19436</th>
      <td>88.890579</td>
      <td>88.890579</td>
    </tr>
    <tr>
      <th>19437</th>
      <td>89.858126</td>
      <td>89.858126</td>
    </tr>
    <tr>
      <th>19438</th>
      <td>89.514960</td>
      <td>89.514960</td>
    </tr>
  </tbody>
</table>
<p>19439 rows × 2 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">mae</span><span class="p">(</span><span class="n">data_full</span><span class="p">[</span><span class="s1">&#39;rougher.output.recovery&#39;</span><span class="p">],</span> <span class="n">recovery</span><span class="p">(</span><span class="n">data_full</span><span class="p">,</span> <span class="n">stage</span><span class="o">=</span><span class="s1">&#39;rougher&#39;</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>9.874045668302637e-15
</pre></div>
</div>
</div>
</div>
<p>The error occurs because Python stores fractional numbers in decimal form.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">smape</span><span class="p">(</span><span class="n">tar</span><span class="p">,</span> <span class="n">pred</span><span class="p">):</span>
    <span class="n">tar</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">tar</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tar</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">pred</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">tar</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span> 
            <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">tar</span> <span class="o">-</span> <span class="n">pred</span><span class="p">)</span>
        <span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">tar</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">pred</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Length is not equal&#39;</span><span class="p">)</span>
        
<span class="n">smape_scorer</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;r2&#39;</span><span class="p">:</span> <span class="s1">&#39;r2&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;smape&#39;</span><span class="p">:</span> <span class="n">make_scorer</span><span class="p">(</span><span class="n">smape</span><span class="p">,</span> <span class="n">greater_is_better</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plant_a_tree</span><span class="p">(</span><span class="n">ft_train</span><span class="p">,</span> <span class="n">tg_train</span><span class="p">):</span>
    <span class="n">best_model</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">best_depth</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">best_scores</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;test_smape&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">100</span><span class="p">])}</span>
        
    <span class="k">for</span> <span class="n">depth</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">):</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">DecisionTreeRegressor</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="n">depth</span><span class="p">)</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">ft_train</span><span class="p">,</span> <span class="n">tg_train</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">smape_scorer</span><span class="p">)</span>
        <span class="c1"># print(scores[&#39;test_smape&#39;].mean())</span>
        <span class="k">if</span> <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;test_smape&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">best_scores</span><span class="p">[</span><span class="s1">&#39;test_smape&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">():</span>
            <span class="n">best_model</span> <span class="o">=</span> <span class="n">model</span>
            <span class="n">best_depth</span> <span class="o">=</span> <span class="n">depth</span>
            <span class="n">best_scores</span> <span class="o">=</span> <span class="n">scores</span>
            
    <span class="k">return</span> <span class="n">best_model</span><span class="p">,</span> <span class="n">best_scores</span><span class="p">,</span> <span class="n">best_depth</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plant_a_forest</span><span class="p">(</span><span class="n">ft_train</span><span class="p">,</span> <span class="n">tg_train</span><span class="p">):</span>
    <span class="n">best_model</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">best_scores</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;test_smape&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">100</span><span class="p">])}</span>
    <span class="n">best_depth</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">best_est</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">depth</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">7</span><span class="p">):</span>
        <span class="n">best_est_model</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">best_est_scores</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;test_smape&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">100</span><span class="p">])}</span>
        <span class="n">best_est_est</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">est</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">20</span><span class="p">):</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">est</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="n">depth</span><span class="p">)</span>
            <span class="n">scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">ft_train</span><span class="p">,</span> <span class="n">tg_train</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">smape_scorer</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;test_smape&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">best_est_scores</span><span class="p">[</span><span class="s1">&#39;test_smape&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">():</span>
                <span class="n">best_est_model</span> <span class="o">=</span> <span class="n">model</span>
                <span class="n">best_est_scores</span> <span class="o">=</span> <span class="n">scores</span>
                <span class="n">best_est_est</span> <span class="o">=</span> <span class="n">est</span>
        <span class="k">if</span> <span class="n">best_est_scores</span><span class="p">[</span><span class="s1">&#39;test_smape&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">best_scores</span><span class="p">[</span><span class="s1">&#39;test_smape&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">():</span>
            <span class="n">best_model</span> <span class="o">=</span> <span class="n">best_est_model</span>
            <span class="n">best_scores</span> <span class="o">=</span> <span class="n">best_est_scores</span>
            <span class="n">best_est</span> <span class="o">=</span> <span class="n">best_est_est</span>
            <span class="n">best_depth</span> <span class="o">=</span> <span class="n">depth</span>
    <span class="k">return</span> <span class="n">best_model</span><span class="p">,</span> <span class="n">best_scores</span><span class="p">,</span> <span class="n">best_depth</span><span class="p">,</span> <span class="n">best_est</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="data-preprocessing">
<h2>Data preprocessing<a class="headerlink" href="#data-preprocessing" title="Link to this heading">#</a></h2>
<p>Let’s look at the proposed data.</p>
<section id="samples">
<h3>Samples<a class="headerlink" href="#samples" title="Link to this heading">#</a></h3>
<p>The following sampling breakdown is suggested:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">data_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;gold_recovery_train_new.csv&#39;</span><span class="p">)</span>
    <span class="n">data_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;gold_recovery_test_new.csv&#39;</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">data_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/datasets/gold_recovery_train_new.csv&#39;</span><span class="p">)</span>
    <span class="n">data_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/datasets/gold_recovery_test_new.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">data_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(14149, 87)
(5290, 53)
</pre></div>
</div>
</div>
</div>
<p>Looks like the test sample was given without the target feature. I wonder what was excluded.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">features_names</span><span class="p">[</span><span class="o">~</span><span class="n">features_names</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">data_test</span><span class="o">.</span><span class="n">columns</span><span class="p">)])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1                           final.output.concentrate_ag
2                           final.output.concentrate_pb
3                          final.output.concentrate_sol
4                           final.output.concentrate_au
5                                 final.output.recovery
6                                  final.output.tail_ag
7                                  final.output.tail_pb
8                                 final.output.tail_sol
9                                  final.output.tail_au
14                primary_cleaner.output.concentrate_ag
15                primary_cleaner.output.concentrate_pb
16               primary_cleaner.output.concentrate_sol
17                primary_cleaner.output.concentrate_au
18                       primary_cleaner.output.tail_ag
19                       primary_cleaner.output.tail_pb
20                      primary_cleaner.output.tail_sol
21                       primary_cleaner.output.tail_au
30        rougher.calculation.sulfate_to_au_concentrate
31    rougher.calculation.floatbank10_sulfate_to_au_...
32    rougher.calculation.floatbank11_sulfate_to_au_...
33                      rougher.calculation.au_pb_ratio
44                        rougher.output.concentrate_ag
45                        rougher.output.concentrate_pb
46                       rougher.output.concentrate_sol
47                        rougher.output.concentrate_au
48                              rougher.output.recovery
49                               rougher.output.tail_ag
50                               rougher.output.tail_pb
51                              rougher.output.tail_sol
52                               rougher.output.tail_au
65                     secondary_cleaner.output.tail_ag
66                     secondary_cleaner.output.tail_pb
67                    secondary_cleaner.output.tail_sol
68                     secondary_cleaner.output.tail_au
Name: feature, dtype: object
</pre></div>
</div>
</div>
</div>
<p>For comparison:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_full</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 19439 entries, 0 to 19438
Data columns (total 87 columns):
 #   Column                                              Non-Null Count  Dtype  
---  ------                                              --------------  -----  
 0   date                                                19439 non-null  object 
 1   final.output.concentrate_ag                         19438 non-null  float64
 2   final.output.concentrate_pb                         19438 non-null  float64
 3   final.output.concentrate_sol                        19228 non-null  float64
 4   final.output.concentrate_au                         19439 non-null  float64
 5   final.output.recovery                               19439 non-null  float64
 6   final.output.tail_ag                                19438 non-null  float64
 7   final.output.tail_pb                                19338 non-null  float64
 8   final.output.tail_sol                               19433 non-null  float64
 9   final.output.tail_au                                19439 non-null  float64
 10  primary_cleaner.input.sulfate                       19415 non-null  float64
 11  primary_cleaner.input.depressant                    19402 non-null  float64
 12  primary_cleaner.input.feed_size                     19439 non-null  float64
 13  primary_cleaner.input.xanthate                      19335 non-null  float64
 14  primary_cleaner.output.concentrate_ag               19439 non-null  float64
 15  primary_cleaner.output.concentrate_pb               19323 non-null  float64
 16  primary_cleaner.output.concentrate_sol              19069 non-null  float64
 17  primary_cleaner.output.concentrate_au               19439 non-null  float64
 18  primary_cleaner.output.tail_ag                      19435 non-null  float64
 19  primary_cleaner.output.tail_pb                      19418 non-null  float64
 20  primary_cleaner.output.tail_sol                     19377 non-null  float64
 21  primary_cleaner.output.tail_au                      19439 non-null  float64
 22  primary_cleaner.state.floatbank8_a_air              19435 non-null  float64
 23  primary_cleaner.state.floatbank8_a_level            19438 non-null  float64
 24  primary_cleaner.state.floatbank8_b_air              19435 non-null  float64
 25  primary_cleaner.state.floatbank8_b_level            19438 non-null  float64
 26  primary_cleaner.state.floatbank8_c_air              19437 non-null  float64
 27  primary_cleaner.state.floatbank8_c_level            19438 non-null  float64
 28  primary_cleaner.state.floatbank8_d_air              19436 non-null  float64
 29  primary_cleaner.state.floatbank8_d_level            19438 non-null  float64
 30  rougher.calculation.sulfate_to_au_concentrate       19437 non-null  float64
 31  rougher.calculation.floatbank10_sulfate_to_au_feed  19437 non-null  float64
 32  rougher.calculation.floatbank11_sulfate_to_au_feed  19437 non-null  float64
 33  rougher.calculation.au_pb_ratio                     19439 non-null  float64
 34  rougher.input.feed_ag                               19439 non-null  float64
 35  rougher.input.feed_pb                               19339 non-null  float64
 36  rougher.input.feed_rate                             19428 non-null  float64
 37  rougher.input.feed_size                             19294 non-null  float64
 38  rougher.input.feed_sol                              19340 non-null  float64
 39  rougher.input.feed_au                               19439 non-null  float64
 40  rougher.input.floatbank10_sulfate                   19405 non-null  float64
 41  rougher.input.floatbank10_xanthate                  19431 non-null  float64
 42  rougher.input.floatbank11_sulfate                   19395 non-null  float64
 43  rougher.input.floatbank11_xanthate                  18986 non-null  float64
 44  rougher.output.concentrate_ag                       19439 non-null  float64
 45  rougher.output.concentrate_pb                       19439 non-null  float64
 46  rougher.output.concentrate_sol                      19416 non-null  float64
 47  rougher.output.concentrate_au                       19439 non-null  float64
 48  rougher.output.recovery                             19439 non-null  float64
 49  rougher.output.tail_ag                              19438 non-null  float64
 50  rougher.output.tail_pb                              19439 non-null  float64
 51  rougher.output.tail_sol                             19439 non-null  float64
 52  rougher.output.tail_au                              19439 non-null  float64
 53  rougher.state.floatbank10_a_air                     19438 non-null  float64
 54  rougher.state.floatbank10_a_level                   19438 non-null  float64
 55  rougher.state.floatbank10_b_air                     19438 non-null  float64
 56  rougher.state.floatbank10_b_level                   19438 non-null  float64
 57  rougher.state.floatbank10_c_air                     19438 non-null  float64
 58  rougher.state.floatbank10_c_level                   19438 non-null  float64
 59  rougher.state.floatbank10_d_air                     19439 non-null  float64
 60  rougher.state.floatbank10_d_level                   19439 non-null  float64
 61  rougher.state.floatbank10_e_air                     19003 non-null  float64
 62  rougher.state.floatbank10_e_level                   19439 non-null  float64
 63  rougher.state.floatbank10_f_air                     19439 non-null  float64
 64  rougher.state.floatbank10_f_level                   19439 non-null  float64
 65  secondary_cleaner.output.tail_ag                    19437 non-null  float64
 66  secondary_cleaner.output.tail_pb                    19427 non-null  float64
 67  secondary_cleaner.output.tail_sol                   17691 non-null  float64
 68  secondary_cleaner.output.tail_au                    19439 non-null  float64
 69  secondary_cleaner.state.floatbank2_a_air            19219 non-null  float64
 70  secondary_cleaner.state.floatbank2_a_level          19438 non-null  float64
 71  secondary_cleaner.state.floatbank2_b_air            19416 non-null  float64
 72  secondary_cleaner.state.floatbank2_b_level          19438 non-null  float64
 73  secondary_cleaner.state.floatbank3_a_air            19426 non-null  float64
 74  secondary_cleaner.state.floatbank3_a_level          19438 non-null  float64
 75  secondary_cleaner.state.floatbank3_b_air            19438 non-null  float64
 76  secondary_cleaner.state.floatbank3_b_level          19438 non-null  float64
 77  secondary_cleaner.state.floatbank4_a_air            19433 non-null  float64
 78  secondary_cleaner.state.floatbank4_a_level          19438 non-null  float64
 79  secondary_cleaner.state.floatbank4_b_air            19438 non-null  float64
 80  secondary_cleaner.state.floatbank4_b_level          19438 non-null  float64
 81  secondary_cleaner.state.floatbank5_a_air            19438 non-null  float64
 82  secondary_cleaner.state.floatbank5_a_level          19438 non-null  float64
 83  secondary_cleaner.state.floatbank5_b_air            19438 non-null  float64
 84  secondary_cleaner.state.floatbank5_b_level          19438 non-null  float64
 85  secondary_cleaner.state.floatbank6_a_air            19437 non-null  float64
 86  secondary_cleaner.state.floatbank6_a_level          19438 non-null  float64
dtypes: float64(86), object(1)
memory usage: 12.9+ MB
</pre></div>
</div>
</div>
</div>
<p>Expected concentrations of metals and salts in concentrates and tailings were excluded, as well as columns calculating gold recovery and concentration ratios between metals and salts.</p>
<p>According the column names, these are characteristics that are calculated after the end of the process, so it would be incorrect to use them for prediction.</p>
<p>Let’s briefly make sure that the samples are taken from a common data set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">data_full</span><span class="p">[</span><span class="s1">&#39;rougher.input.feed_ag&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data_train</span><span class="p">[</span><span class="s1">&#39;rougher.input.feed_ag&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="n">data_test</span><span class="p">[</span><span class="s1">&#39;rougher.input.feed_ag&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>170964.59423041172
170964.59423041172
</pre></div>
</div>
</div>
</div>
<p>For testing, the target feature is also needed. Let’s take the same rows from the common dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_train</span> <span class="o">=</span> <span class="n">data_full</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_full</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">data_train</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])]</span>
<span class="n">data_test</span> <span class="o">=</span> <span class="n">data_full</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_full</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">data_test</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_test</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>final.output.concentrate_ag</th>
      <th>final.output.concentrate_pb</th>
      <th>final.output.concentrate_sol</th>
      <th>final.output.concentrate_au</th>
      <th>final.output.recovery</th>
      <th>final.output.tail_ag</th>
      <th>final.output.tail_pb</th>
      <th>final.output.tail_sol</th>
      <th>final.output.tail_au</th>
      <th>...</th>
      <th>secondary_cleaner.state.floatbank4_a_air</th>
      <th>secondary_cleaner.state.floatbank4_a_level</th>
      <th>secondary_cleaner.state.floatbank4_b_air</th>
      <th>secondary_cleaner.state.floatbank4_b_level</th>
      <th>secondary_cleaner.state.floatbank5_a_air</th>
      <th>secondary_cleaner.state.floatbank5_a_level</th>
      <th>secondary_cleaner.state.floatbank5_b_air</th>
      <th>secondary_cleaner.state.floatbank5_b_level</th>
      <th>secondary_cleaner.state.floatbank6_a_air</th>
      <th>secondary_cleaner.state.floatbank6_a_level</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>4682</th>
      <td>2016-09-01 00:59:59</td>
      <td>7.578381</td>
      <td>10.466295</td>
      <td>11.990938</td>
      <td>40.743891</td>
      <td>70.273583</td>
      <td>12.688885</td>
      <td>3.844413</td>
      <td>11.075686</td>
      <td>4.537988</td>
      <td>...</td>
      <td>12.023554</td>
      <td>-497.795834</td>
      <td>8.016656</td>
      <td>-501.289139</td>
      <td>7.946562</td>
      <td>-432.317850</td>
      <td>4.872511</td>
      <td>-500.037437</td>
      <td>26.705889</td>
      <td>-499.709414</td>
    </tr>
    <tr>
      <th>4683</th>
      <td>2016-09-01 01:59:59</td>
      <td>7.813838</td>
      <td>10.581152</td>
      <td>12.216172</td>
      <td>39.604292</td>
      <td>68.910432</td>
      <td>12.829171</td>
      <td>3.918901</td>
      <td>11.132824</td>
      <td>4.675117</td>
      <td>...</td>
      <td>12.058140</td>
      <td>-498.695773</td>
      <td>8.130979</td>
      <td>-499.634209</td>
      <td>7.958270</td>
      <td>-525.839648</td>
      <td>4.878850</td>
      <td>-500.162375</td>
      <td>25.019940</td>
      <td>-499.819438</td>
    </tr>
    <tr>
      <th>4684</th>
      <td>2016-09-01 02:59:59</td>
      <td>7.623392</td>
      <td>10.424024</td>
      <td>12.313710</td>
      <td>40.724190</td>
      <td>68.143213</td>
      <td>12.977846</td>
      <td>4.026561</td>
      <td>10.990134</td>
      <td>4.828907</td>
      <td>...</td>
      <td>11.962366</td>
      <td>-498.767484</td>
      <td>8.096893</td>
      <td>-500.827423</td>
      <td>8.071056</td>
      <td>-500.801673</td>
      <td>4.905125</td>
      <td>-499.828510</td>
      <td>24.994862</td>
      <td>-500.622559</td>
    </tr>
    <tr>
      <th>4685</th>
      <td>2016-09-01 03:59:59</td>
      <td>8.552457</td>
      <td>10.503229</td>
      <td>13.074570</td>
      <td>39.290997</td>
      <td>67.776393</td>
      <td>12.451947</td>
      <td>3.780702</td>
      <td>11.155935</td>
      <td>4.969620</td>
      <td>...</td>
      <td>12.033091</td>
      <td>-498.350935</td>
      <td>8.074946</td>
      <td>-499.474407</td>
      <td>7.897085</td>
      <td>-500.868509</td>
      <td>4.931400</td>
      <td>-499.963623</td>
      <td>24.948919</td>
      <td>-498.709987</td>
    </tr>
    <tr>
      <th>4686</th>
      <td>2016-09-01 04:59:59</td>
      <td>8.078781</td>
      <td>10.222788</td>
      <td>12.475427</td>
      <td>40.254524</td>
      <td>61.467078</td>
      <td>11.827846</td>
      <td>3.632272</td>
      <td>11.403663</td>
      <td>5.256806</td>
      <td>...</td>
      <td>12.025367</td>
      <td>-500.786497</td>
      <td>8.054678</td>
      <td>-500.397500</td>
      <td>8.107890</td>
      <td>-509.526725</td>
      <td>4.957674</td>
      <td>-500.360026</td>
      <td>25.003331</td>
      <td>-500.856333</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 87 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data_train</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data_test</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e9e850c87ddc0710d25e755d45323ae9ef0cb76401918f70b14016cb35e4c97e.png" src="_images/e9e850c87ddc0710d25e755d45323ae9ef0cb76401918f70b14016cb35e4c97e.png" />
</div>
</div>
</section>
<section id="data-types">
<h3>Data Types<a class="headerlink" href="#data-types" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_full</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data_full</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
<span class="n">data_train</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data_train</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
<span class="n">data_test</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data_test</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_5561/515856303.py:2: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  data_train[&#39;date&#39;] = pd.to_datetime(data_train[&#39;date&#39;], format=&#39;%Y-%m-%d %H:%M:%S&#39;)
/tmp/ipykernel_5561/515856303.py:3: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  data_test[&#39;date&#39;] = pd.to_datetime(data_test[&#39;date&#39;], format=&#39;%Y-%m-%d %H:%M:%S&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">data_full</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19439
</pre></div>
</div>
</div>
</div>
<p>The dates are not repeated, we can navigate by them.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_full</span> <span class="o">=</span> <span class="n">data_full</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
<span class="n">data_train</span> <span class="o">=</span> <span class="n">data_train</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
<span class="n">data_test</span> <span class="o">=</span> <span class="n">data_test</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">data_full</span>
 <span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
 <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
 <span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span> 
       <span class="n">x</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> 
       <span class="n">y</span><span class="o">=</span><span class="s1">&#39;final.output.concentrate_au&#39;</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/leonid/anaconda3/envs/practicum/lib/python3.9/site-packages/pandas/plotting/_matplotlib/core.py:1041: UserWarning: No data for colormapping provided via &#39;c&#39;. Parameters &#39;cmap&#39; will be ignored
  scatter = ax.scatter(
</pre></div>
</div>
<img alt="_images/62ced838533e3f45670cd6223c6cf81f843d330377fda6ff8a471955e86d8733.png" src="_images/62ced838533e3f45670cd6223c6cf81f843d330377fda6ff8a471955e86d8733.png" />
</div>
</div>
<p>Almost 3 years of observations.</p>
</section>
<section id="missing-values">
<h3>Missing values<a class="headerlink" href="#missing-values" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_full</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>secondary_cleaner.output.tail_sol           1748
rougher.input.floatbank11_xanthate           453
rougher.state.floatbank10_e_air              436
primary_cleaner.output.concentrate_sol       370
secondary_cleaner.state.floatbank2_a_air     220
final.output.concentrate_sol                 211
rougher.input.feed_size                      145
primary_cleaner.output.concentrate_pb        116
primary_cleaner.input.xanthate               104
final.output.tail_pb                         101
dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Let’s look at the distributions of the missing features.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">top_list</span> <span class="o">=</span> <span class="n">data_full</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">index</span>
<span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">top_list</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data_full</span><span class="p">[</span><span class="n">column</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data_train</span><span class="p">[</span><span class="n">column</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;train&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data_test</span><span class="p">[</span><span class="n">column</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data_full</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;full_mean&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data_train</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;train_mean&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data_test</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;test_mean&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b2d8d9d63935c3386e0312cc7dd7c11b946a9314a6b27ed917e16d1d2d6cdcdd.png" src="_images/b2d8d9d63935c3386e0312cc7dd7c11b946a9314a6b27ed917e16d1d2d6cdcdd.png" />
<img alt="_images/a8b197704c129e9c72bcc5f8aae861c2a1f1fcbbe28858d4f7fccbf62da81f74.png" src="_images/a8b197704c129e9c72bcc5f8aae861c2a1f1fcbbe28858d4f7fccbf62da81f74.png" />
<img alt="_images/b6ba0082e679c98b1fb9094b5209432baa65278c8633a15e6f30addad665bc99.png" src="_images/b6ba0082e679c98b1fb9094b5209432baa65278c8633a15e6f30addad665bc99.png" />
<img alt="_images/7cd2372e8b283f5ab82f2da2b7fab30d937f3f01b1626d6d2c15be6d527345a0.png" src="_images/7cd2372e8b283f5ab82f2da2b7fab30d937f3f01b1626d6d2c15be6d527345a0.png" />
<img alt="_images/2d40ea516bea19df52447300ec87ee905ff137fe7355a3417223d1f80d975f9b.png" src="_images/2d40ea516bea19df52447300ec87ee905ff137fe7355a3417223d1f80d975f9b.png" />
<img alt="_images/6cc464809fcd07a8e63cd8aeb2f9f3e707ddd9a100458dfcbc153e85eab300cd.png" src="_images/6cc464809fcd07a8e63cd8aeb2f9f3e707ddd9a100458dfcbc153e85eab300cd.png" />
<img alt="_images/e95189bd42c406fdb7a2be5896612582e764eb138b35feb3ad07f320af9ad85b.png" src="_images/e95189bd42c406fdb7a2be5896612582e764eb138b35feb3ad07f320af9ad85b.png" />
<img alt="_images/656d5b671909bc85af7f55d93d0cba3113ea1aa07f9cc7f54fafcb55f56e1574.png" src="_images/656d5b671909bc85af7f55d93d0cba3113ea1aa07f9cc7f54fafcb55f56e1574.png" />
<img alt="_images/a944c342e90ded4e8a321e87507a7716aba4ee1ad1cab91ca3d667b38e111450.png" src="_images/a944c342e90ded4e8a321e87507a7716aba4ee1ad1cab91ca3d667b38e111450.png" />
<img alt="_images/7fd67fd205d7513fdab913a87e51ca07d654f07951c890fc0f201e78b1c5cfc0.png" src="_images/7fd67fd205d7513fdab913a87e51ca07d654f07951c890fc0f201e78b1c5cfc0.png" />
</div>
</div>
<p>To decide whether the gaps can be replaced by a measure of central tendency, let’s look at the dynamics of the characteristics over time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">top_list</span> <span class="o">=</span> <span class="n">data_full</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">index</span>
<span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">top_list</span><span class="p">:</span>
    <span class="c1"># data_full[column].resample(&#39;H&#39;).mean().plot(label=&#39;mean_per_hour&#39;)</span>
    <span class="n">data_full</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;mean_per_day&#39;</span><span class="p">)</span>
    <span class="n">data_full</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;mean_per_month&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">data_full</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;mean_per_all&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b8462210729e27bdfe79d30df5d92d500d69120983c9ffbb6239cd403a2e49e1.png" src="_images/b8462210729e27bdfe79d30df5d92d500d69120983c9ffbb6239cd403a2e49e1.png" />
<img alt="_images/b8899026388e299f422cc739a04c1e8a6ce5de0b47ccc657e12c2e580e9b2140.png" src="_images/b8899026388e299f422cc739a04c1e8a6ce5de0b47ccc657e12c2e580e9b2140.png" />
<img alt="_images/81676d8f3268bef4e8db45ef6e0d522155ed7d8d1ef6dd071ce6aa222b020474.png" src="_images/81676d8f3268bef4e8db45ef6e0d522155ed7d8d1ef6dd071ce6aa222b020474.png" />
<img alt="_images/134183cafc7e4cf6a062e6235a6be3f3586fbad61bce1771715071528e39af4e.png" src="_images/134183cafc7e4cf6a062e6235a6be3f3586fbad61bce1771715071528e39af4e.png" />
<img alt="_images/96cd1a041987d763ff3c8d136219fad717f7e52c012770d514a1b03dbc1df2a6.png" src="_images/96cd1a041987d763ff3c8d136219fad717f7e52c012770d514a1b03dbc1df2a6.png" />
<img alt="_images/5ed5484ac59f49c0e4919671db5a66ab232bd7e98a9c75230a41fac4b0f7dda7.png" src="_images/5ed5484ac59f49c0e4919671db5a66ab232bd7e98a9c75230a41fac4b0f7dda7.png" />
<img alt="_images/ba23c265a53df3328f42ffeed2b961fc05b9a055833ad2c676d9f1adf66e64dc.png" src="_images/ba23c265a53df3328f42ffeed2b961fc05b9a055833ad2c676d9f1adf66e64dc.png" />
<img alt="_images/73ae5ba93d58368810741ebde58d8fe7a23668c8554e393d87060f600ad0447f.png" src="_images/73ae5ba93d58368810741ebde58d8fe7a23668c8554e393d87060f600ad0447f.png" />
<img alt="_images/c902599bf8314c3796cbafcc92cf52898cfa36927f63b0afb47c0d685f67b4ff.png" src="_images/c902599bf8314c3796cbafcc92cf52898cfa36927f63b0afb47c0d685f67b4ff.png" />
<img alt="_images/119b0a5ac452086d7841676cf4880db24cb1332096aee97d21433fed0a2e565f.png" src="_images/119b0a5ac452086d7841676cf4880db24cb1332096aee97d21433fed0a2e565f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_full</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4481
</pre></div>
</div>
</div>
</div>
<p>Filling in the blanks with the median would not be a good option here because the data reflect changes over time.</p>
<p>Let’s replace them with interpolation. Since the data can vary widely even between neighboring points, polynomial interpolation will predict better than linear interpolation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_full</span> <span class="o">=</span> <span class="n">data_full</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;polynomial&#39;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">data_train</span> <span class="o">=</span> <span class="n">data_train</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;polynomial&#39;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">data_test</span> <span class="o">=</span> <span class="n">data_test</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;polynomial&#39;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_test</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
DatetimeIndex: 5290 entries, 2016-09-01 00:59:59 to 2017-12-31 23:59:59
Data columns (total 86 columns):
 #   Column                                              Non-Null Count  Dtype  
---  ------                                              --------------  -----  
 0   final.output.concentrate_ag                         5290 non-null   float64
 1   final.output.concentrate_pb                         5290 non-null   float64
 2   final.output.concentrate_sol                        5290 non-null   float64
 3   final.output.concentrate_au                         5290 non-null   float64
 4   final.output.recovery                               5290 non-null   float64
 5   final.output.tail_ag                                5290 non-null   float64
 6   final.output.tail_pb                                5290 non-null   float64
 7   final.output.tail_sol                               5290 non-null   float64
 8   final.output.tail_au                                5290 non-null   float64
 9   primary_cleaner.input.sulfate                       5290 non-null   float64
 10  primary_cleaner.input.depressant                    5290 non-null   float64
 11  primary_cleaner.input.feed_size                     5290 non-null   float64
 12  primary_cleaner.input.xanthate                      5290 non-null   float64
 13  primary_cleaner.output.concentrate_ag               5290 non-null   float64
 14  primary_cleaner.output.concentrate_pb               5290 non-null   float64
 15  primary_cleaner.output.concentrate_sol              5290 non-null   float64
 16  primary_cleaner.output.concentrate_au               5290 non-null   float64
 17  primary_cleaner.output.tail_ag                      5290 non-null   float64
 18  primary_cleaner.output.tail_pb                      5290 non-null   float64
 19  primary_cleaner.output.tail_sol                     5290 non-null   float64
 20  primary_cleaner.output.tail_au                      5290 non-null   float64
 21  primary_cleaner.state.floatbank8_a_air              5290 non-null   float64
 22  primary_cleaner.state.floatbank8_a_level            5290 non-null   float64
 23  primary_cleaner.state.floatbank8_b_air              5290 non-null   float64
 24  primary_cleaner.state.floatbank8_b_level            5290 non-null   float64
 25  primary_cleaner.state.floatbank8_c_air              5290 non-null   float64
 26  primary_cleaner.state.floatbank8_c_level            5290 non-null   float64
 27  primary_cleaner.state.floatbank8_d_air              5290 non-null   float64
 28  primary_cleaner.state.floatbank8_d_level            5290 non-null   float64
 29  rougher.calculation.sulfate_to_au_concentrate       5290 non-null   float64
 30  rougher.calculation.floatbank10_sulfate_to_au_feed  5290 non-null   float64
 31  rougher.calculation.floatbank11_sulfate_to_au_feed  5290 non-null   float64
 32  rougher.calculation.au_pb_ratio                     5290 non-null   float64
 33  rougher.input.feed_ag                               5290 non-null   float64
 34  rougher.input.feed_pb                               5290 non-null   float64
 35  rougher.input.feed_rate                             5290 non-null   float64
 36  rougher.input.feed_size                             5290 non-null   float64
 37  rougher.input.feed_sol                              5290 non-null   float64
 38  rougher.input.feed_au                               5290 non-null   float64
 39  rougher.input.floatbank10_sulfate                   5290 non-null   float64
 40  rougher.input.floatbank10_xanthate                  5290 non-null   float64
 41  rougher.input.floatbank11_sulfate                   5290 non-null   float64
 42  rougher.input.floatbank11_xanthate                  5290 non-null   float64
 43  rougher.output.concentrate_ag                       5290 non-null   float64
 44  rougher.output.concentrate_pb                       5290 non-null   float64
 45  rougher.output.concentrate_sol                      5290 non-null   float64
 46  rougher.output.concentrate_au                       5290 non-null   float64
 47  rougher.output.recovery                             5290 non-null   float64
 48  rougher.output.tail_ag                              5290 non-null   float64
 49  rougher.output.tail_pb                              5290 non-null   float64
 50  rougher.output.tail_sol                             5290 non-null   float64
 51  rougher.output.tail_au                              5290 non-null   float64
 52  rougher.state.floatbank10_a_air                     5290 non-null   float64
 53  rougher.state.floatbank10_a_level                   5290 non-null   float64
 54  rougher.state.floatbank10_b_air                     5290 non-null   float64
 55  rougher.state.floatbank10_b_level                   5290 non-null   float64
 56  rougher.state.floatbank10_c_air                     5290 non-null   float64
 57  rougher.state.floatbank10_c_level                   5290 non-null   float64
 58  rougher.state.floatbank10_d_air                     5290 non-null   float64
 59  rougher.state.floatbank10_d_level                   5290 non-null   float64
 60  rougher.state.floatbank10_e_air                     5290 non-null   float64
 61  rougher.state.floatbank10_e_level                   5290 non-null   float64
 62  rougher.state.floatbank10_f_air                     5290 non-null   float64
 63  rougher.state.floatbank10_f_level                   5290 non-null   float64
 64  secondary_cleaner.output.tail_ag                    5290 non-null   float64
 65  secondary_cleaner.output.tail_pb                    5290 non-null   float64
 66  secondary_cleaner.output.tail_sol                   5290 non-null   float64
 67  secondary_cleaner.output.tail_au                    5290 non-null   float64
 68  secondary_cleaner.state.floatbank2_a_air            5290 non-null   float64
 69  secondary_cleaner.state.floatbank2_a_level          5290 non-null   float64
 70  secondary_cleaner.state.floatbank2_b_air            5290 non-null   float64
 71  secondary_cleaner.state.floatbank2_b_level          5290 non-null   float64
 72  secondary_cleaner.state.floatbank3_a_air            5290 non-null   float64
 73  secondary_cleaner.state.floatbank3_a_level          5290 non-null   float64
 74  secondary_cleaner.state.floatbank3_b_air            5290 non-null   float64
 75  secondary_cleaner.state.floatbank3_b_level          5290 non-null   float64
 76  secondary_cleaner.state.floatbank4_a_air            5290 non-null   float64
 77  secondary_cleaner.state.floatbank4_a_level          5290 non-null   float64
 78  secondary_cleaner.state.floatbank4_b_air            5290 non-null   float64
 79  secondary_cleaner.state.floatbank4_b_level          5290 non-null   float64
 80  secondary_cleaner.state.floatbank5_a_air            5290 non-null   float64
 81  secondary_cleaner.state.floatbank5_a_level          5290 non-null   float64
 82  secondary_cleaner.state.floatbank5_b_air            5290 non-null   float64
 83  secondary_cleaner.state.floatbank5_b_level          5290 non-null   float64
 84  secondary_cleaner.state.floatbank6_a_air            5290 non-null   float64
 85  secondary_cleaner.state.floatbank6_a_level          5290 non-null   float64
dtypes: float64(86)
memory usage: 3.5 MB
</pre></div>
</div>
</div>
</div>
</section>
<section id="duplicates">
<h3>Duplicates<a class="headerlink" href="#duplicates" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">data_full</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data_train</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data_test</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
0
0
</pre></div>
</div>
</div>
</div>
</section>
<section id="feature-selection">
<h3>Feature selection<a class="headerlink" href="#feature-selection" title="Link to this heading">#</a></h3>
<p>I think we would need a model for each of the stages. Because the output at each stage depends only on the parameters of that stage, not the subsequent ones.</p>
<p>And for each of these models, we’ll need a different pair of datasets.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_train</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
DatetimeIndex: 14149 entries, 2016-01-15 00:00:00 to 2018-08-18 10:59:59
Data columns (total 86 columns):
 #   Column                                              Non-Null Count  Dtype  
---  ------                                              --------------  -----  
 0   final.output.concentrate_ag                         14149 non-null  float64
 1   final.output.concentrate_pb                         14149 non-null  float64
 2   final.output.concentrate_sol                        14149 non-null  float64
 3   final.output.concentrate_au                         14149 non-null  float64
 4   final.output.recovery                               14149 non-null  float64
 5   final.output.tail_ag                                14149 non-null  float64
 6   final.output.tail_pb                                14149 non-null  float64
 7   final.output.tail_sol                               14149 non-null  float64
 8   final.output.tail_au                                14149 non-null  float64
 9   primary_cleaner.input.sulfate                       14149 non-null  float64
 10  primary_cleaner.input.depressant                    14149 non-null  float64
 11  primary_cleaner.input.feed_size                     14149 non-null  float64
 12  primary_cleaner.input.xanthate                      14149 non-null  float64
 13  primary_cleaner.output.concentrate_ag               14149 non-null  float64
 14  primary_cleaner.output.concentrate_pb               14149 non-null  float64
 15  primary_cleaner.output.concentrate_sol              14149 non-null  float64
 16  primary_cleaner.output.concentrate_au               14149 non-null  float64
 17  primary_cleaner.output.tail_ag                      14149 non-null  float64
 18  primary_cleaner.output.tail_pb                      14149 non-null  float64
 19  primary_cleaner.output.tail_sol                     14149 non-null  float64
 20  primary_cleaner.output.tail_au                      14149 non-null  float64
 21  primary_cleaner.state.floatbank8_a_air              14149 non-null  float64
 22  primary_cleaner.state.floatbank8_a_level            14149 non-null  float64
 23  primary_cleaner.state.floatbank8_b_air              14149 non-null  float64
 24  primary_cleaner.state.floatbank8_b_level            14149 non-null  float64
 25  primary_cleaner.state.floatbank8_c_air              14149 non-null  float64
 26  primary_cleaner.state.floatbank8_c_level            14149 non-null  float64
 27  primary_cleaner.state.floatbank8_d_air              14149 non-null  float64
 28  primary_cleaner.state.floatbank8_d_level            14149 non-null  float64
 29  rougher.calculation.sulfate_to_au_concentrate       14149 non-null  float64
 30  rougher.calculation.floatbank10_sulfate_to_au_feed  14149 non-null  float64
 31  rougher.calculation.floatbank11_sulfate_to_au_feed  14149 non-null  float64
 32  rougher.calculation.au_pb_ratio                     14149 non-null  float64
 33  rougher.input.feed_ag                               14149 non-null  float64
 34  rougher.input.feed_pb                               14149 non-null  float64
 35  rougher.input.feed_rate                             14149 non-null  float64
 36  rougher.input.feed_size                             14149 non-null  float64
 37  rougher.input.feed_sol                              14149 non-null  float64
 38  rougher.input.feed_au                               14149 non-null  float64
 39  rougher.input.floatbank10_sulfate                   14149 non-null  float64
 40  rougher.input.floatbank10_xanthate                  14149 non-null  float64
 41  rougher.input.floatbank11_sulfate                   14149 non-null  float64
 42  rougher.input.floatbank11_xanthate                  14149 non-null  float64
 43  rougher.output.concentrate_ag                       14149 non-null  float64
 44  rougher.output.concentrate_pb                       14149 non-null  float64
 45  rougher.output.concentrate_sol                      14149 non-null  float64
 46  rougher.output.concentrate_au                       14149 non-null  float64
 47  rougher.output.recovery                             14149 non-null  float64
 48  rougher.output.tail_ag                              14149 non-null  float64
 49  rougher.output.tail_pb                              14149 non-null  float64
 50  rougher.output.tail_sol                             14149 non-null  float64
 51  rougher.output.tail_au                              14149 non-null  float64
 52  rougher.state.floatbank10_a_air                     14149 non-null  float64
 53  rougher.state.floatbank10_a_level                   14149 non-null  float64
 54  rougher.state.floatbank10_b_air                     14149 non-null  float64
 55  rougher.state.floatbank10_b_level                   14149 non-null  float64
 56  rougher.state.floatbank10_c_air                     14149 non-null  float64
 57  rougher.state.floatbank10_c_level                   14149 non-null  float64
 58  rougher.state.floatbank10_d_air                     14149 non-null  float64
 59  rougher.state.floatbank10_d_level                   14149 non-null  float64
 60  rougher.state.floatbank10_e_air                     14149 non-null  float64
 61  rougher.state.floatbank10_e_level                   14149 non-null  float64
 62  rougher.state.floatbank10_f_air                     14149 non-null  float64
 63  rougher.state.floatbank10_f_level                   14149 non-null  float64
 64  secondary_cleaner.output.tail_ag                    14149 non-null  float64
 65  secondary_cleaner.output.tail_pb                    14149 non-null  float64
 66  secondary_cleaner.output.tail_sol                   14149 non-null  float64
 67  secondary_cleaner.output.tail_au                    14149 non-null  float64
 68  secondary_cleaner.state.floatbank2_a_air            14149 non-null  float64
 69  secondary_cleaner.state.floatbank2_a_level          14149 non-null  float64
 70  secondary_cleaner.state.floatbank2_b_air            14149 non-null  float64
 71  secondary_cleaner.state.floatbank2_b_level          14149 non-null  float64
 72  secondary_cleaner.state.floatbank3_a_air            14149 non-null  float64
 73  secondary_cleaner.state.floatbank3_a_level          14149 non-null  float64
 74  secondary_cleaner.state.floatbank3_b_air            14149 non-null  float64
 75  secondary_cleaner.state.floatbank3_b_level          14149 non-null  float64
 76  secondary_cleaner.state.floatbank4_a_air            14149 non-null  float64
 77  secondary_cleaner.state.floatbank4_a_level          14149 non-null  float64
 78  secondary_cleaner.state.floatbank4_b_air            14149 non-null  float64
 79  secondary_cleaner.state.floatbank4_b_level          14149 non-null  float64
 80  secondary_cleaner.state.floatbank5_a_air            14149 non-null  float64
 81  secondary_cleaner.state.floatbank5_a_level          14149 non-null  float64
 82  secondary_cleaner.state.floatbank5_b_air            14149 non-null  float64
 83  secondary_cleaner.state.floatbank5_b_level          14149 non-null  float64
 84  secondary_cleaner.state.floatbank6_a_air            14149 non-null  float64
 85  secondary_cleaner.state.floatbank6_a_level          14149 non-null  float64
dtypes: float64(86)
memory usage: 9.4 MB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features_train_rougher</span> <span class="o">=</span> <span class="n">data_train</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="s1">&#39;rougher.input|rougher.state&#39;</span><span class="p">)</span>
<span class="n">features_test_rougher</span> <span class="o">=</span> <span class="n">data_test</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="s1">&#39;rougher.input|rougher.state&#39;</span><span class="p">)</span>
<span class="n">target_train_rougher</span> <span class="o">=</span> <span class="n">data_train</span><span class="p">[</span><span class="s1">&#39;rougher.output.recovery&#39;</span><span class="p">]</span>
<span class="n">target_test_rougher</span> <span class="o">=</span> <span class="n">data_test</span><span class="p">[</span><span class="s1">&#39;rougher.output.recovery&#39;</span><span class="p">]</span>

<span class="n">features_train_final</span> <span class="o">=</span> <span class="n">data_train</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">primary_cleaner.input|</span><span class="se">\</span>
<span class="s1">primary_cleaner.state|</span><span class="se">\</span>
<span class="s1">primary_cleaner.state</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
<span class="n">features_test_final</span> <span class="o">=</span> <span class="n">data_test</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">primary_cleaner.input|</span><span class="se">\</span>
<span class="s1">primary_cleaner.state|</span><span class="se">\</span>
<span class="s1">primary_cleaner.state</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
<span class="n">target_train_final</span> <span class="o">=</span> <span class="n">data_train</span><span class="p">[</span><span class="s1">&#39;final.output.recovery&#39;</span><span class="p">]</span>
<span class="n">target_test_final</span> <span class="o">=</span> <span class="n">data_test</span><span class="p">[</span><span class="s1">&#39;final.output.recovery&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features_train_rougher</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
DatetimeIndex: 14149 entries, 2016-01-15 00:00:00 to 2018-08-18 10:59:59
Data columns (total 22 columns):
 #   Column                              Non-Null Count  Dtype  
---  ------                              --------------  -----  
 0   rougher.input.feed_ag               14149 non-null  float64
 1   rougher.input.feed_pb               14149 non-null  float64
 2   rougher.input.feed_rate             14149 non-null  float64
 3   rougher.input.feed_size             14149 non-null  float64
 4   rougher.input.feed_sol              14149 non-null  float64
 5   rougher.input.feed_au               14149 non-null  float64
 6   rougher.input.floatbank10_sulfate   14149 non-null  float64
 7   rougher.input.floatbank10_xanthate  14149 non-null  float64
 8   rougher.input.floatbank11_sulfate   14149 non-null  float64
 9   rougher.input.floatbank11_xanthate  14149 non-null  float64
 10  rougher.state.floatbank10_a_air     14149 non-null  float64
 11  rougher.state.floatbank10_a_level   14149 non-null  float64
 12  rougher.state.floatbank10_b_air     14149 non-null  float64
 13  rougher.state.floatbank10_b_level   14149 non-null  float64
 14  rougher.state.floatbank10_c_air     14149 non-null  float64
 15  rougher.state.floatbank10_c_level   14149 non-null  float64
 16  rougher.state.floatbank10_d_air     14149 non-null  float64
 17  rougher.state.floatbank10_d_level   14149 non-null  float64
 18  rougher.state.floatbank10_e_air     14149 non-null  float64
 19  rougher.state.floatbank10_e_level   14149 non-null  float64
 20  rougher.state.floatbank10_f_air     14149 non-null  float64
 21  rougher.state.floatbank10_f_level   14149 non-null  float64
dtypes: float64(22)
memory usage: 2.5 MB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">target_test_final</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>date
2016-09-01 00:59:59    70.273583
2016-09-01 01:59:59    68.910432
2016-09-01 02:59:59    68.143213
2016-09-01 03:59:59    67.776393
2016-09-01 04:59:59    61.467078
                         ...    
2017-12-31 19:59:59    68.919891
2017-12-31 20:59:59    68.440582
2017-12-31 21:59:59    67.092759
2017-12-31 22:59:59    68.061186
2017-12-31 23:59:59    71.699976
Name: final.output.recovery, Length: 5290, dtype: float64
</pre></div>
</div>
</div>
</div>
</section>
<section id="scaling">
<h3>Scaling<a class="headerlink" href="#scaling" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">scaler</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features_train_rougher</span><span class="p">)</span>
<span class="n">features_train_rougher</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">features_train_rougher</span><span class="p">),</span> 
                                      <span class="n">index</span><span class="o">=</span><span class="n">features_train_rougher</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> 
                                      <span class="n">columns</span><span class="o">=</span><span class="n">features_train_rougher</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">features_test_rougher</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">features_test_rougher</span><span class="p">),</span> 
                                         <span class="n">index</span><span class="o">=</span><span class="n">features_test_rougher</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> 
                                         <span class="n">columns</span><span class="o">=</span><span class="n">features_test_rougher</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">features_train_rougher</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">features_test_rougher</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(14149, 22)
(5290, 22)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">scaler</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features_train_final</span><span class="p">)</span>
<span class="n">features_train_final</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">features_train_final</span><span class="p">),</span> 
                                      <span class="n">index</span><span class="o">=</span><span class="n">features_train_final</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> 
                                      <span class="n">columns</span><span class="o">=</span><span class="n">features_train_final</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">features_test_final</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">features_test_final</span><span class="p">),</span> 
                                         <span class="n">index</span><span class="o">=</span><span class="n">features_test_final</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> 
                                         <span class="n">columns</span><span class="o">=</span><span class="n">features_test_final</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">features_train_final</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">features_test_final</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(14149, 8)
(5290, 8)
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="exploratory-data-analysis">
<h2>Exploratory data analysis<a class="headerlink" href="#exploratory-data-analysis" title="Link to this heading">#</a></h2>
<p>Let’s look at metal concentrations in tailings and concentrates, pellet size.</p>
<section id="concentrations-of-metals-at-different-stages">
<h3>Concentrations of metals at different stages.<a class="headerlink" href="#concentrations-of-metals-at-different-stages" title="Link to this heading">#</a></h3>
<p>To group the data, we select all <code class="docutils literal notranslate"><span class="pre">rougher.input.feed_</span></code> columns with metals, as well as <code class="docutils literal notranslate"><span class="pre">rougher.output.concentrate_</span> </code>, <code class="docutils literal notranslate"><span class="pre">primary_cleaner.output.concentrate_</span></code> and <code class="docutils literal notranslate"><span class="pre">final.output.concentrate_</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_for_pivot</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_full</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span>
<span class="sd">&#39;&#39;&#39;\</span>
<span class="sd">rougher.input.feed_..$|rougher.input.feed_sol$|\</span>
<span class="sd">rougher.output.concentrate_.*|\</span>
<span class="sd">primary_cleaner.output.concentrate_.*|\</span>
<span class="sd">final.output.concentrate_.*\</span>
<span class="sd">&#39;&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">stack</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
<span class="n">df_for_pivot</span><span class="p">[</span><span class="s1">&#39;feature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_for_pivot</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df_for_pivot</span> <span class="o">=</span> <span class="n">df_for_pivot</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df_for_pivot</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>value</th>
      <th>feature</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2016-01-15</th>
      <td>6.055403</td>
      <td>final.output.concentrate_ag</td>
    </tr>
    <tr>
      <th>2016-01-15</th>
      <td>9.889648</td>
      <td>final.output.concentrate_pb</td>
    </tr>
    <tr>
      <th>2016-01-15</th>
      <td>5.507324</td>
      <td>final.output.concentrate_sol</td>
    </tr>
    <tr>
      <th>2016-01-15</th>
      <td>42.192020</td>
      <td>final.output.concentrate_au</td>
    </tr>
    <tr>
      <th>2016-01-15</th>
      <td>8.547551</td>
      <td>primary_cleaner.output.concentrate_ag</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_for_pivot</span><span class="p">[</span><span class="s1">&#39;metal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_for_pivot</span><span class="p">[</span><span class="s1">&#39;feature&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">df_for_pivot</span><span class="p">[</span><span class="s1">&#39;stage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_for_pivot</span><span class="p">[</span><span class="s1">&#39;feature&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;feed&#39;</span> <span class="k">if</span> <span class="s1">&#39;feed&#39;</span> <span class="ow">in</span> <span class="n">x</span> 
                                                      <span class="k">else</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">df_for_pivot</span> <span class="o">=</span> <span class="n">df_for_pivot</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;feature&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df_for_pivot</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>value</th>
      <th>metal</th>
      <th>stage</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2016-01-15</th>
      <td>6.055403</td>
      <td>ag</td>
      <td>final</td>
    </tr>
    <tr>
      <th>2016-01-15</th>
      <td>9.889648</td>
      <td>pb</td>
      <td>final</td>
    </tr>
    <tr>
      <th>2016-01-15</th>
      <td>5.507324</td>
      <td>sol</td>
      <td>final</td>
    </tr>
    <tr>
      <th>2016-01-15</th>
      <td>42.192020</td>
      <td>au</td>
      <td>final</td>
    </tr>
    <tr>
      <th>2016-01-15</th>
      <td>8.547551</td>
      <td>ag</td>
      <td>primary_cleaner</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_pivot</span> <span class="o">=</span> <span class="n">df_for_pivot</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;stage&#39;</span><span class="p">,</span> <span class="s1">&#39;metal&#39;</span><span class="p">],</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
<span class="n">df_pivot</span> <span class="o">=</span> <span class="n">df_pivot</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df_pivot</span> <span class="o">=</span> <span class="n">df_pivot</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;feed&#39;</span><span class="p">,</span> <span class="s1">&#39;rougher&#39;</span><span class="p">,</span> <span class="s1">&#39;primary_cleaner&#39;</span><span class="p">,</span> <span class="s1">&#39;final&#39;</span><span class="p">])</span>
<span class="n">df_pivot</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>metal</th>
      <th>ag</th>
      <th>au</th>
      <th>pb</th>
      <th>sol</th>
    </tr>
    <tr>
      <th>stage</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>feed</th>
      <td>8.794927</td>
      <td>8.266097</td>
      <td>3.573164</td>
      <td>36.659828</td>
    </tr>
    <tr>
      <th>rougher</th>
      <td>11.994759</td>
      <td>19.772000</td>
      <td>7.606272</td>
      <td>28.805371</td>
    </tr>
    <tr>
      <th>primary_cleaner</th>
      <td>8.442408</td>
      <td>32.119400</td>
      <td>9.806420</td>
      <td>10.372783</td>
    </tr>
    <tr>
      <th>final</th>
      <td>5.168385</td>
      <td>44.076513</td>
      <td>9.978813</td>
      <td>9.424201</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_pivot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Stage&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Concentration&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/598ef685e47b6079aa24d38d5ca5ff68555e422cbffb1ef28af3624ef1fb9b89.png" src="_images/598ef685e47b6079aa24d38d5ca5ff68555e422cbffb1ef28af3624ef1fb9b89.png" />
</div>
</div>
<p>From here we can sum the total concentration:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_pivot</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;primary_cleaner&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Stage&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Concentration&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f95f4e91565c6c56121905eb01f749ba6d5be8be64d326a3fddc7708b30f6c10.png" src="_images/f95f4e91565c6c56121905eb01f749ba6d5be8be64d326a3fddc7708b30f6c10.png" />
</div>
</div>
<p>Let’s see how the total concentrations are distributed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;rougher.input.feed_..$|rougher.input.feed_...$&#39;</span><span class="p">,</span>
              <span class="s1">&#39;rougher.output.concentrate_&#39;</span><span class="p">,</span> <span class="s1">&#39;final.output.concentrate_&#39;</span><span class="p">,</span> 
              <span class="s1">&#39;rougher.output.tail_&#39;</span><span class="p">,</span> <span class="s1">&#39;final.output.tail_&#39;</span><span class="p">]:</span>
    <span class="p">(</span><span class="n">data_full</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="n">label</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
     <span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Total concentrate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b92bb268b5d27149765f833e1c198bf5e4674426feaf99bef19b66a36685694f.png" src="_images/b92bb268b5d27149765f833e1c198bf5e4674426feaf99bef19b66a36685694f.png" />
</div>
</div>
<a id='hist'><p>Now to the most common range of concentrations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;rougher.input.feed_..$|rougher.input.feed_...$&#39;</span><span class="p">,</span>
              <span class="s1">&#39;rougher.output.concentrate_&#39;</span><span class="p">,</span> <span class="s1">&#39;final.output.concentrate_&#39;</span><span class="p">,</span> 
              <span class="s1">&#39;rougher.output.tail_&#39;</span><span class="p">,</span> <span class="s1">&#39;final.output.tail_&#39;</span><span class="p">]:</span>
    <span class="p">(</span><span class="n">data_full</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="n">label</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
     <span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Total concentrate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/bfabcb3b1517eee03790f1c413dfcc1fa587439b86ebf109d624cd61fd7ef6df.png" src="_images/bfabcb3b1517eee03790f1c413dfcc1fa587439b86ebf109d624cd61fd7ef6df.png" />
</div>
</div>
<p>It can be seen that the concentrations in the tailings after flotation and cleaning are almost the same. Whereas the final concentration is not even higher than the intermediate one, just more precise.</p>
<p>Rows with zero concentration will interfere during training. We will have to throw them out, but first, let’s see if this is related to the weekends.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_full</span><span class="p">[</span><span class="n">data_full</span><span class="p">[</span><span class="s1">&#39;rougher.output.concentrate_au&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">weekday</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2    84
0    75
1    68
6    51
3    45
4    45
5    26
Name: date, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Apparently not.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">drop_from_all</span><span class="p">(</span><span class="n">index_to_drop</span><span class="p">):</span>
    <span class="c1"># data_full = data_full.loc[~data_full.index.isin(index_to_drop)]</span>
    
    <span class="n">data_full</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index_to_drop</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
    <span class="n">data_train</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index_to_drop</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
    <span class="n">data_test</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index_to_drop</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

    <span class="n">features_train_rougher</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index_to_drop</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
    <span class="n">features_test_rougher</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index_to_drop</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
    <span class="n">target_train_rougher</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index_to_drop</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
    <span class="n">target_test_rougher</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index_to_drop</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>    

    <span class="n">features_train_final</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index_to_drop</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
    <span class="n">features_test_final</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index_to_drop</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>    
    <span class="n">target_train_final</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index_to_drop</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
    <span class="n">target_test_final</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index_to_drop</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">zero_index</span> <span class="o">=</span> <span class="n">data_full</span><span class="p">[(</span><span class="n">data_full</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s1">rougher.output.concentrate_|</span><span class="se">\</span>
<span class="s1">rougher.output.tail_|</span><span class="se">\</span>
<span class="s1">final.output.concentrate_|</span><span class="se">\</span>
<span class="s1">final.output.tail_&#39;&#39;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">index</span>
<span class="n">zero_index</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DatetimeIndex([&#39;2016-01-16 21:00:00&#39;, &#39;2016-01-16 22:00:00&#39;,
               &#39;2016-01-16 23:00:00&#39;, &#39;2016-01-17 00:00:00&#39;,
               &#39;2016-01-17 02:00:00&#39;, &#39;2016-01-17 03:00:00&#39;,
               &#39;2016-01-17 04:00:00&#39;, &#39;2016-01-18 05:00:00&#39;,
               &#39;2016-02-13 11:00:00&#39;, &#39;2016-02-18 20:00:00&#39;,
               ...
               &#39;2018-06-06 22:59:59&#39;, &#39;2018-06-06 23:59:59&#39;,
               &#39;2018-06-10 23:59:59&#39;, &#39;2018-06-11 07:59:59&#39;,
               &#39;2018-06-14 03:59:59&#39;, &#39;2018-06-19 20:59:59&#39;,
               &#39;2018-06-23 18:59:59&#39;, &#39;2018-07-31 16:59:59&#39;,
               &#39;2018-08-08 04:59:59&#39;, &#39;2018-08-08 05:59:59&#39;],
              dtype=&#39;datetime64[ns]&#39;, name=&#39;date&#39;, length=580, freq=None)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">drop_from_all</span><span class="p">(</span><span class="n">zero_index</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="comparison-of-training-and-test-samples">
<h3>Comparison of training and test samples<a class="headerlink" href="#comparison-of-training-and-test-samples" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_train</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>final.output.concentrate_ag</th>
      <th>final.output.concentrate_pb</th>
      <th>final.output.concentrate_sol</th>
      <th>final.output.concentrate_au</th>
      <th>final.output.recovery</th>
      <th>final.output.tail_ag</th>
      <th>final.output.tail_pb</th>
      <th>final.output.tail_sol</th>
      <th>final.output.tail_au</th>
      <th>primary_cleaner.input.sulfate</th>
      <th>...</th>
      <th>secondary_cleaner.state.floatbank4_a_air</th>
      <th>secondary_cleaner.state.floatbank4_a_level</th>
      <th>secondary_cleaner.state.floatbank4_b_air</th>
      <th>secondary_cleaner.state.floatbank4_b_level</th>
      <th>secondary_cleaner.state.floatbank5_a_air</th>
      <th>secondary_cleaner.state.floatbank5_a_level</th>
      <th>secondary_cleaner.state.floatbank5_b_air</th>
      <th>secondary_cleaner.state.floatbank5_b_level</th>
      <th>secondary_cleaner.state.floatbank6_a_air</th>
      <th>secondary_cleaner.state.floatbank6_a_level</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2016-01-15 00:00:00</th>
      <td>6.055403</td>
      <td>9.889648</td>
      <td>5.507324</td>
      <td>42.192020</td>
      <td>70.541216</td>
      <td>10.411962</td>
      <td>0.895447</td>
      <td>16.904297</td>
      <td>2.143149</td>
      <td>127.092003</td>
      <td>...</td>
      <td>14.016835</td>
      <td>-502.488007</td>
      <td>12.099931</td>
      <td>-504.715942</td>
      <td>9.925633</td>
      <td>-498.310211</td>
      <td>8.079666</td>
      <td>-500.470978</td>
      <td>14.151341</td>
      <td>-605.841980</td>
    </tr>
    <tr>
      <th>2016-01-15 01:00:00</th>
      <td>6.029369</td>
      <td>9.968944</td>
      <td>5.257781</td>
      <td>42.701629</td>
      <td>69.266198</td>
      <td>10.462676</td>
      <td>0.927452</td>
      <td>16.634514</td>
      <td>2.224930</td>
      <td>125.629232</td>
      <td>...</td>
      <td>13.992281</td>
      <td>-505.503262</td>
      <td>11.950531</td>
      <td>-501.331529</td>
      <td>10.039245</td>
      <td>-500.169983</td>
      <td>7.984757</td>
      <td>-500.582168</td>
      <td>13.998353</td>
      <td>-599.787184</td>
    </tr>
    <tr>
      <th>2016-01-15 02:00:00</th>
      <td>6.055926</td>
      <td>10.213995</td>
      <td>5.383759</td>
      <td>42.657501</td>
      <td>68.116445</td>
      <td>10.507046</td>
      <td>0.953716</td>
      <td>16.208849</td>
      <td>2.257889</td>
      <td>123.819808</td>
      <td>...</td>
      <td>14.015015</td>
      <td>-502.520901</td>
      <td>11.912783</td>
      <td>-501.133383</td>
      <td>10.070913</td>
      <td>-500.129135</td>
      <td>8.013877</td>
      <td>-500.517572</td>
      <td>14.028663</td>
      <td>-601.427363</td>
    </tr>
    <tr>
      <th>2016-01-15 03:00:00</th>
      <td>6.047977</td>
      <td>9.977019</td>
      <td>4.858634</td>
      <td>42.689819</td>
      <td>68.347543</td>
      <td>10.422762</td>
      <td>0.883763</td>
      <td>16.532835</td>
      <td>2.146849</td>
      <td>122.270188</td>
      <td>...</td>
      <td>14.036510</td>
      <td>-500.857308</td>
      <td>11.999550</td>
      <td>-501.193686</td>
      <td>9.970366</td>
      <td>-499.201640</td>
      <td>7.977324</td>
      <td>-500.255908</td>
      <td>14.005551</td>
      <td>-599.996129</td>
    </tr>
    <tr>
      <th>2016-01-15 04:00:00</th>
      <td>6.148599</td>
      <td>10.142511</td>
      <td>4.939416</td>
      <td>42.774141</td>
      <td>66.927016</td>
      <td>10.360302</td>
      <td>0.792826</td>
      <td>16.525686</td>
      <td>2.055292</td>
      <td>117.988169</td>
      <td>...</td>
      <td>14.027298</td>
      <td>-499.838632</td>
      <td>11.953070</td>
      <td>-501.053894</td>
      <td>9.925709</td>
      <td>-501.686727</td>
      <td>7.894242</td>
      <td>-500.356035</td>
      <td>13.996647</td>
      <td>-601.496691</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 86 columns</p>
</div></div></div>
</div>
<p>Let’s have a look at the distributions of the pellet size data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">data_train</span><span class="p">[</span><span class="s1">&#39;rougher.input.feed_size&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">data_test</span><span class="p">[</span><span class="s1">&#39;rougher.input.feed_size&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Feed size&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/9e6ddc6fc587807862d82bb379ec4bc032cbf593e2289d37dee8bf702e060481.png" src="_images/9e6ddc6fc587807862d82bb379ec4bc032cbf593e2289d37dee8bf702e060481.png" />
</div>
</div>
<p>Without outliers:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">df_train</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_train</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">data_train</span><span class="p">[</span><span class="s1">&#39;rougher.input.feed_size&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span> <span class="o">&lt;</span> 
                            <span class="n">data_train</span><span class="p">[</span><span class="s1">&#39;rougher.input.feed_size&#39;</span><span class="p">])</span> <span class="o">&amp;</span> 
                           <span class="p">(</span><span class="n">data_train</span><span class="p">[</span><span class="s1">&#39;rougher.input.feed_size&#39;</span><span class="p">]</span> <span class="o">&lt;</span> 
                            <span class="n">data_train</span><span class="p">[</span><span class="s1">&#39;rougher.input.feed_size&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.99</span><span class="p">))])</span>
<span class="n">df_test</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_test</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">data_test</span><span class="p">[</span><span class="s1">&#39;rougher.input.feed_size&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span> <span class="o">&lt;</span> 
                            <span class="n">data_test</span><span class="p">[</span><span class="s1">&#39;rougher.input.feed_size&#39;</span><span class="p">])</span> <span class="o">&amp;</span> 
                           <span class="p">(</span><span class="n">data_test</span><span class="p">[</span><span class="s1">&#39;rougher.input.feed_size&#39;</span><span class="p">]</span> <span class="o">&lt;</span> 
                            <span class="n">data_test</span><span class="p">[</span><span class="s1">&#39;rougher.input.feed_size&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.99</span><span class="p">))])</span>
<span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;rougher.input.feed_size&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_test</span><span class="p">[</span><span class="s1">&#39;rougher.input.feed_size&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Feed size&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/1f6b2d74c639bdfc7e6543e53a6aa09f2ecfed701a9164f607256ac8c9c45708.png" src="_images/1f6b2d74c639bdfc7e6543e53a6aa09f2ecfed701a9164f607256ac8c9c45708.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_train</span><span class="p">[</span><span class="n">data_train</span><span class="p">[</span><span class="s1">&#39;rougher.input.feed_size&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">][</span><span class="s1">&#39;rougher.input.feed_size&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>date
2016-07-06 10:59:59   -1948.839203
2016-07-06 11:59:59   -1951.818054
2016-07-06 13:59:59   -1955.350361
2016-07-06 14:59:59   -1955.903817
2016-07-06 15:59:59   -1955.648808
                          ...     
2016-07-09 07:59:59    -257.721520
2016-07-09 08:59:59    -204.916301
2016-07-09 09:59:59    -151.302617
2016-07-09 10:59:59     -96.880468
2016-07-09 11:59:59     -41.649855
Name: rougher.input.feed_size, Length: 66, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>A negative pellet size is most likely an anomaly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">neg_size_index</span> <span class="o">=</span> <span class="n">data_full</span><span class="p">[</span><span class="n">data_full</span><span class="p">[</span><span class="s1">&#39;rougher.input.feed_size&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>

<span class="n">drop_from_all</span><span class="p">(</span><span class="n">neg_size_index</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now it’s on to the feed rate.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">data_train</span><span class="p">[</span><span class="s1">&#39;rougher.input.feed_rate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">data_test</span><span class="p">[</span><span class="s1">&#39;rougher.input.feed_rate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Feed rate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/ee24e9183abb32c34c4822f2570b23d2a925a0ab048e7c264f46f662d9941740.png" src="_images/ee24e9183abb32c34c4822f2570b23d2a925a0ab048e7c264f46f662d9941740.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_train</span><span class="p">[</span><span class="n">data_train</span><span class="p">[</span><span class="s1">&#39;rougher.input.feed_rate&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">][</span><span class="s1">&#39;rougher.input.feed_rate&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>date
2018-02-23 14:59:59   -68.492473
2018-03-29 11:59:59   -32.315495
2018-07-05 16:59:59   -16.153329
2018-07-15 20:59:59   -76.224153
Name: rougher.input.feed_rate, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">neg_rate_index</span> <span class="o">=</span> <span class="n">data_full</span><span class="p">[</span><span class="n">data_full</span><span class="p">[</span><span class="s1">&#39;rougher.input.feed_rate&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>

<span class="n">drop_from_all</span><span class="p">(</span><span class="n">neg_rate_index</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The distributions of the training and test samples vary quite significantly, but the samples are fixed by the task formulation, so we will train on these.</p>
</section>
</section>
<section id="training">
<h2>Training<a class="headerlink" href="#training" title="Link to this heading">#</a></h2>
<p>We will calculate the target metric as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">final_smape</span><span class="p">(</span><span class="n">rougher_model</span><span class="p">,</span> <span class="n">final_model</span><span class="p">,</span> 
                <span class="n">features_rougher</span><span class="o">=</span><span class="n">features_train_rougher</span><span class="p">,</span> 
                <span class="n">target_rougher</span><span class="o">=</span><span class="n">target_train_rougher</span><span class="p">,</span>
                <span class="n">features_final</span><span class="o">=</span><span class="n">features_train_final</span><span class="p">,</span> 
                <span class="n">target_final</span><span class="o">=</span><span class="n">target_train_final</span><span class="p">):</span>
    <span class="n">rougher_smape</span> <span class="o">=</span> <span class="o">-</span><span class="n">cross_validate</span><span class="p">(</span><span class="n">rougher_model</span><span class="p">,</span> <span class="n">features_rougher</span><span class="p">,</span> <span class="n">target_rougher</span><span class="p">,</span> 
                                   <span class="n">scoring</span><span class="o">=</span><span class="n">smape_scorer</span><span class="p">)[</span><span class="s1">&#39;test_smape&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">final_smape</span> <span class="o">=</span> <span class="o">-</span><span class="n">cross_validate</span><span class="p">(</span><span class="n">final_model</span><span class="p">,</span> <span class="n">features_final</span><span class="p">,</span> <span class="n">target_final</span><span class="p">,</span> 
                                 <span class="n">scoring</span><span class="o">=</span><span class="n">smape_scorer</span><span class="p">)[</span><span class="s1">&#39;test_smape&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="k">return</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">rougher_smape</span> <span class="o">+</span> <span class="mf">0.75</span> <span class="o">*</span> <span class="n">final_smape</span>
</pre></div>
</div>
</div>
</div>
<p>For each of the steps, we will consider linear regression, a decision tree, and a random forest.</p>
<p>In all cases, with a cross-validation.</p>
<section id="linear-regression">
<h3>Linear Regression.<a class="headerlink" href="#linear-regression" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rougher_model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">rougher_scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">rougher_model</span><span class="p">,</span> <span class="n">features_train_rougher</span><span class="p">,</span> 
                                <span class="n">target_train_rougher</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">smape_scorer</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Rougher&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">9</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;R2:&#39;</span><span class="p">,</span> <span class="n">rougher_scores</span><span class="p">[</span><span class="s1">&#39;test_r2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rougher_scores</span><span class="p">[</span><span class="s1">&#39;test_r2&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sMAPE (%):&#39;</span><span class="p">,</span> <span class="o">-</span><span class="n">rougher_scores</span><span class="p">[</span><span class="s1">&#39;test_smape&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="o">-</span><span class="n">rougher_scores</span><span class="p">[</span><span class="s1">&#39;test_smape&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Rougher
=========
R2: -2.4955718021941933
[  0.0139714    0.17795946   0.34452227 -12.31592023  -0.69839192]

sMAPE (%): 7.451994437527285
[ 7.74877384  7.55692922  3.72232624 10.21332903  8.01861386]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">final_model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">final_scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">final_model</span><span class="p">,</span> <span class="n">features_train_final</span><span class="p">,</span> 
                                <span class="n">target_train_final</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">smape_scorer</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Final&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">9</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;R2:&#39;</span><span class="p">,</span> <span class="n">final_scores</span><span class="p">[</span><span class="s1">&#39;test_r2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">final_scores</span><span class="p">[</span><span class="s1">&#39;test_r2&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sMAPE (%):&#39;</span><span class="p">,</span> <span class="o">-</span><span class="n">final_scores</span><span class="p">[</span><span class="s1">&#39;test_smape&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="o">-</span><span class="n">final_scores</span><span class="p">[</span><span class="s1">&#39;test_smape&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Final
=========
R2: -0.16689249153452831
[-0.48107013  0.08744123 -0.25092288  0.02881219 -0.21872287]

sMAPE (%): 10.741610356532439
[11.9039061   8.55184047 10.65294988 11.08771346 11.51164187]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Linear Regression&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">final_smape</span><span class="p">(</span><span class="n">rougher_model</span><span class="p">,</span> <span class="n">final_model</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Linear Regression
9.91920637678115
</pre></div>
</div>
</div>
</div>
</section>
<section id="decision-tree">
<h3>Decision Tree<a class="headerlink" href="#decision-tree" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">57</span><span class="p">)</span>
<span class="n">param_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">)}</span>
<span class="n">rougher_model</span> <span class="o">=</span> <span class="n">DecisionTreeRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">state</span><span class="p">)</span>
<span class="n">rougher_rsearch</span> <span class="o">=</span> <span class="n">RandomizedSearchCV</span><span class="p">(</span><span class="n">rougher_model</span><span class="p">,</span> <span class="n">param_distributions</span><span class="o">=</span><span class="n">param_dict</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> 
                                     <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">smape_scorer</span><span class="p">[</span><span class="s1">&#39;smape&#39;</span><span class="p">],</span> <span class="n">random_state</span><span class="o">=</span><span class="n">state</span><span class="p">)</span>
<span class="n">rougher_rsearch</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features_train_rougher</span><span class="p">,</span> <span class="n">target_train_rougher</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Rougher&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">9</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Depth:&#39;</span><span class="p">,</span> <span class="n">rougher_rsearch</span><span class="o">.</span><span class="n">best_params_</span><span class="p">[</span><span class="s1">&#39;max_depth&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sMAPE:&#39;</span><span class="p">,</span> <span class="o">-</span><span class="n">rougher_rsearch</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Rougher
=========
Depth: 4
sMAPE: 7.2357939261948685
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">57</span><span class="p">)</span>
<span class="n">param_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">)}</span>
<span class="n">final_model</span> <span class="o">=</span> <span class="n">DecisionTreeRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">state</span><span class="p">)</span>
<span class="n">final_rsearch</span> <span class="o">=</span> <span class="n">RandomizedSearchCV</span><span class="p">(</span><span class="n">final_model</span><span class="p">,</span> <span class="n">param_distributions</span><span class="o">=</span><span class="n">param_dict</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> 
                                   <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">smape_scorer</span><span class="p">[</span><span class="s1">&#39;smape&#39;</span><span class="p">],</span> <span class="n">random_state</span><span class="o">=</span><span class="n">state</span><span class="p">)</span>
<span class="n">final_rsearch</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features_train_final</span><span class="p">,</span> <span class="n">target_train_final</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Final&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">9</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Depth:&#39;</span><span class="p">,</span> <span class="n">final_rsearch</span><span class="o">.</span><span class="n">best_params_</span><span class="p">[</span><span class="s1">&#39;max_depth&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sMAPE:&#39;</span><span class="p">,</span> <span class="o">-</span><span class="n">final_rsearch</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Final
=========
Depth: 1
sMAPE: 10.696148904144176
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Decision Tree Regressor&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">final_smape</span><span class="p">(</span><span class="n">rougher_model</span><span class="p">,</span> <span class="n">final_model</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Decision Tree Regressor
15.164551276301438
</pre></div>
</div>
</div>
</div>
<p>Still getting better than regression.</p>
</section>
<section id="random-forest">
<h3>Random Forest<a class="headerlink" href="#random-forest" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">57</span><span class="p">)</span>
<span class="n">param_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> 
              <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">501</span><span class="p">,</span> <span class="mi">100</span><span class="p">)}</span>
<span class="n">rougher_model</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">state</span><span class="p">)</span>
<span class="n">rougher_rsearch</span> <span class="o">=</span> <span class="n">RandomizedSearchCV</span><span class="p">(</span><span class="n">rougher_model</span><span class="p">,</span> <span class="n">param_distributions</span><span class="o">=</span><span class="n">param_dict</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> 
                                     <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">smape_scorer</span><span class="p">[</span><span class="s1">&#39;smape&#39;</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">state</span><span class="p">)</span>
<span class="n">rougher_rsearch</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features_train_rougher</span><span class="p">,</span> <span class="n">target_train_rougher</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Rougher&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">9</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Depth:&#39;</span><span class="p">,</span> <span class="n">rougher_rsearch</span><span class="o">.</span><span class="n">best_params_</span><span class="p">[</span><span class="s1">&#39;max_depth&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Estimators:&#39;</span><span class="p">,</span> <span class="n">rougher_rsearch</span><span class="o">.</span><span class="n">best_params_</span><span class="p">[</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sMAPE:&#39;</span><span class="p">,</span> <span class="o">-</span><span class="n">rougher_rsearch</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fitting 5 folds for each of 3 candidates, totalling 15 fits
[CV 1/5] END ..................max_depth=9, n_estimators=100; total time=  13.1s
[CV 2/5] END ..................max_depth=9, n_estimators=100; total time=  14.3s
[CV 3/5] END ..................max_depth=9, n_estimators=100; total time=  13.8s
[CV 4/5] END ..................max_depth=9, n_estimators=100; total time=  14.0s
[CV 5/5] END ..................max_depth=9, n_estimators=100; total time=  13.7s
[CV 1/5] END .................max_depth=25, n_estimators=200; total time=  43.5s
[CV 2/5] END .................max_depth=25, n_estimators=200; total time=  44.4s
[CV 3/5] END .................max_depth=25, n_estimators=200; total time=  41.7s
[CV 4/5] END .................max_depth=25, n_estimators=200; total time=  42.9s
[CV 5/5] END .................max_depth=25, n_estimators=200; total time=  43.2s
[CV 1/5] END .................max_depth=17, n_estimators=400; total time= 1.3min
[CV 2/5] END .................max_depth=17, n_estimators=400; total time= 1.3min
[CV 3/5] END .................max_depth=17, n_estimators=400; total time= 1.3min
[CV 4/5] END .................max_depth=17, n_estimators=400; total time= 1.3min
[CV 5/5] END .................max_depth=17, n_estimators=400; total time= 1.5min
Rougher
=========
Depth: 25
Estimators: 200
sMAPE: 6.579065351793972
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">57</span><span class="p">)</span>
<span class="n">param_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> 
              <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">501</span><span class="p">,</span> <span class="mi">100</span><span class="p">)}</span>
<span class="n">final_model</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">state</span><span class="p">)</span>
<span class="n">final_rsearch</span> <span class="o">=</span> <span class="n">RandomizedSearchCV</span><span class="p">(</span><span class="n">final_model</span><span class="p">,</span> <span class="n">param_distributions</span><span class="o">=</span><span class="n">param_dict</span><span class="p">,</span> 
                                   <span class="n">scoring</span><span class="o">=</span><span class="n">smape_scorer</span><span class="p">[</span><span class="s1">&#39;smape&#39;</span><span class="p">],</span> <span class="n">random_state</span><span class="o">=</span><span class="n">state</span><span class="p">,</span> 
                                   <span class="n">n_iter</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">final_rsearch</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features_train_final</span><span class="p">,</span> <span class="n">target_train_final</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Final&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">9</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Depth:&#39;</span><span class="p">,</span> <span class="n">final_rsearch</span><span class="o">.</span><span class="n">best_params_</span><span class="p">[</span><span class="s1">&#39;max_depth&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Estimators:&#39;</span><span class="p">,</span> <span class="n">final_rsearch</span><span class="o">.</span><span class="n">best_params_</span><span class="p">[</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sMAPE:&#39;</span><span class="p">,</span> <span class="o">-</span><span class="n">final_rsearch</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fitting 5 folds for each of 3 candidates, totalling 15 fits
[CV 1/5] END ..................max_depth=9, n_estimators=100; total time=   5.7s
[CV 2/5] END ..................max_depth=9, n_estimators=100; total time=   5.5s
[CV 3/5] END ..................max_depth=9, n_estimators=100; total time=   5.6s
[CV 4/5] END ..................max_depth=9, n_estimators=100; total time=   5.5s
[CV 5/5] END ..................max_depth=9, n_estimators=100; total time=   5.6s
[CV 1/5] END .................max_depth=25, n_estimators=200; total time=  20.9s
[CV 2/5] END .................max_depth=25, n_estimators=200; total time=  20.8s
[CV 3/5] END .................max_depth=25, n_estimators=200; total time=  21.1s
[CV 4/5] END .................max_depth=25, n_estimators=200; total time=  21.7s
[CV 5/5] END .................max_depth=25, n_estimators=200; total time=  20.4s
[CV 1/5] END .................max_depth=17, n_estimators=400; total time=  43.6s
[CV 2/5] END .................max_depth=17, n_estimators=400; total time=  34.9s
[CV 3/5] END .................max_depth=17, n_estimators=400; total time=  34.0s
[CV 4/5] END .................max_depth=17, n_estimators=400; total time=  33.4s
[CV 5/5] END .................max_depth=17, n_estimators=400; total time=  33.3s
Final
=========
Depth: 9
Estimators: 100
sMAPE: 11.569195550002608
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Random Forest Regressor&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">final_smape</span><span class="p">(</span><span class="n">rougher_model</span><span class="p">,</span> <span class="n">final_model</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Random Forest Regressor
10.659435013788764
</pre></div>
</div>
</div>
</div>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p>Linear regression</p></th>
<th class="head"><p>Decision tree</p></th>
<th class="head"><p>Random forest</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Flotation</p></td>
<td><p>7.45</p></td>
<td><p>7.24</p></td>
<td><p>6.58</p></td>
</tr>
<tr class="row-odd"><td><p>Cleaning</p></td>
<td><p>10.74</p></td>
<td><p>10.70</p></td>
<td><p>11.57</p></td>
</tr>
<tr class="row-even"><td><p>Total</p></td>
<td><p>9.92</p></td>
<td><p>15.16</p></td>
<td><p>10.66</p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<section id="sanity-check">
<h2>Sanity check<a class="headerlink" href="#sanity-check" title="Link to this heading">#</a></h2>
<p>Let’s try a model not based on features.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rougher_model</span> <span class="o">=</span> <span class="n">DummyRegressor</span><span class="p">()</span>
<span class="n">rougher_scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">rougher_model</span><span class="p">,</span> <span class="n">features_train_rougher</span><span class="p">,</span> 
                                <span class="n">target_train_rougher</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">smape_scorer</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Rougher&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">9</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;R2:&#39;</span><span class="p">,</span> <span class="o">-</span><span class="n">rougher_scores</span><span class="p">[</span><span class="s1">&#39;test_r2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="o">-</span><span class="n">rougher_scores</span><span class="p">[</span><span class="s1">&#39;test_r2&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sMAPE (%):&#39;</span><span class="p">,</span> <span class="o">-</span><span class="n">rougher_scores</span><span class="p">[</span><span class="s1">&#39;test_smape&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="o">-</span><span class="n">rougher_scores</span><span class="p">[</span><span class="s1">&#39;test_smape&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Rougher
=========
R2: 0.365302805552006
[5.81968798e-01 1.36949960e-01 1.72912192e-06 2.54574508e-01
 8.53019033e-01]

sMAPE (%): 7.7722620001298095
[9.9895236  7.70310196 4.94498109 7.33810869 8.88559467]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">final_model</span> <span class="o">=</span> <span class="n">DummyRegressor</span><span class="p">()</span>
<span class="n">final_scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">final_model</span><span class="p">,</span> <span class="n">features_train_final</span><span class="p">,</span> 
                                <span class="n">target_train_final</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">smape_scorer</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Final&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">9</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;R2:&#39;</span><span class="p">,</span> <span class="o">-</span><span class="n">final_scores</span><span class="p">[</span><span class="s1">&#39;test_r2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="o">-</span><span class="n">final_scores</span><span class="p">[</span><span class="s1">&#39;test_r2&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sMAPE (%):&#39;</span><span class="p">,</span> <span class="o">-</span><span class="n">final_scores</span><span class="p">[</span><span class="s1">&#39;test_smape&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="o">-</span><span class="n">final_scores</span><span class="p">[</span><span class="s1">&#39;test_smape&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Final
=========
R2: 0.0863643554436349
[0.13694314 0.00279689 0.09027457 0.02873585 0.17307133]

sMAPE (%): 10.300434241031462
[10.45087478  9.14192891  9.30148826 11.25188139 11.35599786]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dummy Regressor&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">final_smape</span><span class="p">(</span><span class="n">rougher_model</span><span class="p">,</span> <span class="n">final_model</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dummy Regressor
9.668391180806049
</pre></div>
</div>
</div>
</div>
<p>It turns out that the random model predicts better than the fitted one. Well, we shall test a fitted one anyway.</p>
</section>
<section id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Link to this heading">#</a></h2>
<p>For flotation we will take a random forest (200 trees of depth 25), for cleaning we will take a decisive tree of depth 1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rougher_model</span> <span class="o">=</span>  <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">rougher_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features_train_rougher</span><span class="p">,</span> <span class="n">target_train_rougher</span><span class="p">)</span>
<span class="n">predictions_rougher</span> <span class="o">=</span> <span class="n">rougher_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">features_test_rougher</span><span class="p">)</span>
<span class="n">rougher_smape</span> <span class="o">=</span> <span class="n">smape</span><span class="p">(</span><span class="n">target_test_rougher</span><span class="p">,</span> <span class="n">predictions_rougher</span><span class="p">)</span>

<span class="n">final_model</span> <span class="o">=</span> <span class="n">DecisionTreeRegressor</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">final_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features_train_final</span><span class="p">,</span> <span class="n">target_train_final</span><span class="p">)</span>
<span class="n">predictions_final</span> <span class="o">=</span> <span class="n">final_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">features_test_final</span><span class="p">)</span>
<span class="n">final_smape</span> <span class="o">=</span> <span class="n">smape</span><span class="p">(</span><span class="n">target_test_final</span><span class="p">,</span> <span class="n">predictions_final</span><span class="p">)</span>
                                        
<span class="n">final_smape_score</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">rougher_smape</span> <span class="o">+</span> <span class="mf">0.75</span> <span class="o">*</span> <span class="n">final_smape</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Final sMAPE:&#39;</span><span class="p">,</span> <span class="n">final_smape_score</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Final sMAPE: 8.103085793277781
</pre></div>
</div>
</div>
</div>
<p>The testing turned out a little better. Probably because the training took place on a validation sample too.</p>
</section>
<section id="conclusions">
<h2>Conclusions<a class="headerlink" href="#conclusions" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Data specifics</p></li>
</ol>
<ul class="simple">
<li><p>Many missing values occur in the table, especially in the numbers of salt concentrations in the waste tailings.</p></li>
<li><p>Although the feature numbers do not vary significantly, they have still been scaled.</p></li>
<li><p>There are negative numbers in the data related to pellet size and feed rate, as well as zero gold concentration numbers. These data were not taken into account.</p></li>
</ul>
<ol class="arabic simple" start="2">
<li><p>Statistics by stage</p></li>
</ol>
<ul class="simple">
<li><p>The total concentration of metals and salts remains almost the same at different stages.</p></li>
<li><p>However, gold concentration increases from 8.5 g/t to 44.3 g/t, while salt concentration drops from 37.0 g/t to 9.9 g/t.</p></li>
<li><p>Silver concentration is 9 g/t at the beginning of the process and 5.2 g/t by the end, while lead concentration goes from 3.6 g/t to 10 g/t.</p></li>
<li><p>The pellets on average have a diameter of 40 to 70 mm. The flow rate is from 400 to 600 cm/sec.</p></li>
<li><p>The concentration of gold in the concentrate and tailings after flotation and after cleaning is almost the same, but after the very last stage the concentration numbers are more converged.</p></li>
</ul>
<ol class="arabic simple" start="3">
<li><p>Model training</p></li>
</ol>
<ul class="simple">
<li><p>Decision trees predict better than linear regression, whereas random forest predicts better than the decision tree.</p></li>
<li><p>The best combination is a random forest of depth 25 out of 200 trees for flotation and a decision tree of depth 1 for the cleaning stage.</p></li>
<li><p>The symmetric mean absolute percentage deviation for this combination is 8.1% based on the test results.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="oil_bootstrap.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Selection of a location for a well</p>
      </div>
    </a>
    <a class="right-next"
       href="data_transformation.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Protection of customers’ personal data</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#task-information">Task information</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#technological-process">Technological process</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#efficiency-calculation">Efficiency calculation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-metric">Quality Metric</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-structure">Data structure</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#functions">Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preprocessing">Data preprocessing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#samples">Samples</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-types">Data Types</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#missing-values">Missing values</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#duplicates">Duplicates</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-selection">Feature selection</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#scaling">Scaling</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exploratory-data-analysis">Exploratory data analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#concentrations-of-metals-at-different-stages">Concentrations of metals at different stages.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#comparison-of-training-and-test-samples">Comparison of training and test samples</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#training">Training</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-regression">Linear Regression.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#decision-tree">Decision Tree</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#random-forest">Random Forest</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sanity-check">Sanity check</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing">Testing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusions">Conclusions</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Leonid Dybovskii
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>