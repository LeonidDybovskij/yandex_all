
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Cars cost determination &#8212; Data Science course</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'cars_boosting';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Taxi orders prediction" href="taxi_time_series.html" />
    <link rel="prev" title="Protection of customers’ personal data" href="data_transformation.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
  
    <p class="title logo__title">Data Science course</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Data Science course
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="credit_scoring.html">Credit scoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="real_estate_market_analysis.html">Real estate market analysis in St. Petersburg</a></li>
<li class="toctree-l1"><a class="reference internal" href="tariff_stats.html">Tariff statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="computer_games.html">Analysis of the computer games market</a></li>
<li class="toctree-l1"><a class="reference internal" href="tariff_recommendation.html">Tariff recommendation</a></li>
<li class="toctree-l1"><a class="reference internal" href="supervised_classification.html">Customer churn</a></li>
<li class="toctree-l1"><a class="reference internal" href="oil_bootstrap.html">Selection of a location for a well</a></li>
<li class="toctree-l1"><a class="reference internal" href="gold_recovery.html">Gold recovery</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_transformation.html">Protection of customers’ personal data</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Cars cost determination</a></li>
<li class="toctree-l1"><a class="reference internal" href="taxi_time_series.html">Taxi orders prediction</a></li>
<li class="toctree-l1"><a class="reference internal" href="text_classification.html">Classification of comments</a></li>
<li class="toctree-l1"><a class="reference internal" href="computer_vision.html">Age prediction by photo</a></li>
<li class="toctree-l1"><a class="reference internal" href="regression_metallurgy.html">Steel temperature prediction</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/cars_boosting.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Cars cost determination</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#primary-data-analysis">Primary data analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#qualitative-variables">Qualitative variables</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#vehicle-body-type">Vehicle body type</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#gearbox">Gearbox</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#car-model">Car model</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#month-of-registration">Month of registration</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#fuel-type">Fuel type</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#car-brand">Car brand</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#breakdown-history">Breakdown history</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#postal-code">Postal code</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#quantitative-variables">Quantitative variables</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#price">Price</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-year-of-registration">The year of registration</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#engine-power">Engine power</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#mileage">Mileage</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#number-of-photos">Number of photos</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#price-dynamics">Price dynamics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#duplicates">Duplicates</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preprocessing">Data preprocessing.</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#renaming">Renaming</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#deduplication">Deduplication</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-types">Data types</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#missing-values">Missing values</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#anomalies">Anomalies</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exploratory-data-analysis">Exploratory data analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#period">Period</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Postal code</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Vehicle body type</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#registration-year">Registration year</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Gearbox</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Engine power</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Car model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Mileage</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#month">Month</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Fuel type</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#brand">Brand</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Breakdown history</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#relationship-of-attributes">Relationship of attributes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#samples">Samples</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#features-for-training">Features for training</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#splitting">Splitting</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#scaling">Scaling</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#samples-with-one-hot-encoding">Samples with one-hot encoding</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#samples-with-ordinal-encoding">Samples with ordinal encoding</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#training">Training</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-regression">Linear regression</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#random-forest">Random forest</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lightgbm">LightGBM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#catboost">CatBoost</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#xgboost">XGBoost</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#results">Results</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sanity-check">Sanity check</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing">Testing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusions">Conclusions</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="cars-cost-determination">
<h1>Cars cost determination<a class="headerlink" href="#cars-cost-determination" title="Link to this heading">#</a></h1>
<ol class="arabic simple">
<li><p>The customer is a service for selling used cars.</p></li>
<li><p>The end result is an app where you can find out the market value of your car.</p></li>
<li><p>It is necessary to build a model that manages to define it.</p></li>
<li><p>Specifications, equipment and prices of other cars are available.</p></li>
</ol>
<p>Criteria that are important for the customer:</p>
<ul class="simple">
<li><p>quality of prediction;</p></li>
<li><p>model training time;</p></li>
<li><p>model prediction time.</p></li>
</ul>
<p>RMSE is recommended as a quality metric with a desired value of RMSE &lt; 2500.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>distinctipy<span class="w"> </span>colorcet<span class="w"> </span>pgeocode<span class="w"> </span>geopy<span class="w"> </span>xgboost
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: distinctipy in /home/leonid/anaconda3/envs/practicum/lib/python3.9/site-packages (1.2.2)
Requirement already satisfied: colorcet in /home/leonid/anaconda3/envs/practicum/lib/python3.9/site-packages (3.0.1)
Requirement already satisfied: pgeocode in /home/leonid/anaconda3/envs/practicum/lib/python3.9/site-packages (0.4.0)
Requirement already satisfied: geopy in /home/leonid/anaconda3/envs/practicum/lib/python3.9/site-packages (2.3.0)
Requirement already satisfied: xgboost in /home/leonid/anaconda3/envs/practicum/lib/python3.9/site-packages (1.7.5)
Requirement already satisfied: numpy in /home/leonid/anaconda3/envs/practicum/lib/python3.9/site-packages (from distinctipy) (1.23.5)
Requirement already satisfied: pyct&gt;=0.4.4 in /home/leonid/anaconda3/envs/practicum/lib/python3.9/site-packages (from colorcet) (0.5.0)
Requirement already satisfied: requests in /home/leonid/anaconda3/envs/practicum/lib/python3.9/site-packages (from pgeocode) (2.28.1)
Requirement already satisfied: pandas in /home/leonid/anaconda3/envs/practicum/lib/python3.9/site-packages (from pgeocode) (1.2.4)
Requirement already satisfied: geographiclib&lt;3,&gt;=1.52 in /home/leonid/anaconda3/envs/practicum/lib/python3.9/site-packages (from geopy) (2.0)
Requirement already satisfied: scipy in /home/leonid/anaconda3/envs/practicum/lib/python3.9/site-packages (from xgboost) (1.8.0)
Requirement already satisfied: param&gt;=1.7.0 in /home/leonid/anaconda3/envs/practicum/lib/python3.9/site-packages (from pyct&gt;=0.4.4-&gt;colorcet) (1.13.0)
Requirement already satisfied: python-dateutil&gt;=2.7.3 in /home/leonid/anaconda3/envs/practicum/lib/python3.9/site-packages (from pandas-&gt;pgeocode) (2.8.2)
Requirement already satisfied: pytz&gt;=2017.3 in /home/leonid/anaconda3/envs/practicum/lib/python3.9/site-packages (from pandas-&gt;pgeocode) (2022.7)
Requirement already satisfied: certifi&gt;=2017.4.17 in /home/leonid/anaconda3/envs/practicum/lib/python3.9/site-packages (from requests-&gt;pgeocode) (2024.8.30)
Requirement already satisfied: charset-normalizer&lt;3,&gt;=2 in /home/leonid/anaconda3/envs/practicum/lib/python3.9/site-packages (from requests-&gt;pgeocode) (2.0.4)
Requirement already satisfied: urllib3&lt;1.27,&gt;=1.21.1 in /home/leonid/anaconda3/envs/practicum/lib/python3.9/site-packages (from requests-&gt;pgeocode) (1.26.14)
Requirement already satisfied: idna&lt;4,&gt;=2.5 in /home/leonid/anaconda3/envs/practicum/lib/python3.9/site-packages (from requests-&gt;pgeocode) (3.4)
Requirement already satisfied: six&gt;=1.5 in /home/leonid/anaconda3/envs/practicum/lib/python3.9/site-packages (from python-dateutil&gt;=2.7.3-&gt;pandas-&gt;pgeocode) (1.16.0)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>seaborn<span class="w"> </span>--upgrade
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: seaborn in /home/leonid/anaconda3/envs/practicum/lib/python3.9/site-packages (0.13.2)
Requirement already satisfied: numpy!=1.24.0,&gt;=1.20 in /home/leonid/anaconda3/envs/practicum/lib/python3.9/site-packages (from seaborn) (1.23.5)
Requirement already satisfied: pandas&gt;=1.2 in /home/leonid/anaconda3/envs/practicum/lib/python3.9/site-packages (from seaborn) (1.2.4)
Requirement already satisfied: matplotlib!=3.6.1,&gt;=3.4 in /home/leonid/anaconda3/envs/practicum/lib/python3.9/site-packages (from seaborn) (3.7.0)
Requirement already satisfied: contourpy&gt;=1.0.1 in /home/leonid/anaconda3/envs/practicum/lib/python3.9/site-packages (from matplotlib!=3.6.1,&gt;=3.4-&gt;seaborn) (1.0.5)
Requirement already satisfied: pillow&gt;=6.2.0 in /home/leonid/anaconda3/envs/practicum/lib/python3.9/site-packages (from matplotlib!=3.6.1,&gt;=3.4-&gt;seaborn) (9.4.0)
Requirement already satisfied: pyparsing&gt;=2.3.1 in /home/leonid/anaconda3/envs/practicum/lib/python3.9/site-packages (from matplotlib!=3.6.1,&gt;=3.4-&gt;seaborn) (3.0.9)
Requirement already satisfied: cycler&gt;=0.10 in /home/leonid/anaconda3/envs/practicum/lib/python3.9/site-packages (from matplotlib!=3.6.1,&gt;=3.4-&gt;seaborn) (0.11.0)
Requirement already satisfied: packaging&gt;=20.0 in /home/leonid/anaconda3/envs/practicum/lib/python3.9/site-packages (from matplotlib!=3.6.1,&gt;=3.4-&gt;seaborn) (22.0)
Requirement already satisfied: fonttools&gt;=4.22.0 in /home/leonid/anaconda3/envs/practicum/lib/python3.9/site-packages (from matplotlib!=3.6.1,&gt;=3.4-&gt;seaborn) (4.25.0)
Requirement already satisfied: python-dateutil&gt;=2.7 in /home/leonid/anaconda3/envs/practicum/lib/python3.9/site-packages (from matplotlib!=3.6.1,&gt;=3.4-&gt;seaborn) (2.8.2)
Requirement already satisfied: kiwisolver&gt;=1.0.1 in /home/leonid/anaconda3/envs/practicum/lib/python3.9/site-packages (from matplotlib!=3.6.1,&gt;=3.4-&gt;seaborn) (1.4.4)
Requirement already satisfied: importlib-resources&gt;=3.2.0 in /home/leonid/anaconda3/envs/practicum/lib/python3.9/site-packages (from matplotlib!=3.6.1,&gt;=3.4-&gt;seaborn) (5.2.0)
Requirement already satisfied: pytz&gt;=2017.3 in /home/leonid/anaconda3/envs/practicum/lib/python3.9/site-packages (from pandas&gt;=1.2-&gt;seaborn) (2022.7)
Requirement already satisfied: zipp&gt;=3.1.0 in /home/leonid/anaconda3/envs/practicum/lib/python3.9/site-packages (from importlib-resources&gt;=3.2.0-&gt;matplotlib!=3.6.1,&gt;=3.4-&gt;seaborn) (3.11.0)
Requirement already satisfied: six&gt;=1.5 in /home/leonid/anaconda3/envs/practicum/lib/python3.9/site-packages (from python-dateutil&gt;=2.7-&gt;matplotlib!=3.6.1,&gt;=3.4-&gt;seaborn) (1.16.0)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sb</span>
<span class="kn">import</span> <span class="nn">lightgbm</span> <span class="k">as</span> <span class="nn">lgb</span>
<span class="kn">import</span> <span class="nn">sklearn</span>
<span class="kn">import</span> <span class="nn">pgeocode</span>
<span class="kn">import</span> <span class="nn">catboost</span>
<span class="kn">import</span> <span class="nn">xgboost</span>

<span class="kn">from</span> <span class="nn">geopy.geocoders</span> <span class="kn">import</span> <span class="n">Nominatim</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">OrdinalEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span> <span class="k">as</span> <span class="n">mse</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span><span class="p">,</span> <span class="n">cross_validate</span><span class="p">,</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span> 
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.dummy</span> <span class="kn">import</span> <span class="n">DummyRegressor</span>
<span class="kn">from</span> <span class="nn">catboost</span> <span class="kn">import</span> <span class="n">CatBoostRegressor</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sb</span><span class="o">.</span><span class="n">__version__</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;0.13.2&#39;
</pre></div>
</div>
</div>
</div>
<p>Seaborn 0.12.0+ is needed.</p>
<section id="primary-data-analysis">
<h2>Primary data analysis<a class="headerlink" href="#primary-data-analysis" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;autos.csv&#39;</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/datasets/autos.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>DateCrawled</th>
      <th>Price</th>
      <th>VehicleType</th>
      <th>RegistrationYear</th>
      <th>Gearbox</th>
      <th>Power</th>
      <th>Model</th>
      <th>Kilometer</th>
      <th>RegistrationMonth</th>
      <th>FuelType</th>
      <th>Brand</th>
      <th>Repaired</th>
      <th>DateCreated</th>
      <th>NumberOfPictures</th>
      <th>PostalCode</th>
      <th>LastSeen</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2016-03-24 11:52:17</td>
      <td>480</td>
      <td>NaN</td>
      <td>1993</td>
      <td>manual</td>
      <td>0</td>
      <td>golf</td>
      <td>150000</td>
      <td>0</td>
      <td>petrol</td>
      <td>volkswagen</td>
      <td>NaN</td>
      <td>2016-03-24 00:00:00</td>
      <td>0</td>
      <td>70435</td>
      <td>2016-04-07 03:16:57</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2016-03-24 10:58:45</td>
      <td>18300</td>
      <td>coupe</td>
      <td>2011</td>
      <td>manual</td>
      <td>190</td>
      <td>NaN</td>
      <td>125000</td>
      <td>5</td>
      <td>gasoline</td>
      <td>audi</td>
      <td>yes</td>
      <td>2016-03-24 00:00:00</td>
      <td>0</td>
      <td>66954</td>
      <td>2016-04-07 01:46:50</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2016-03-14 12:52:21</td>
      <td>9800</td>
      <td>suv</td>
      <td>2004</td>
      <td>auto</td>
      <td>163</td>
      <td>grand</td>
      <td>125000</td>
      <td>8</td>
      <td>gasoline</td>
      <td>jeep</td>
      <td>NaN</td>
      <td>2016-03-14 00:00:00</td>
      <td>0</td>
      <td>90480</td>
      <td>2016-04-05 12:47:46</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2016-03-17 16:54:04</td>
      <td>1500</td>
      <td>small</td>
      <td>2001</td>
      <td>manual</td>
      <td>75</td>
      <td>golf</td>
      <td>150000</td>
      <td>6</td>
      <td>petrol</td>
      <td>volkswagen</td>
      <td>no</td>
      <td>2016-03-17 00:00:00</td>
      <td>0</td>
      <td>91074</td>
      <td>2016-03-17 17:40:17</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2016-03-31 17:25:20</td>
      <td>3600</td>
      <td>small</td>
      <td>2008</td>
      <td>manual</td>
      <td>69</td>
      <td>fabia</td>
      <td>90000</td>
      <td>7</td>
      <td>gasoline</td>
      <td>skoda</td>
      <td>no</td>
      <td>2016-03-31 00:00:00</td>
      <td>0</td>
      <td>60437</td>
      <td>2016-04-06 10:17:21</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>354364</th>
      <td>2016-03-21 09:50:58</td>
      <td>0</td>
      <td>NaN</td>
      <td>2005</td>
      <td>manual</td>
      <td>0</td>
      <td>colt</td>
      <td>150000</td>
      <td>7</td>
      <td>petrol</td>
      <td>mitsubishi</td>
      <td>yes</td>
      <td>2016-03-21 00:00:00</td>
      <td>0</td>
      <td>2694</td>
      <td>2016-03-21 10:42:49</td>
    </tr>
    <tr>
      <th>354365</th>
      <td>2016-03-14 17:48:27</td>
      <td>2200</td>
      <td>NaN</td>
      <td>2005</td>
      <td>NaN</td>
      <td>0</td>
      <td>NaN</td>
      <td>20000</td>
      <td>1</td>
      <td>NaN</td>
      <td>sonstige_autos</td>
      <td>NaN</td>
      <td>2016-03-14 00:00:00</td>
      <td>0</td>
      <td>39576</td>
      <td>2016-04-06 00:46:52</td>
    </tr>
    <tr>
      <th>354366</th>
      <td>2016-03-05 19:56:21</td>
      <td>1199</td>
      <td>convertible</td>
      <td>2000</td>
      <td>auto</td>
      <td>101</td>
      <td>fortwo</td>
      <td>125000</td>
      <td>3</td>
      <td>petrol</td>
      <td>smart</td>
      <td>no</td>
      <td>2016-03-05 00:00:00</td>
      <td>0</td>
      <td>26135</td>
      <td>2016-03-11 18:17:12</td>
    </tr>
    <tr>
      <th>354367</th>
      <td>2016-03-19 18:57:12</td>
      <td>9200</td>
      <td>bus</td>
      <td>1996</td>
      <td>manual</td>
      <td>102</td>
      <td>transporter</td>
      <td>150000</td>
      <td>3</td>
      <td>gasoline</td>
      <td>volkswagen</td>
      <td>no</td>
      <td>2016-03-19 00:00:00</td>
      <td>0</td>
      <td>87439</td>
      <td>2016-04-07 07:15:26</td>
    </tr>
    <tr>
      <th>354368</th>
      <td>2016-03-20 19:41:08</td>
      <td>3400</td>
      <td>wagon</td>
      <td>2002</td>
      <td>manual</td>
      <td>100</td>
      <td>golf</td>
      <td>150000</td>
      <td>6</td>
      <td>gasoline</td>
      <td>volkswagen</td>
      <td>NaN</td>
      <td>2016-03-20 00:00:00</td>
      <td>0</td>
      <td>40764</td>
      <td>2016-03-24 12:45:21</td>
    </tr>
  </tbody>
</table>
<p>354369 rows × 16 columns</p>
</div></div></div>
</div>
<p>Features: <a id='features'></a></p>
<ul class="simple">
<li><p>DateCrawled — date of downloading the questionnaire from the database</p></li>
<li><p>VehicleType — vehicle body type</p></li>
<li><p>RegistrationYear — vehicle registration year</p></li>
<li><p>Gearbox — gearbox type</p></li>
<li><p>Power — power (hp)</p></li>
<li><p>Model — car model</p></li>
<li><p>Kilometer — mileage (km)</p></li>
<li><p>RegistrationMonth — vehicle registration month</p></li>
<li><p>FuelType — fuel type</p></li>
<li><p>Brand — car brand</p></li>
<li><p>Repaired — whether or not the car has been repaired</p></li>
<li><p>DateCreated — questionnaire creation date</p></li>
<li><p>NumberOfPictures — number of photos of the vehicle</p></li>
<li><p>PostalCode — postal code of the questionnaire owner (user)</p></li>
<li><p>LastSeen — date of last user activity</p></li>
</ul>
<p>Target:</p>
<ul class="simple">
<li><p>Price — price (euro)</p></li>
</ul>
<p>The plan for the analysis is as follows:</p>
<ol class="arabic simple">
<li><p>Construct bar charts for the qualitative variables</p></li>
<li><p>Construct histograms for quantitative variables</p></li>
<li><p>Construct whisker boxes for quantitative variables</p></li>
<li><p>View price trends by day</p></li>
<li><p>Estimate the number of missing values</p></li>
<li><p>Count duplicates</p></li>
<li><p>Estimate the impact of emissions</p></li>
</ol>
<section id="qualitative-variables">
<h3>Qualitative variables<a class="headerlink" href="#qualitative-variables" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DateCrawled          object
Price                 int64
VehicleType          object
RegistrationYear      int64
Gearbox              object
Power                 int64
Model                object
Kilometer             int64
RegistrationMonth     int64
FuelType             object
Brand                object
Repaired             object
DateCreated          object
NumberOfPictures      int64
PostalCode            int64
LastSeen             object
dtype: object
</pre></div>
</div>
</div>
</div>
<p>Let’s see what values occur in the columns:</p>
<ul class="simple">
<li><p>VehicleType</p></li>
<li><p>Gearbox</p></li>
<li><p>Model</p></li>
<li><p>RegistrationMonth</p></li>
<li><p>FuelType</p></li>
<li><p>Brand</p></li>
<li><p>Repaired</p></li>
<li><p>PostalCode</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">barplot_from_counts</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">by_index</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">patches</span> <span class="k">as</span> <span class="n">mpatches</span>
    <span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">MaxNLocator</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">series</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">9</span><span class="p">:</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colormaps</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;Set1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">colors</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">colorcet</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">colorcet</span><span class="o">.</span><span class="n">glasbey</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">series</span><span class="p">)]</span> 
        <span class="c1"># import distinctipy</span>
        <span class="c1"># colors = distinctipy.get_colors(len(series), pastel_factor=0.57)</span>
        
    <span class="k">if</span> <span class="n">by_index</span><span class="p">:</span>
        <span class="n">series</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
    
    <span class="n">series</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">legend</span> <span class="o">=</span> <span class="p">[]</span>    
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">series</span><span class="p">)):</span>
        <span class="n">legend</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">row</span><span class="p">],</span> 
            <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">row</span><span class="p">],</span> <span class="n">series</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">row</span><span class="p">])))</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> 
            <span class="n">height</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
            <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MaxNLocator</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">series</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">legend</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<section id="vehicle-body-type">
<h4>Vehicle body type<a class="headerlink" href="#vehicle-body-type" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;VehicleType&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>37490
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;VehicleType&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.1057936783409384
</pre></div>
</div>
</div>
</div>
<p>10.57% of cars have an unknown body type.</p>
<p>Let’s look at the rest of them.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">barplot_from_counts</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;VehicleType&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/606703c77abf002527b85186717bf290526c0db11bc5b06f7c19d5b990d25c61.png" src="_images/606703c77abf002527b85186717bf290526c0db11bc5b06f7c19d5b990d25c61.png" />
</div>
</div>
<p>There is little difference between other and NaN. Let’s replace missing values with “other” at the preprocessing stage.</p>
</section>
<section id="gearbox">
<h4>Gearbox<a class="headerlink" href="#gearbox" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Gearbox&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19833
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">barplot_from_counts</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Gearbox&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3cc1d4c7dc0714c4e3dc1f2b8295dc4ce045fceb140b2a2974cd6de4b7032d2b.png" src="_images/3cc1d4c7dc0714c4e3dc1f2b8295dc4ce045fceb140b2a2974cd6de4b7032d2b.png" />
</div>
</div>
<p>This is a significant imbalance. We can try to take it into account at the stage of preparing samples. If it takes too long to work on the whole dataset.</p>
</section>
<section id="car-model">
<h4>Car model<a class="headerlink" href="#car-model" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19705
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>golf                  29232
other                 24421
3er                   19761
polo                  13066
corsa                 12570
                      ...  
serie_2                   8
rangerover                4
serie_3                   4
range_rover_evoque        2
serie_1                   2
Name: Model, Length: 250, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>There are 250 models in total. Here also all the missing values will pass to the “other” category. I wonder if these models are unambiguously categorized by brand.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Model&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;golf&#39;</span><span class="p">][</span><span class="s1">&#39;Brand&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;volkswagen&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<p>All cars of the golf model belong to the Volkswagen brand. At the EDA stage we will have to check this for the others as well.</p>
</section>
<section id="month-of-registration">
<h4>Month of registration<a class="headerlink" href="#month-of-registration" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">barplot_from_counts</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;RegistrationMonth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(),</span> <span class="n">by_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/fd9b155946810425812fd876caa8ea387f81ece1c389794882ff107f603ac246.png" src="_images/fd9b155946810425812fd876caa8ea387f81ece1c389794882ff107f603ac246.png" />
</div>
</div>
<p>Maybe there is some seasonal logic here, but what is important is how the month affects the price. What is really puzzling is that there are 13 months. Apparently month 0 is an unspecified one.</p>
</section>
<section id="fuel-type">
<h4>Fuel type<a class="headerlink" href="#fuel-type" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;FuelType&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>32895
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;FuelType&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>petrol      216352
gasoline     98720
lpg           5310
cng            565
hybrid         233
other          204
electric        90
Name: FuelType, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Here it is not so clear that missing values should be transferred to the category “other”. Nevertheless, let’s do it. It will be necessary to check how often the values of the category “other” will coincide across the lines.</p>
</section>
<section id="car-brand">
<h4>Car brand<a class="headerlink" href="#car-brand" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Brand&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">barplot_from_counts</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Brand&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/8c14bf56aa04bb32421805aeee13f738890b6c7032830efed5fc5bf9fd009ca4.png" src="_images/8c14bf56aa04bb32421805aeee13f738890b6c7032830efed5fc5bf9fd009ca4.png" />
</div>
</div>
<p>Volkswagen is clearly in the lead. Das auto.</p>
</section>
<section id="breakdown-history">
<h4>Breakdown history<a class="headerlink" href="#breakdown-history" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Repaired&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>71154
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">barplot_from_counts</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Repaired&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/1caee01bab802a0440ab48a35b27574348ef4c8f605ddf844e6abe78ac13b612.png" src="_images/1caee01bab802a0440ab48a35b27574348ef4c8f605ddf844e6abe78ac13b612.png" />
</div>
</div>
<p>I wonder who checks this. Because if the owners themselves indicate, these numbers may not reflect reality.</p>
</section>
<section id="postal-code">
<h4>Postal code<a class="headerlink" href="#postal-code" title="Link to this heading">#</a></h4>
<p>Despite the fact that there are a lot of values here, it is still a categorical variable. There is no way to make a bar chart, so let’s try to estimate it without a graph.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PostalCode&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10115    819
65428    613
66333    343
32257    317
44145    317
        ... 
21782      1
9517       1
29367      1
38325      1
82404      1
Name: PostalCode, Length: 8143, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>The distribution is clearly uneven. On the other hand, different numbers of people with different numbers of cars may live in the areas of two zip codes.</p>
<p>Maybe we can group it by area?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">list_of_states</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">postal_code</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;10115&#39;</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">country</span> <span class="ow">in</span> <span class="n">pgeocode</span><span class="o">.</span><span class="n">COUNTRIES_VALID</span><span class="p">:</span>
        <span class="n">nomi</span> <span class="o">=</span> <span class="n">pgeocode</span><span class="o">.</span><span class="n">Nominatim</span><span class="p">(</span><span class="n">country</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">nomi</span><span class="o">.</span><span class="n">query_postal_code</span><span class="p">(</span><span class="n">postal_code</span><span class="p">)[</span><span class="s1">&#39;state_name&#39;</span><span class="p">]):</span>
            <span class="n">list_of_states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nomi</span><span class="o">.</span><span class="n">query_postal_code</span><span class="p">(</span><span class="n">postal_code</span><span class="p">)[</span><span class="s1">&#39;state_name&#39;</span><span class="p">])</span>
<span class="n">list_of_states</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/leonid/anaconda3/envs/practicum/lib/python3.9/site-packages/pgeocode.py:216: UserWarning: The Argentina data file contains 4-digit postal codes which were replaced with a new system in 1999.
  warnings.warn(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 6.39 s, sys: 896 ms, total: 7.29 s
Wall time: 7.54 s
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Berlin&#39;, &#39;Harju maakond&#39;, &#39;경기도&#39;, &#39;Western Province&#39;, &#39;New York&#39;]
</pre></div>
</div>
</div>
</div>
<p>Apparently not. It is not clear which country to put in the category.</p>
</section>
</section>
<section id="quantitative-variables">
<h3>Quantitative variables<a class="headerlink" href="#quantitative-variables" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DateCrawled          object
Price                 int64
VehicleType          object
RegistrationYear      int64
Gearbox              object
Power                 int64
Model                object
Kilometer             int64
RegistrationMonth     int64
FuelType             object
Brand                object
Repaired             object
DateCreated          object
NumberOfPictures      int64
PostalCode            int64
LastSeen             object
dtype: object
</pre></div>
</div>
</div>
</div>
<p>Let’s look at the columns</p>
<ul class="simple">
<li><p>Price</p></li>
<li><p>RegistrationYear</p></li>
<li><p>Power</p></li>
<li><p>Kilometer</p></li>
<li><p>NumberOfPictures</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">hist_from_series</span><span class="p">(</span><span class="n">series</span><span class="p">):</span>
    <span class="c1"># sb.set(style=&quot;ticks&quot;)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax_box</span><span class="p">,</span> <span class="n">ax_hist</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> 
                                      <span class="n">gridspec_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;height_ratios&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">.20</span><span class="p">,</span> <span class="mf">.8</span><span class="p">)})</span>
    <span class="n">box</span> <span class="o">=</span> <span class="n">sb</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">series</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax_box</span><span class="p">)</span>
    <span class="n">hist</span> <span class="o">=</span> <span class="n">sb</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">series</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax_hist</span><span class="p">)</span>
    
    <span class="n">box</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">box</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">sb</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax_box</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="n">hist</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">series</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">hist</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Count&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">hist</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">sb</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax_hist</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<section id="price">
<h4>Price<a class="headerlink" href="#price" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">series</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Price&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hist_from_series</span><span class="p">(</span><span class="n">series</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/192455c79f01d6d3fc3a14bccb85596ff2173b50c0c553a5df01ed8c70ba997a.png" src="_images/192455c79f01d6d3fc3a14bccb85596ff2173b50c0c553a5df01ed8c70ba997a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">series</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0        10772
500       5670
1500      5394
1000      4649
1200      4594
         ...  
13180        1
10879        1
2683         1
634          1
8188         1
Name: Price, Length: 3731, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Those zeros will have to be replaced with something. The median of the year of manufacture or something. On the other hand, 11.000 is about 3%, we can throw it away.</p>
</section>
<section id="the-year-of-registration">
<h4>The year of registration<a class="headerlink" href="#the-year-of-registration" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">series</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;RegistrationYear&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">series</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2000    24490
1999    22728
2005    22109
2001    20124
2006    19900
        ...  
4100        1
1200        1
5300        1
8888        1
2290        1
Name: RegistrationYear, Length: 151, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>There are clearly anomalies here.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hist_from_series</span><span class="p">(</span><span class="n">series</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">series</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">series</span><span class="p">)</span> <span class="o">&amp;</span> 
                            <span class="p">(</span><span class="n">series</span> <span class="o">&lt;</span> <span class="n">series</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.999</span><span class="p">))])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/8bc08bea4d04fbdf7562d849adf62b488a67a161575a1a0b54247a60cf307419.png" src="_images/8bc08bea4d04fbdf7562d849adf62b488a67a161575a1a0b54247a60cf307419.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">series</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([1000, 1001, 1039, 1111, 1200, 1234, 1253, 1255, 1300, 1400, 1500,
       1600, 1602, 1688, 1800, 1910, 1915, 1919, 1920, 1923, 1925, 1927,
       1928, 1929, 1930, 1931, 1932, 1933, 1934, 1935, 1936, 1937, 1938,
       1940, 1941, 1942, 1943, 1944, 1945, 1946, 1947, 1948, 1949, 1950,
       1951, 1952, 1953, 1954, 1955, 1956, 1957, 1958, 1959, 1960, 1961,
       1962, 1963, 1964, 1965, 1966, 1967, 1968, 1969, 1970, 1971, 1972,
       1973, 1974, 1975, 1976, 1977, 1978, 1979, 1980, 1981, 1982, 1983,
       1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994,
       1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005,
       2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016,
       2017, 2018, 2019, 2066, 2200, 2222, 2290, 2500, 2800, 2900, 3000,
       3200, 3500, 3700, 3800, 4000, 4100, 4500, 4800, 5000, 5300, 5555,
       5600, 5900, 5911, 6000, 6500, 7000, 7100, 7500, 7800, 8000, 8200,
       8455, 8500, 8888, 9000, 9229, 9450, 9996, 9999])
</pre></div>
</div>
</div>
</div>
<p>Even though everything is clear with the top bar, the cutoff in the 20th century is not clear at all.</p>
</section>
<section id="engine-power">
<h4>Engine power<a class="headerlink" href="#engine-power" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">series</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Power&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">series</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0        40225
75       24023
60       15897
150      14590
101      13298
         ...  
323          1
3454         1
1056         1
13636        1
1158         1
Name: Power, Length: 712, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">series</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([    0,     1,     2,     3,     4,     5,     6,     7,     8,
           9,    10,    11,    12,    13,    14,    15,    16,    17,
          18,    19,    20,    21,    22,    23,    24,    25,    26,
          27,    28,    29,    30,    31,    32,    33,    34,    35,
          36,    37,    38,    39,    40,    41,    42,    43,    44,
          45,    46,    47,    48,    49,    50,    51,    52,    53,
          54,    55,    56,    57,    58,    59,    60,    61,    62,
          63,    64,    65,    66,    67,    68,    69,    70,    71,
          72,    73,    74,    75,    76,    77,    78,    79,    80,
          81,    82,    83,    84,    85,    86,    87,    88,    89,
          90,    91,    92,    93,    94,    95,    96,    97,    98,
          99,   100,   101,   102,   103,   104,   105,   106,   107,
         108,   109,   110,   111,   112,   113,   114,   115,   116,
         117,   118,   119,   120,   121,   122,   123,   124,   125,
         126,   127,   128,   129,   130,   131,   132,   133,   134,
         135,   136,   137,   138,   139,   140,   141,   142,   143,
         144,   145,   146,   147,   148,   149,   150,   151,   152,
         153,   154,   155,   156,   157,   158,   159,   160,   161,
         162,   163,   164,   165,   166,   167,   168,   169,   170,
         171,   172,   173,   174,   175,   176,   177,   178,   179,
         180,   181,   182,   183,   184,   185,   186,   187,   188,
         189,   190,   191,   192,   193,   194,   195,   196,   197,
         198,   199,   200,   201,   202,   203,   204,   205,   206,
         207,   208,   209,   210,   211,   212,   213,   214,   215,
         216,   217,   218,   219,   220,   221,   222,   223,   224,
         225,   226,   227,   228,   229,   230,   231,   232,   233,
         234,   235,   236,   237,   238,   239,   240,   241,   242,
         243,   244,   245,   246,   247,   248,   249,   250,   251,
         252,   253,   254,   255,   256,   257,   258,   259,   260,
         261,   262,   264,   265,   266,   267,   268,   269,   270,
         271,   272,   273,   274,   275,   276,   277,   278,   279,
         280,   281,   282,   283,   284,   285,   286,   287,   288,
         289,   290,   292,   293,   294,   295,   296,   297,   298,
         299,   300,   301,   303,   304,   305,   306,   307,   308,
         309,   310,   311,   313,   314,   315,   316,   317,   318,
         320,   321,   322,   323,   324,   325,   326,   327,   328,
         329,   330,   331,   332,   333,   334,   335,   336,   337,
         338,   339,   340,   341,   343,   344,   345,   346,   347,
         348,   349,   350,   351,   352,   353,   354,   355,   356,
         357,   358,   360,   361,   362,   363,   364,   365,   367,
         368,   370,   371,   374,   375,   376,   377,   379,   380,
         381,   382,   385,   386,   387,   388,   390,   392,   394,
         396,   398,   399,   400,   401,   402,   405,   408,   409,
         411,   416,   420,   421,   425,   426,   428,   430,   431,
         435,   440,   442,   445,   449,   450,   454,   457,   459,
         460,   475,   476,   485,   487,   489,   490,   500,   504,
         505,   507,   508,   510,   514,   515,   517,   519,   520,
         521,   525,   530,   540,   541,   544,   550,   551,   553,
         560,   572,   574,   579,   580,   584,   585,   599,   600,
         601,   602,   603,   604,   606,   607,   610,   612,   620,
         640,   645,   650,   651,   671,   678,   682,   685,   696,
         700,   702,   703,   732,   743,   750,   751,   754,   771,
         776,   800,   805,   808,   850,   851,   871,   900,   901,
         902,   903,   907,   909,   923,   950,   952,   953,   960,
         998,   999,  1000,  1001,  1002,  1003,  1004,  1005,  1011,
        1012,  1016,  1017,  1021,  1024,  1054,  1055,  1056,  1062,
        1079,  1082,  1090,  1100,  1102,  1103,  1105,  1111,  1115,
        1120,  1149,  1151,  1158,  1160,  1162,  1164,  1199,  1200,
        1202,  1221,  1223,  1230,  1239,  1240,  1241,  1250,  1252,
        1256,  1275,  1288,  1299,  1300,  1312,  1317,  1324,  1339,
        1351,  1360,  1362,  1363,  1367,  1390,  1394,  1398,  1399,
        1400,  1401,  1403,  1405,  1416,  1432,  1433,  1436,  1500,
        1501,  1502,  1503,  1506,  1521,  1548,  1595,  1596,  1597,
        1598,  1600,  1625,  1631,  1653,  1659,  1689,  1700,  1701,
        1703,  1704,  1707,  1753,  1771,  1779,  1780,  1781,  1783,
        1793,  1796,  1799,  1800,  1801,  1870,  1895,  1896,  1900,
        1910,  1920,  1922,  1933,  1937,  1968,  1986,  1988,  1992,
        1993,  1995,  1998,  1999,  2000,  2004,  2005,  2007,  2009,
        2016,  2017,  2018,  2172,  2200,  2201,  2331,  2340,  2389,
        2402,  2461,  2598,  2729,  2789,  2792,  2799,  3000,  3199,
        3454,  3500,  3750,  4400,  4507,  4700,  5000,  5411,  5420,
        5575,  5809,  5815,  5867,  6006,  6010,  6011,  6012,  6018,
        6045,  6062,  6226,  6512,  6920,  7508,  7511,  7512,  7515,
        7518,  7529,  7544,  8011,  8259,  8404,  8500,  9000,  9007,
        9010,  9011,  9012,  9013,  9710, 10000, 10110, 10218, 10311,
       10317, 10520, 10522, 10710, 10910, 10912, 11011, 11025, 11111,
       11509, 11530, 11635, 12012, 12510, 12512, 12684, 13616, 13636,
       14009, 15001, 15016, 15017, 15020, 15033, 16011, 16051, 16311,
       16312, 17011, 17019, 17410, 17700, 17932, 19208, 19211, 19312,
       20000])
</pre></div>
</div>
</div>
</div>
<p>Nothing is clear, but the zeros are to be replaced with something.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hist_from_series</span><span class="p">(</span><span class="n">series</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">series</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">series</span><span class="p">)</span> <span class="o">&amp;</span> 
                            <span class="p">(</span><span class="n">series</span> <span class="o">&lt;</span> <span class="n">series</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.999</span><span class="p">))])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b8fd3bc1ba95b68f3839f89bb864b362eff8e302e056fa9db3f9c9fc5f4fb7a8.png" src="_images/b8fd3bc1ba95b68f3839f89bb864b362eff8e302e056fa9db3f9c9fc5f4fb7a8.png" />
</div>
</div>
<p>I think everything above 400 hp would have to be rounded up to the hundreds.</p>
</section>
<section id="mileage">
<h4>Mileage<a class="headerlink" href="#mileage" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">series</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Kilometer&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">series</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>150000    238209
125000     36454
100000     14882
90000      11567
80000      10047
70000       8593
60000       7444
5000        6397
50000       6232
40000       4911
30000       4436
20000       3975
10000       1222
Name: Kilometer, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hist_from_series</span><span class="p">(</span><span class="n">series</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/fdc2aec8096c830eded9ed7912781037de95c9ac9b57f7ab450f877981160deb.png" src="_images/fdc2aec8096c830eded9ed7912781037de95c9ac9b57f7ab450f877981160deb.png" />
</div>
</div>
<p>The numbers look drawn. I will have to check their correlation with the price before training the model on them.</p>
</section>
<section id="number-of-photos">
<h4>Number of photos<a class="headerlink" href="#number-of-photos" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">series</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;NumberOfPictures&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">series</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    354369
Name: NumberOfPictures, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>That column should be thrown away altogether. Or we shall get some real data elsewhere.</p>
</section>
</section>
<section id="price-dynamics">
<h3>Price dynamics<a class="headerlink" href="#price-dynamics" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">downloaded</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;DateCrawled&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
<span class="n">created</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;DateCreated&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
<span class="n">visited</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;LastSeen&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">downloaded</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0        2016-03-24
1        2016-03-24
2        2016-03-15
3        2016-03-18
4        2016-04-01
            ...    
354364   2016-03-21
354365   2016-03-15
354366   2016-03-06
354367   2016-03-20
354368   2016-03-21
Name: DateCrawled, Length: 354369, dtype: datetime64[ns]
</pre></div>
</div>
</div>
</div>
<p>Looks like about a month is covered.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sb</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">downloaded</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Price&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/5ecd7ae7dd05090e1fa6ff9487fca33d85f8f0a9404139fe7b4a9517b746a199.png" src="_images/5ecd7ae7dd05090e1fa6ff9487fca33d85f8f0a9404139fe7b4a9517b746a199.png" />
</div>
</div>
<p>It’s not clear to me how the day the questionnaire is downloaded can affect the price, but judging by the graph, there is some dependence.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sb</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">created</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Price&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/235eaa072504eb6970a590a1051eab386df3a03da542791bd785c0563425c5de.png" src="_images/235eaa072504eb6970a590a1051eab386df3a03da542791bd785c0563425c5de.png" />
</div>
</div>
<p>The fluctuations are most likely due to the number of offers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">created</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/de671956f837afadccf09432614ee43dcca6a2bb4c8724c80a211bf1de61d04a.png" src="_images/de671956f837afadccf09432614ee43dcca6a2bb4c8724c80a211bf1de61d04a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">created</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">created</span> <span class="o">&gt;</span> <span class="s1">&#39;2016-03-01&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">hist</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/343651b7ec129ef3139ebd47104068aa026587c5a2c56b1aa97b4f55da5d7cf6.png" src="_images/343651b7ec129ef3139ebd47104068aa026587c5a2c56b1aa97b4f55da5d7cf6.png" />
</div>
</div>
<p>In principle, the period up to March 2016 can be omitted. It does not reflect the market anyway.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sb</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">created</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">created</span> <span class="o">&gt;</span> <span class="s1">&#39;2016-03-01&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Price&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/821813e3e6762800b3a5f9df1bfd0cd2eea13635a483b44dc9b73b1d26e64719.png" src="_images/821813e3e6762800b3a5f9df1bfd0cd2eea13635a483b44dc9b73b1d26e64719.png" />
</div>
</div>
<p>I am not sure whether there is a linkage here.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sb</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">visited</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Price&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d053edbfdbb157db0e9f59af873b38dbd6ef4d2627c89a4486d05d28cccba408.png" src="_images/d053edbfdbb157db0e9f59af873b38dbd6ef4d2627c89a4486d05d28cccba408.png" />
</div>
</div>
<p>However, the day of the visit seems to have influence.</p>
</section>
<section id="duplicates">
<h3>Duplicates<a class="headerlink" href="#duplicates" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>DateCrawled</th>
      <th>Price</th>
      <th>VehicleType</th>
      <th>RegistrationYear</th>
      <th>Gearbox</th>
      <th>Power</th>
      <th>Model</th>
      <th>Kilometer</th>
      <th>RegistrationMonth</th>
      <th>FuelType</th>
      <th>Brand</th>
      <th>Repaired</th>
      <th>DateCreated</th>
      <th>NumberOfPictures</th>
      <th>PostalCode</th>
      <th>LastSeen</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>171088</th>
      <td>2016-03-08 18:42:48</td>
      <td>1799</td>
      <td>coupe</td>
      <td>1999</td>
      <td>auto</td>
      <td>193</td>
      <td>clk</td>
      <td>20000</td>
      <td>7</td>
      <td>petrol</td>
      <td>mercedes_benz</td>
      <td>no</td>
      <td>2016-03-08 00:00:00</td>
      <td>0</td>
      <td>89518</td>
      <td>2016-03-09 09:46:57</td>
    </tr>
    <tr>
      <th>231258</th>
      <td>2016-03-28 00:56:10</td>
      <td>1000</td>
      <td>small</td>
      <td>2002</td>
      <td>manual</td>
      <td>83</td>
      <td>other</td>
      <td>150000</td>
      <td>1</td>
      <td>petrol</td>
      <td>suzuki</td>
      <td>no</td>
      <td>2016-03-28 00:00:00</td>
      <td>0</td>
      <td>66589</td>
      <td>2016-03-28 08:46:21</td>
    </tr>
    <tr>
      <th>258109</th>
      <td>2016-04-03 09:01:15</td>
      <td>4699</td>
      <td>coupe</td>
      <td>2003</td>
      <td>auto</td>
      <td>218</td>
      <td>clk</td>
      <td>125000</td>
      <td>6</td>
      <td>petrol</td>
      <td>mercedes_benz</td>
      <td>yes</td>
      <td>2016-04-03 00:00:00</td>
      <td>0</td>
      <td>75196</td>
      <td>2016-04-07 09:44:54</td>
    </tr>
    <tr>
      <th>325651</th>
      <td>2016-03-18 18:46:15</td>
      <td>1999</td>
      <td>wagon</td>
      <td>2001</td>
      <td>manual</td>
      <td>131</td>
      <td>passat</td>
      <td>150000</td>
      <td>7</td>
      <td>gasoline</td>
      <td>volkswagen</td>
      <td>no</td>
      <td>2016-03-18 00:00:00</td>
      <td>0</td>
      <td>36391</td>
      <td>2016-03-18 18:46:15</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Nothing abnormal. Throw it away and forget it.</p>
</section>
</section>
<section id="data-preprocessing">
<h2>Data preprocessing.<a class="headerlink" href="#data-preprocessing" title="Link to this heading">#</a></h2>
<p>Let’s do it in order:</p>
<ol class="arabic simple">
<li><p>Renaming of the columns</p></li>
<li><p>Removing duplicates</p></li>
<li><p>Data type conversion</p></li>
<li><p>Work with missing values</p></li>
<li><p>Work with anomalous values</p></li>
</ol>
<section id="renaming">
<h3>Renaming<a class="headerlink" href="#renaming" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>
    <span class="s1">&#39;DateCrawled&#39;</span><span class="p">:</span> <span class="s1">&#39;downloaded&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;Price&#39;</span><span class="p">:</span> <span class="s1">&#39;price&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;VehicleType&#39;</span><span class="p">:</span> <span class="s1">&#39;vehicle_type&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;RegistrationYear&#39;</span><span class="p">:</span> <span class="s1">&#39;year&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;Gearbox&#39;</span><span class="p">:</span> <span class="s1">&#39;gearbox&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;Power&#39;</span><span class="p">:</span> <span class="s1">&#39;power&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;Model&#39;</span><span class="p">:</span> <span class="s1">&#39;model&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;Kilometer&#39;</span><span class="p">:</span> <span class="s1">&#39;km&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;RegistrationMonth&#39;</span><span class="p">:</span> <span class="s1">&#39;month&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;FuelType&#39;</span><span class="p">:</span> <span class="s1">&#39;fuel_type&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;Brand&#39;</span><span class="p">:</span> <span class="s1">&#39;brand&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;Repaired&#39;</span><span class="p">:</span> <span class="s1">&#39;repaired&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;DateCreated&#39;</span><span class="p">:</span> <span class="s1">&#39;created&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;NumberOfPictures&#39;</span><span class="p">:</span> <span class="s1">&#39;pictures&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;PostalCode&#39;</span><span class="p">:</span> <span class="s1">&#39;postal_code&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;LastSeen&#39;</span><span class="p">:</span> <span class="s1">&#39;visited&#39;</span>
<span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 354369 entries, 0 to 354368
Data columns (total 16 columns):
 #   Column        Non-Null Count   Dtype 
---  ------        --------------   ----- 
 0   downloaded    354369 non-null  object
 1   price         354369 non-null  int64 
 2   vehicle_type  316879 non-null  object
 3   year          354369 non-null  int64 
 4   gearbox       334536 non-null  object
 5   power         354369 non-null  int64 
 6   model         334664 non-null  object
 7   km            354369 non-null  int64 
 8   month         354369 non-null  int64 
 9   fuel_type     321474 non-null  object
 10  brand         354369 non-null  object
 11  repaired      283215 non-null  object
 12  created       354369 non-null  object
 13  pictures      354369 non-null  int64 
 14  postal_code   354369 non-null  int64 
 15  visited       354369 non-null  object
dtypes: int64(7), object(9)
memory usage: 43.3+ MB
</pre></div>
</div>
</div>
</div>
</section>
<section id="deduplication">
<h3>Deduplication<a class="headerlink" href="#deduplication" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>No more clear duplicates.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>354365
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;downloaded&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>83191
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
</pre></div>
</div>
</div>
</div>
<p>There are repeats among the dates, but there are differences for them in other columns, so they are not duplicates.</p>
</section>
<section id="data-types">
<h3>Data types<a class="headerlink" href="#data-types" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;downloaded&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;downloaded&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;created&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;created&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;visited&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;visited&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_25589/3470029938.py:1: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  data[&#39;downloaded&#39;] = pd.to_datetime(data[&#39;downloaded&#39;], format=&#39;%Y-%m-%d %H:%M:%S&#39;)
/tmp/ipykernel_25589/3470029938.py:2: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  data[&#39;created&#39;] = pd.to_datetime(data[&#39;created&#39;], format=&#39;%Y-%m-%d %H:%M:%S&#39;)
/tmp/ipykernel_25589/3470029938.py:3: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  data[&#39;visited&#39;] = pd.to_datetime(data[&#39;visited&#39;], format=&#39;%Y-%m-%d %H:%M:%S&#39;)
</pre></div>
</div>
</div>
</div>
<p>There is also an issue of the postal code. We can’t use it as a quantitative variable, as the dependency is clearly non-linear. It would be nice to turn it into districts, but <code class="docutils literal notranslate"><span class="pre">pgeocode</span></code> offers several possibilities and runs very long.</p>
</section>
<section id="missing-values">
<h3>Missing values<a class="headerlink" href="#missing-values" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>downloaded          0
price               0
vehicle_type    37490
year                0
gearbox         19833
power               0
model           19705
km                  0
month               0
fuel_type       32895
brand               0
repaired        71154
created             0
pictures            0
postal_code         0
visited             0
dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Let’s see how often the missing values match across rows.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">with_na</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;vehicle_type&#39;</span><span class="p">,</span> <span class="s1">&#39;gearbox&#39;</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="s1">&#39;fuel_type&#39;</span><span class="p">,</span> <span class="s1">&#39;repaired&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">with_na</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>vehicle_type</th>
      <th>gearbox</th>
      <th>model</th>
      <th>fuel_type</th>
      <th>repaired</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2</th>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>354364</th>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>354365</th>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
    </tr>
    <tr>
      <th>354366</th>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>354367</th>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>354368</th>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
<p>354365 rows × 5 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">with_na</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    245810
1     64318
2     26209
3     10008
4      5783
5      2237
dtype: int64
</pre></div>
</div>
</div>
</div>
<p>All 5 data types play a significant role in determining the price. I think we can throw out rows where there are missing values in more than 2 columns. That’s about 5% of the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)]</span>
<span class="n">data</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>downloaded          0
price               0
vehicle_type    22122
year                0
gearbox          8954
power               0
model           12016
km                  0
month               0
fuel_type       18540
brand               0
repaired        55104
created             0
pictures            0
postal_code         0
visited             0
dtype: int64
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>For unknown body type — replace with other</p></li>
<li><p>For unknown type of gearbox — create class unknown</p></li>
<li><p>For unknown model — replace with other (at least the brand will be known)</p></li>
<li><p>For unknown fuel type — replace with other</p></li>
<li><p>For unknown breakdown history — replace with unknown (it is not clear whether we can trust and rely on this data).</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;vehicle_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;vehicle_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;other&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;gearbox&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;gearbox&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;unknown&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;other&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;fuel_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;fuel_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;other&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;repaired&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;repaired&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;unknown&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>downloaded      0
price           0
vehicle_type    0
year            0
gearbox         0
power           0
model           0
km              0
month           0
fuel_type       0
brand           0
repaired        0
created         0
pictures        0
postal_code     0
visited         0
dtype: int64
</pre></div>
</div>
</div>
</div>
</section>
<section id="anomalies">
<h3>Anomalies<a class="headerlink" href="#anomalies" title="Link to this heading">#</a></h3>
<p>So far, I’ve noticed the following outliers:</p>
<ul class="simple">
<li><p>About 11,000 lines with zero price. This is hardly an anomaly because the seller may have planned to bargain with the buyer. Nevertheless, these columns won’t help us, they should be thrown out.</p></li>
<li><p>13 months of the year. Most likely, all the unknown information was assigned to month zero. It’s a pity to throw out almost 40 000 rows. There is nothing to replace them with either. I think we can leave it that way and train the model on 13 months.</p></li>
<li><p>The prevailing number of never repaired machines (with 20% of missing values, by the way). There is no way to fix this, so it would be the best not to take this column for training at all.</p></li>
<li><p>Vehicle registration year before the 20th century and after 2019. The cutoff will be chosen at random.</p></li>
<li><p>Zero and overestimated engine horsepower.</p></li>
<li><p>Improbable mileage numbers. The lion’s share of cars have 150,000 kilometers. This may have been one of the options offered to the seller, so it may be a categorical variable.</p></li>
<li><p>Zero photos for all items. This column should just be thrown out, it gives no information.</p></li>
<li><p>Data prior to March 5, 2016 is hardly an anomaly, but is out of trend. They should not be considered either. <a id='price'></a></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([1000, 1400, 1600, 1602, 1910, 1923, 1927, 1928, 1929, 1930, 1931,
       1932, 1933, 1934, 1935, 1936, 1937, 1938, 1940, 1941, 1942, 1943,
       1944, 1945, 1946, 1947, 1948, 1949, 1950, 1951, 1952, 1953, 1954,
       1955, 1956, 1957, 1958, 1959, 1960, 1961, 1962, 1963, 1964, 1965,
       1966, 1967, 1968, 1969, 1970, 1971, 1972, 1973, 1974, 1975, 1976,
       1977, 1978, 1979, 1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987,
       1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998,
       1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009,
       2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2900,
       3700, 4000, 5000, 6000, 6500])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">sort_index</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([    1,     1,     1,     1,    16,     2,     1,     1,     7,
           2,     1,     3,     2,     3,     3,     3,     8,     7,
           2,     2,     2,     4,     1,     4,     1,     1,     2,
           1,    17,    10,     8,    12,     8,    12,    22,    11,
          20,    29,    57,    36,    37,    48,    56,    74,   102,
          91,   102,   114,   156,   154,   202,   160,   163,   135,
         151,   162,   265,   259,   287,   239,   295,   395,   375,
         518,   486,   616,   882,  1210,  1983,  2554,  2806,  3220,
        4537,  7933, 10226, 13794, 16951, 21742, 20501, 19482, 18593,
       19387, 19225, 20278, 19460, 16843, 15119, 14271, 10584,  9763,
        7073,  4051,  2472,  1091,  6313,  7189,  2780,    14,     1,
           1,     1,     5,     3,     1])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="mi">1950</span> <span class="o">&lt;=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">2016</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;power&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0        25996
1           20
2            8
3            8
4           26
         ...  
17932        1
19208        1
19211        1
19312        1
20000        1
Name: power, Length: 678, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Let’s replace the zeros with the median.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">median</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;power&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
<span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;power&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;power&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">median</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;power&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([    1,     2,     3,     4,     5,     6,     7,     8,     9,
          10,    11,    12,    13,    14,    15,    16,    17,    18,
          19,    20,    21,    22,    23,    24,    25,    26,    27,
          28,    29,    30,    31,    32,    33,    34,    35,    36,
          37,    38,    39,    40,    41,    42,    43,    44,    45,
          46,    47,    48,    49,    50,    51,    52,    53,    54,
          55,    56,    57,    58,    59,    60,    61,    62,    63,
          64,    65,    66,    67,    68,    69,    70,    71,    72,
          73,    74,    75,    76,    77,    78,    79,    80,    81,
          82,    83,    84,    85,    86,    87,    88,    89,    90,
          91,    92,    93,    94,    95,    96,    97,    98,    99,
         100,   101,   102,   103,   104,   105,   106,   107,   108,
         109,   110,   111,   112,   113,   114,   115,   116,   117,
         118,   119,   120,   121,   122,   123,   124,   125,   126,
         127,   128,   129,   130,   131,   132,   133,   134,   135,
         136,   137,   138,   139,   140,   141,   142,   143,   144,
         145,   146,   147,   148,   149,   150,   151,   152,   153,
         154,   155,   156,   157,   158,   159,   160,   161,   162,
         163,   164,   165,   166,   167,   168,   169,   170,   171,
         172,   173,   174,   175,   176,   177,   178,   179,   180,
         181,   182,   183,   184,   185,   186,   187,   188,   189,
         190,   191,   192,   193,   194,   195,   196,   197,   198,
         199,   200,   201,   202,   203,   204,   205,   206,   207,
         208,   209,   210,   211,   212,   213,   214,   215,   216,
         217,   218,   219,   220,   221,   222,   223,   224,   225,
         226,   227,   228,   229,   230,   231,   232,   233,   234,
         235,   236,   237,   238,   239,   240,   241,   242,   243,
         244,   245,   246,   247,   248,   249,   250,   251,   252,
         253,   254,   255,   256,   257,   258,   259,   260,   261,
         262,   264,   265,   266,   267,   268,   269,   270,   271,
         272,   273,   274,   275,   276,   277,   278,   279,   280,
         281,   282,   283,   284,   285,   286,   287,   288,   289,
         290,   292,   293,   294,   295,   296,   297,   298,   299,
         300,   301,   303,   304,   305,   306,   307,   308,   309,
         310,   311,   313,   314,   315,   316,   317,   318,   320,
         321,   322,   323,   324,   325,   326,   328,   329,   330,
         331,   332,   333,   334,   335,   336,   337,   338,   339,
         340,   341,   343,   344,   345,   346,   347,   348,   349,
         350,   351,   352,   353,   354,   355,   356,   357,   358,
         360,   361,   362,   363,   364,   365,   367,   368,   370,
         371,   374,   375,   376,   377,   379,   380,   381,   382,
         385,   386,   387,   388,   390,   392,   394,   396,   398,
         399,   400,   401,   405,   408,   409,   411,   416,   420,
         421,   425,   426,   428,   430,   431,   435,   440,   442,
         445,   449,   450,   454,   457,   459,   460,   475,   476,
         487,   489,   490,   500,   504,   505,   507,   508,   510,
         514,   515,   517,   519,   520,   521,   525,   540,   541,
         544,   550,   551,   553,   560,   572,   579,   580,   584,
         585,   600,   601,   602,   603,   604,   606,   612,   620,
         640,   645,   650,   651,   671,   678,   682,   685,   696,
         700,   702,   703,   732,   743,   750,   751,   754,   771,
         776,   800,   805,   850,   851,   871,   900,   902,   903,
         907,   909,   923,   950,   952,   953,   998,   999,  1000,
        1001,  1002,  1003,  1004,  1005,  1011,  1012,  1016,  1017,
        1021,  1024,  1054,  1055,  1056,  1062,  1079,  1082,  1090,
        1100,  1105,  1115,  1120,  1149,  1151,  1158,  1160,  1162,
        1164,  1199,  1200,  1202,  1221,  1223,  1230,  1239,  1240,
        1241,  1250,  1275,  1288,  1299,  1300,  1312,  1317,  1324,
        1339,  1360,  1362,  1363,  1367,  1390,  1398,  1399,  1400,
        1401,  1403,  1405,  1416,  1432,  1433,  1436,  1500,  1501,
        1502,  1503,  1506,  1521,  1548,  1595,  1596,  1597,  1598,
        1600,  1625,  1631,  1653,  1659,  1689,  1700,  1701,  1703,
        1704,  1707,  1753,  1771,  1779,  1780,  1781,  1783,  1793,
        1796,  1799,  1800,  1801,  1870,  1895,  1896,  1900,  1920,
        1922,  1933,  1968,  1988,  1992,  1993,  1995,  1998,  1999,
        2000,  2004,  2005,  2007,  2009,  2016,  2017,  2018,  2172,
        2201,  2331,  2340,  2389,  2402,  2461,  2598,  2729,  2789,
        2792,  2799,  3199,  3454,  3500,  3750,  4400,  4507,  4700,
        5411,  5420,  5575,  5809,  5815,  5867,  6006,  6010,  6011,
        6012,  6018,  6045,  6062,  6226,  6512,  6920,  7508,  7511,
        7512,  7515,  7518,  7529,  7544,  8259,  8404,  8500,  9007,
        9012,  9013, 10110, 10218, 10311, 10520, 10522, 10710, 10910,
       10912, 11011, 11025, 11111, 11509, 11530, 11635, 12012, 12510,
       12512, 12684, 13636, 14009, 15001, 15017, 15020, 15033, 16051,
       16311, 16312, 17011, 17019, 17410, 17700, 17932, 19208, 19211,
       19312, 20000])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;power&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">sort_index</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([   20,     8,     8,    26,    93,    10,    10,     5,     4,
          10,    26,    12,     6,    18,    13,     6,     7,    47,
          10,    19,     5,     4,    37,    25,    14,   236,    37,
           5,    33,    28,     8,     3,    47,   167,    10,     6,
          43,    15,   125,   284,   419,    45,   104,   354,  2645,
          52,    29,    80,    22,  4187,    80,   288,   183,  5340,
        1804,   249,   125,  3586,   211, 14383,   957,    88,   386,
        1428,  2016,   169,   423,  2665,  3526,   915,  1379,   447,
         732,   341, 21644,   231,   846,   183,   132,  3816,   116,
        2180,   354,   911,   503,  2596,   757,  1382,    92, 11479,
         113,   427,    25,   379,  2834,   118,   506,   945,   584,
        1289, 12197,  6032,   886,   125, 35776,   387,  1238,   145,
        4564,  4396,   520,   177,   878,   852,  2829, 11273,   202,
        1153,    43,  3647,   352,  4924,    30,   206,  6405,   508,
          26,   385,  1406,   785,  4888,   430,   592,    54,   811,
        6350,    74,    46,   266, 12233,   693,    72,  5126,   651,
         977,   126,  1114,    77,    57, 13555,   210,   103,     6,
          62,   923,   791,    22,   196,    14,  2285,    30,    41,
        5849,    49,   846,   228,    98,    29,   108,  9594,   105,
          29,   194,  1191,   335,    48,  3272,    89,  2078,   624,
          25,    95,    21,  1575,   567,    47,    11,    84,    38,
        1309,    20,  1460,  2432,   144,    34,    69,  1093,    35,
          42,  1905,    88,     6,   111,  1664,   172,    10,   193,
          40,   166,    71,   901,    44,    37,    11,    61,    16,
          13,  2165,    12,   626,     5,    25,    46,  1957,   117,
         167,    11,    37,     3,   332,  1907,   691,    57,    40,
         617,     9,    25,    97,   607,    93,   267,    10,    22,
           4,   357,     7,    17,     1,    34,   726,     2,    67,
          13,    24,     9,   152,     4,   174,     5,   225,     4,
           8,    37,   425,     8,     2,    11,    12,    35,    38,
         726,    20,     9,    89,    18,     9,    12,   194,   231,
           8,     1,     7,    31,    14,   556,     9,     5,     6,
          56,    59,     2,     3,     4,     4,     1,    19,   178,
         194,     9,    11,     5,    72,   650,     4,     3,    12,
          77,    11,   102,    14,    19,     2,     1,     6,   108,
          14,    11,     1,     5,    25,   139,     6,    24,    44,
           1,     1,   166,    82,     9,     2,     1,     4,     1,
         205,     4,    46,   103,    34,     3,    30,     2,    64,
          28,     1,     3,     1,    66,    12,     1,     1,     2,
          41,     1,     3,    15,     5,     4,    75,     3,     7,
           2,     3,     4,     2,     1,     5,     7,     6,     2,
          15,     5,    54,     6,    10,     1,    15,     7,     1,
           4,    47,     4,     5,    10,     1,     2,     1,    22,
           1,     1,     2,     1,     3,     4,    34,     3,     1,
          11,     1,    81,     1,     2,     1,     1,     1,    31,
           2,     1,     1,    30,     2,     1,     9,     1,     4,
           4,     3,     2,     1,     2,     5,     1,     1,     1,
           1,     2,     2,     1,     1,     1,     3,     1,     1,
           2,     9,     3,     1,     5,     1,     1,     1,     2,
           1,     1,     2,     1,     1,     1,     1,     1,     1,
           1,     1,     1,     1,     1,     3,     1,     1,     1,
           1,     1,     1,     1,     1,     1,     2,     1,     1,
           1,     2,     1,     2,     1,     1,     1,     2,     3,
           6,     1,     2,     1,     1,     3,     1,     2,     1,
           2,     1,     1,     1,     1,     1,     1,     1,     1,
           1,     1,     1,     1,     1,     1,     1,     1,     1,
           1,     1,     1,     1,     1,     1,     1,     1,     1,
           1,     1,     1,     1,     1,     2,     1,     1,     1,
           1,     1,     1,     2,     1,     2,     1,     2,     5,
           2,     2,     1,     1,     1,     1,     1,     4,     1,
           1,     2,     1,     1,     1,     2,     1,     1,     7,
           3,     1,     1,     1,     1,     1,     1,     1,     1,
           1,     1,     2,     1,     2,     1,     2,     1,     1,
           1,     1,     6,     1,     1,     1,     1,     2,     1,
           1,     1,     1,     1,     1,     1,     1,     2,     1,
           2,     1,     1,     1,     1,     2,     1,     2,     1,
           1,     1,     1,     1,     1,     1,     1,     1,     1,
           1,     1,     1,     1,     1,     1,     1,     1,     2,
           1,     1,     1,     1,     1,     1,     1,     1,     1,
           1,     1,     1,     1,     1,     1,     1,     1,     2,
           1,     1,     1,     1,     1,     1,     1,     1,     1,
           1,     1,     1,     1,     1,     1,     2,     1,     1,
           1,     1,     1,     1,     1,     1,     1,     1,     2,
           2,     1,     1,     1,     1,     1,     1,     1,     1,
           1,     1,     1,     1,     1,     1,     1,     1,     1,
           1,     1])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;power&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;power&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2645</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>45.0
</pre></div>
</div>
</div>
</div>
<p>I’ll take this power as the minimum possible.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">45</span> <span class="o">&lt;=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;power&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;power&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">4500</span><span class="p">,</span> <span class="s1">&#39;power&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;power&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">4500</span><span class="p">,</span> <span class="s1">&#39;power&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">10</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;power&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">450</span><span class="p">,</span> <span class="s1">&#39;power&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;power&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">450</span><span class="p">,</span> <span class="s1">&#39;power&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">10</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;power&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;power&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;power&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>45     2731
46       53
47       63
48       83
49       23
       ... 
435      34
440       4
442       1
445      11
449       1
Name: power, Length: 355, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;power&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/2e351e135dd1ae33f9e171c1a17b0121cb98a949693d1970ba43623f72ac41b1.png" src="_images/2e351e135dd1ae33f9e171c1a17b0121cb98a949693d1970ba43623f72ac41b1.png" />
</div>
</div>
<p>That’s more likely to be true.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">barplot_from_counts</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;km&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/8e08a323e2ee4a4b9a00d471e4535c694e7b459ef27e99a044e121c37d7ee7b1.png" src="_images/8e08a323e2ee4a4b9a00d471e4535c694e7b459ef27e99a044e121c37d7ee7b1.png" />
</div>
</div>
<p>I’ll transform it into a categorical one later.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;pictures&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Uninformative feature removed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;created&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="s1">&#39;2016-03-05&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>downloaded</th>
      <th>price</th>
      <th>vehicle_type</th>
      <th>year</th>
      <th>gearbox</th>
      <th>power</th>
      <th>model</th>
      <th>km</th>
      <th>month</th>
      <th>fuel_type</th>
      <th>brand</th>
      <th>repaired</th>
      <th>created</th>
      <th>postal_code</th>
      <th>visited</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>67</th>
      <td>2016-03-21 12:47:55</td>
      <td>2100</td>
      <td>suv</td>
      <td>2000</td>
      <td>manual</td>
      <td>105</td>
      <td>other</td>
      <td>150000</td>
      <td>8</td>
      <td>petrol</td>
      <td>honda</td>
      <td>no</td>
      <td>2016-02-09</td>
      <td>85244</td>
      <td>2016-03-31 16:46:09</td>
    </tr>
    <tr>
      <th>352</th>
      <td>2016-03-05 14:14:19</td>
      <td>3900</td>
      <td>coupe</td>
      <td>2004</td>
      <td>manual</td>
      <td>192</td>
      <td>rx_reihe</td>
      <td>125000</td>
      <td>7</td>
      <td>petrol</td>
      <td>mazda</td>
      <td>no</td>
      <td>2016-03-03</td>
      <td>57520</td>
      <td>2016-03-29 05:18:01</td>
    </tr>
    <tr>
      <th>581</th>
      <td>2016-03-14 17:50:40</td>
      <td>1990</td>
      <td>bus</td>
      <td>2003</td>
      <td>manual</td>
      <td>90</td>
      <td>other</td>
      <td>150000</td>
      <td>10</td>
      <td>gasoline</td>
      <td>ford</td>
      <td>no</td>
      <td>2016-03-01</td>
      <td>82467</td>
      <td>2016-03-21 10:45:42</td>
    </tr>
    <tr>
      <th>768</th>
      <td>2016-03-05 14:25:04</td>
      <td>1300</td>
      <td>wagon</td>
      <td>2001</td>
      <td>manual</td>
      <td>75</td>
      <td>golf</td>
      <td>125000</td>
      <td>4</td>
      <td>petrol</td>
      <td>volkswagen</td>
      <td>no</td>
      <td>2016-03-04</td>
      <td>65929</td>
      <td>2016-03-06 11:11:24</td>
    </tr>
    <tr>
      <th>856</th>
      <td>2016-03-06 20:48:17</td>
      <td>11200</td>
      <td>small</td>
      <td>2014</td>
      <td>manual</td>
      <td>105</td>
      <td>other</td>
      <td>30000</td>
      <td>0</td>
      <td>petrol</td>
      <td>skoda</td>
      <td>no</td>
      <td>2016-03-01</td>
      <td>41844</td>
      <td>2016-04-07 02:45:38</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>353659</th>
      <td>2016-03-05 14:08:59</td>
      <td>1799</td>
      <td>bus</td>
      <td>2004</td>
      <td>manual</td>
      <td>75</td>
      <td>combo</td>
      <td>150000</td>
      <td>5</td>
      <td>gasoline</td>
      <td>opel</td>
      <td>no</td>
      <td>2016-03-04</td>
      <td>55481</td>
      <td>2016-04-05 10:46:51</td>
    </tr>
    <tr>
      <th>353856</th>
      <td>2016-03-05 14:10:01</td>
      <td>6300</td>
      <td>sedan</td>
      <td>2007</td>
      <td>auto</td>
      <td>116</td>
      <td>astra</td>
      <td>70000</td>
      <td>9</td>
      <td>petrol</td>
      <td>opel</td>
      <td>no</td>
      <td>2016-03-03</td>
      <td>63263</td>
      <td>2016-03-28 22:18:58</td>
    </tr>
    <tr>
      <th>354047</th>
      <td>2016-03-05 14:18:10</td>
      <td>1000</td>
      <td>sedan</td>
      <td>1993</td>
      <td>manual</td>
      <td>75</td>
      <td>golf</td>
      <td>150000</td>
      <td>2</td>
      <td>petrol</td>
      <td>volkswagen</td>
      <td>no</td>
      <td>2016-03-04</td>
      <td>35767</td>
      <td>2016-03-06 04:45:43</td>
    </tr>
    <tr>
      <th>354109</th>
      <td>2016-03-05 14:23:04</td>
      <td>17890</td>
      <td>wagon</td>
      <td>2011</td>
      <td>auto</td>
      <td>160</td>
      <td>insignia</td>
      <td>100000</td>
      <td>6</td>
      <td>gasoline</td>
      <td>opel</td>
      <td>no</td>
      <td>2016-03-04</td>
      <td>65321</td>
      <td>2016-04-06 10:44:35</td>
    </tr>
    <tr>
      <th>354179</th>
      <td>2016-03-05 14:17:32</td>
      <td>3200</td>
      <td>sedan</td>
      <td>2003</td>
      <td>manual</td>
      <td>102</td>
      <td>a_klasse</td>
      <td>150000</td>
      <td>4</td>
      <td>petrol</td>
      <td>mercedes_benz</td>
      <td>no</td>
      <td>2016-03-04</td>
      <td>35428</td>
      <td>2016-03-15 09:47:14</td>
    </tr>
  </tbody>
</table>
<p>1445 rows × 15 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;created&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="s1">&#39;2016-03-05&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1     756
2       7
3       4
5      15
7       2
9       5
10     38
11      1
12      2
13      3
15      3
17      1
20     11
24      1
25      6
26      1
29      1
30     17
35      6
38      1
Name: price, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">35</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="exploratory-data-analysis">
<h2>Exploratory data analysis<a class="headerlink" href="#exploratory-data-analysis" title="Link to this heading">#</a></h2>
<p>At this stage, we need to identify possible relationships between attributes, as well as select attributes for training. Since the target feature is price, we are looking first of all for the relationship with it.</p>
<p>Since some functions take a long time to work for 350,000 rows, let’s study a sample of 35,000 objects.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">57</span><span class="p">)</span>
<span class="n">sample</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 31350 entries, 262452 to 225675
Data columns (total 15 columns):
 #   Column        Non-Null Count  Dtype         
---  ------        --------------  -----         
 0   downloaded    31350 non-null  datetime64[ns]
 1   price         31350 non-null  int64         
 2   vehicle_type  31350 non-null  object        
 3   year          31350 non-null  int64         
 4   gearbox       31350 non-null  object        
 5   power         31350 non-null  int64         
 6   model         31350 non-null  object        
 7   km            31350 non-null  int64         
 8   month         31350 non-null  int64         
 9   fuel_type     31350 non-null  object        
 10  brand         31350 non-null  object        
 11  repaired      31350 non-null  object        
 12  created       31350 non-null  datetime64[ns]
 13  postal_code   31350 non-null  int64         
 14  visited       31350 non-null  datetime64[ns]
dtypes: datetime64[ns](3), int64(6), object(6)
memory usage: 3.8+ MB
</pre></div>
</div>
</div>
</div>
<section id="period">
<h3>Period<a class="headerlink" href="#period" title="Link to this heading">#</a></h3>
<p>Let’s look at the dates the proposals were created.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample</span><span class="p">[</span><span class="s1">&#39;created&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">hist</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/20094fec7493ad464de77f454cc00d054a9c52645ccc4538c41cebe6bbcb76a3.png" src="_images/20094fec7493ad464de77f454cc00d054a9c52645ccc4538c41cebe6bbcb76a3.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sb</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">sample</span><span class="p">[</span><span class="s1">&#39;created&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="n">sample</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;created&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/036a68e6f9912f33688f901086e3a8802244837774b9e97b751623e669c0b320.png" src="_images/036a68e6f9912f33688f901086e3a8802244837774b9e97b751623e669c0b320.png" />
</div>
</div>
<p>The price didn’t change too much during that time. I think this column can be dropped.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sb</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">sample</span><span class="p">[</span><span class="s1">&#39;downloaded&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="n">sample</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;downloaded&#39;</span><span class="p">)</span>
<span class="n">sb</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">sample</span><span class="p">[</span><span class="s1">&#39;visited&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="n">sample</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;visited&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/cfb810369f0d8da6a464819afe909b948ca6c8dbfd22b0e8335617606cbafe6f.png" src="_images/cfb810369f0d8da6a464819afe909b948ca6c8dbfd22b0e8335617606cbafe6f.png" />
</div>
</div>
<p>The time of download is unlikely to affect the price, but the date of last visit may well.</p>
<p>Let’s convert it to seconds on a small sample and use it as a quantitative variable.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">subsample</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">57</span><span class="p">)</span>
<span class="n">seconds</span> <span class="o">=</span> <span class="n">subsample</span><span class="p">[</span><span class="s1">&#39;visited&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> 
                                     <span class="nb">round</span><span class="p">((</span><span class="nb">max</span><span class="p">(</span><span class="n">subsample</span><span class="p">[</span><span class="s1">&#39;visited&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 9.26 s, sys: 5.46 ms, total: 9.27 s
Wall time: 9.25 s
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">seconds</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">subsample</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-0.12227655531259655
</pre></div>
</div>
</div>
</div>
<p>There is some small correlation.</p>
</section>
<section id="id1">
<h3>Postal code<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<p>The situation is similar with the postal code. Let’s try to evaluate how meaningful it is to transform it into locations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eu_countries</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;AD&#39;</span><span class="p">,</span> <span class="s1">&#39;AT&#39;</span><span class="p">,</span> <span class="s1">&#39;AX&#39;</span><span class="p">,</span> <span class="s1">&#39;BE&#39;</span><span class="p">,</span> <span class="s1">&#39;BG&#39;</span><span class="p">,</span> <span class="s1">&#39;CH&#39;</span><span class="p">,</span> <span class="s1">&#39;CZ&#39;</span><span class="p">,</span> 
                <span class="s1">&#39;DE&#39;</span><span class="p">,</span> <span class="s1">&#39;DK&#39;</span><span class="p">,</span> <span class="s1">&#39;ES&#39;</span><span class="p">,</span> <span class="s1">&#39;FI&#39;</span><span class="p">,</span> <span class="s1">&#39;FO&#39;</span><span class="p">,</span> <span class="s1">&#39;FR&#39;</span><span class="p">,</span> <span class="s1">&#39;GB&#39;</span><span class="p">,</span> 
                <span class="s1">&#39;GG&#39;</span><span class="p">,</span> <span class="s1">&#39;GL&#39;</span><span class="p">,</span> <span class="s1">&#39;HR&#39;</span><span class="p">,</span> <span class="s1">&#39;HU&#39;</span><span class="p">,</span> <span class="s1">&#39;IE&#39;</span><span class="p">,</span> <span class="s1">&#39;IM&#39;</span><span class="p">,</span> <span class="s1">&#39;IT&#39;</span><span class="p">,</span> 
                <span class="s1">&#39;JE&#39;</span><span class="p">,</span> <span class="s1">&#39;LI&#39;</span><span class="p">,</span> <span class="s1">&#39;LT&#39;</span><span class="p">,</span> <span class="s1">&#39;LU&#39;</span><span class="p">,</span> <span class="s1">&#39;LV&#39;</span><span class="p">,</span> <span class="s1">&#39;MC&#39;</span><span class="p">,</span> <span class="s1">&#39;MD&#39;</span><span class="p">,</span> 
                <span class="s1">&#39;MK&#39;</span><span class="p">,</span> <span class="s1">&#39;MT&#39;</span><span class="p">,</span> <span class="s1">&#39;NL&#39;</span><span class="p">,</span> <span class="s1">&#39;NO&#39;</span><span class="p">,</span> <span class="s1">&#39;PL&#39;</span><span class="p">,</span> <span class="s1">&#39;PM&#39;</span><span class="p">,</span> <span class="s1">&#39;PT&#39;</span><span class="p">,</span> 
                <span class="s1">&#39;RO&#39;</span><span class="p">,</span> <span class="s1">&#39;SE&#39;</span><span class="p">,</span> <span class="s1">&#39;SI&#39;</span><span class="p">,</span> <span class="s1">&#39;SJ&#39;</span><span class="p">,</span> <span class="s1">&#39;SK&#39;</span><span class="p">,</span> <span class="s1">&#39;SM&#39;</span><span class="p">,</span> <span class="s1">&#39;VA&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Of the 324 cases, 246 are in Germany, another 52 offer to choose between Germany and some other country. 3 offers were not found among the European countries.</p>
<p>Within Germany, the classification is already more meaningful. However, it is still unclear which country to choose in some cases.</p>
<p>In general, let’s not use this information when teaching. All the more it is calculated very long.</p>
</section>
<section id="id2">
<h3>Vehicle body type<a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">barplot_from_counts</span><span class="p">(</span><span class="n">sample</span><span class="p">[</span><span class="s1">&#39;vehicle_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a7f7b93ffd640a77697f5b0e2fa590a489c1057c82e0f282901be87bcecd15de.png" src="_images/a7f7b93ffd640a77697f5b0e2fa590a489c1057c82e0f282901be87bcecd15de.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vehicle_stat</span> <span class="o">=</span> <span class="p">(</span><span class="n">sample</span>
                <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;vehicle_type&#39;</span><span class="p">)[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span>
                <span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;median&#39;</span><span class="p">])</span>
                <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<span class="n">vehicle_stat</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>median</th>
    </tr>
    <tr>
      <th>vehicle_type</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>sedan</th>
      <td>8744</td>
      <td>4897.866651</td>
      <td>3100</td>
    </tr>
    <tr>
      <th>small</th>
      <td>7491</td>
      <td>2770.428247</td>
      <td>1600</td>
    </tr>
    <tr>
      <th>wagon</th>
      <td>6372</td>
      <td>5154.241996</td>
      <td>3500</td>
    </tr>
    <tr>
      <th>bus</th>
      <td>2766</td>
      <td>5489.066522</td>
      <td>4200</td>
    </tr>
    <tr>
      <th>convertible</th>
      <td>1962</td>
      <td>6910.125382</td>
      <td>5500</td>
    </tr>
    <tr>
      <th>coupe</th>
      <td>1511</td>
      <td>6261.535407</td>
      <td>4250</td>
    </tr>
    <tr>
      <th>other</th>
      <td>1336</td>
      <td>2909.621257</td>
      <td>1450</td>
    </tr>
    <tr>
      <th>suv</th>
      <td>1168</td>
      <td>9375.623288</td>
      <td>8900</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">vehicle_stat</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">vehicle_stat</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">vehicle_stat</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">vehicle_stat</span><span class="p">[</span><span class="s1">&#39;median&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;median&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/6c54c2f766351d68ced5ca7cf1329b96234bf3144c2cc713dd8f7f80abfe86f6.png" src="_images/6c54c2f766351d68ced5ca7cf1329b96234bf3144c2cc713dd8f7f80abfe86f6.png" />
</div>
</div>
<p>In general, we can say that the rarer a car is, the more sellers ask for it.</p>
</section>
<section id="registration-year">
<h3>Registration year<a class="headerlink" href="#registration-year" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([1993, 2011, 2004, 2001, 2008, 1995, 2014, 1998, 2005, 2007, 2009,
       2002, 1997, 1990, 1981, 2003, 2016, 1994, 1991, 1984, 2006, 1999,
       2012, 2010, 1992, 2013, 2000, 1996, 1989, 2015, 1985, 1976, 1983,
       1969, 1971, 1987, 1973, 1986, 1982, 1988, 1980, 1965, 1970, 1974,
       1979, 1978, 1972, 1968, 1977, 1961, 1966, 1975, 1963, 1958, 1967,
       1964, 1960, 1951, 1959, 1953, 1956, 1962, 1950, 1955, 1952, 1957,
       1954])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">year_stat</span> <span class="o">=</span> <span class="p">(</span><span class="n">sample</span>
             <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span>
             <span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;median&#39;</span><span class="p">])</span>
             <span class="o">.</span><span class="n">sort_index</span><span class="p">())</span>
<span class="n">year_stat</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>median</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1950</th>
      <td>2</td>
      <td>19250.000000</td>
      <td>19250.0</td>
    </tr>
    <tr>
      <th>1952</th>
      <td>1</td>
      <td>3800.000000</td>
      <td>3800.0</td>
    </tr>
    <tr>
      <th>1953</th>
      <td>2</td>
      <td>1874.500000</td>
      <td>1874.5</td>
    </tr>
    <tr>
      <th>1955</th>
      <td>4</td>
      <td>15337.500000</td>
      <td>15850.0</td>
    </tr>
    <tr>
      <th>1956</th>
      <td>1</td>
      <td>2990.000000</td>
      <td>2990.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2012</th>
      <td>736</td>
      <td>12225.645380</td>
      <td>12050.0</td>
    </tr>
    <tr>
      <th>2013</th>
      <td>398</td>
      <td>12892.635678</td>
      <td>12900.0</td>
    </tr>
    <tr>
      <th>2014</th>
      <td>253</td>
      <td>13220.869565</td>
      <td>13700.0</td>
    </tr>
    <tr>
      <th>2015</th>
      <td>102</td>
      <td>12784.882353</td>
      <td>14030.0</td>
    </tr>
    <tr>
      <th>2016</th>
      <td>607</td>
      <td>2670.039539</td>
      <td>1200.0</td>
    </tr>
  </tbody>
</table>
<p>65 rows × 3 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">year_stat</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">year_stat</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Proposals&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/8492bb385cc5979ad76495f1cf35d8c059bcb56d3b0cc9627c4f24f08a50f530.png" src="_images/8492bb385cc5979ad76495f1cf35d8c059bcb56d3b0cc9627c4f24f08a50f530.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">year_stat</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">year_stat</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">year_stat</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">year_stat</span><span class="p">[</span><span class="s1">&#39;median&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;median&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/2cbb4355549e5f5b2b3bd7f69d8f5ff520b04aefb393f157dab021f0a7180662.png" src="_images/2cbb4355549e5f5b2b3bd7f69d8f5ff520b04aefb393f157dab021f0a7180662.png" />
</div>
</div>
<p>For the main dataset, there is a clear upward trend in price with novelty.</p>
</section>
<section id="id3">
<h3>Gearbox<a class="headerlink" href="#id3" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gearbox_stat</span> <span class="o">=</span> <span class="p">(</span><span class="n">sample</span>
             <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;gearbox&#39;</span><span class="p">)[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span>
             <span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;median&#39;</span><span class="p">])</span>
             <span class="o">.</span><span class="n">sort_index</span><span class="p">())</span>
<span class="n">gearbox_stat</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>median</th>
    </tr>
    <tr>
      <th>gearbox</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>auto</th>
      <td>6190</td>
      <td>7245.962682</td>
      <td>5950</td>
    </tr>
    <tr>
      <th>manual</th>
      <td>24345</td>
      <td>4196.109427</td>
      <td>2650</td>
    </tr>
    <tr>
      <th>unknown</th>
      <td>815</td>
      <td>3013.309202</td>
      <td>2250</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Apparently, the price depends on the gearbox automation.</p>
</section>
<section id="id4">
<h3>Engine power<a class="headerlink" href="#id4" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">power_stat</span> <span class="o">=</span> <span class="p">(</span><span class="n">sample</span>
             <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;power&#39;</span><span class="p">)[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span>
             <span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;median&#39;</span><span class="p">])</span>
             <span class="o">.</span><span class="n">sort_index</span><span class="p">())</span>
<span class="n">power_stat</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>median</th>
    </tr>
    <tr>
      <th>power</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>45</th>
      <td>268</td>
      <td>1666.029851</td>
      <td>699.5</td>
    </tr>
    <tr>
      <th>46</th>
      <td>10</td>
      <td>4305.000000</td>
      <td>3175.0</td>
    </tr>
    <tr>
      <th>47</th>
      <td>5</td>
      <td>7599.800000</td>
      <td>2500.0</td>
    </tr>
    <tr>
      <th>48</th>
      <td>12</td>
      <td>4095.583333</td>
      <td>2350.0</td>
    </tr>
    <tr>
      <th>49</th>
      <td>3</td>
      <td>553.000000</td>
      <td>499.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>420</th>
      <td>2</td>
      <td>8750.000000</td>
      <td>8750.0</td>
    </tr>
    <tr>
      <th>431</th>
      <td>1</td>
      <td>19990.000000</td>
      <td>19990.0</td>
    </tr>
    <tr>
      <th>435</th>
      <td>5</td>
      <td>16880.000000</td>
      <td>17200.0</td>
    </tr>
    <tr>
      <th>442</th>
      <td>1</td>
      <td>11900.000000</td>
      <td>11900.0</td>
    </tr>
    <tr>
      <th>445</th>
      <td>1</td>
      <td>11850.000000</td>
      <td>11850.0</td>
    </tr>
  </tbody>
</table>
<p>285 rows × 3 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample</span><span class="p">[</span><span class="s1">&#39;power&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Proposals&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/62c91f9deb41f6b3a375d34b7af9b529767b778f677dfc0065af3955d937175a.png" src="_images/62c91f9deb41f6b3a375d34b7af9b529767b778f677dfc0065af3955d937175a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">power_stat</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">power_stat</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">power_stat</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">power_stat</span><span class="p">[</span><span class="s1">&#39;median&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;median&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/dda8ffedd6d7c3d363c38098528b16495c5702c508061f8bf118bcd48074f0ac.png" src="_images/dda8ffedd6d7c3d363c38098528b16495c5702c508061f8bf118bcd48074f0ac.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">sample</span><span class="p">[</span><span class="s1">&#39;power&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.5059295126901395
</pre></div>
</div>
</div>
</div>
<p>Correlation, of course, does not imply causation. But there is still a reason to believe that price depends on power.</p>
</section>
<section id="id5">
<h3>Car model<a class="headerlink" href="#id5" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">sample</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>245
</pre></div>
</div>
</div>
</div>
<p>Let’s check how unambiguously the models match the brands.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">models_by_brand</span> <span class="o">=</span> <span class="n">sample</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;brand&#39;</span><span class="p">)[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">models_by_brand</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>brand
alfa_romeo                      [156, 145, 147, other, spider, 159]
audi              [a4, q7, 90, a6, a3, a5, a8, 80, other, a1, 10...
bmw               [3er, 5er, other, x_reihe, 1er, z_reihe, 7er, ...
chevrolet                      [matiz, aveo, captiva, other, spark]
chrysler          [other, crossfire, voyager, ptcruiser, 300c, g...
citroen                       [c3, c5, other, c4, c2, c1, berlingo]
dacia                        [sandero, logan, duster, lodgy, other]
daewoo                         [matiz, nubira, kalos, other, lanos]
daihatsu          [sirion, terios, cuore, other, move, materia, ...
fiat              [punto, other, 500, bravo, doblo, stilo, seice...
ford              [ka, escort, focus, fiesta, other, mondeo, kug...
honda                        [cr_reihe, other, accord, civic, jazz]
hyundai                       [other, i_reihe, santa, tucson, getz]
jaguar                                      [other, x_type, s_type]
jeep                             [grand, other, cherokee, wrangler]
kia               [carnival, other, sorento, sportage, picanto, ...
lada                                          [niva, other, samara]
lancia            [other, lybra, ypsilon, elefantino, delta, mus...
land_rover        [freelander, range_rover, defender, discovery,...
mazda             [mx_reihe, other, 6_reihe, 3_reihe, rx_reihe, ...
mercedes_benz     [c_klasse, e_klasse, other, vito, s_klasse, a_...
mini                                  [one, cooper, other, clubman]
mitsubishi        [lancer, colt, carisma, other, pajero, galant,...
nissan            [micra, primera, almera, qashqai, other, juke,...
opel              [zafira, astra, meriva, corsa, vivaro, omega, ...
peugeot           [3_reihe, 2_reihe, other, 1_reihe, 4_reihe, 5_...
porsche                              [cayenne, boxster, other, 911]
renault           [twingo, clio, espace, laguna, megane, modus, ...
rover                                [other, discovery, freelander]
saab                                             [other, 900, 9000]
seat              [ibiza, arosa, leon, alhambra, altea, cordoba,...
skoda             [other, fabia, octavia, citigo, superb, yeti, ...
smart                            [fortwo, other, roadster, forfour]
sonstige_autos                                              [other]
subaru                    [legacy, other, impreza, justy, forester]
suzuki                                 [swift, other, grand, jimny]
toyota            [avensis, other, corolla, yaris, rav, auris, a...
trabant                                                [601, other]
volkswagen        [passat, golf, polo, transporter, up, touareg,...
volvo             [v70, c_reihe, other, s60, v50, xc_reihe, v40,...
Name: model, dtype: object
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sets</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">brand_from</span> <span class="ow">in</span> <span class="n">models_by_brand</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">brand_to</span> <span class="ow">in</span> <span class="n">models_by_brand</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">brand_from</span> <span class="o">!=</span> <span class="n">brand_to</span><span class="p">:</span>
            <span class="n">sets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">models_by_brand</span><span class="p">[</span><span class="n">brand_from</span><span class="p">])</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">models_by_brand</span><span class="p">[</span><span class="n">brand_to</span><span class="p">]))</span>
<span class="c1"># sets</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sets</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="p">{</span><span class="s1">&#39;other&#39;</span><span class="p">}:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;matiz&#39;, &#39;other&#39;}
{&#39;grand&#39;, &#39;other&#39;}
{&#39;grand&#39;, &#39;other&#39;}
{&#39;matiz&#39;, &#39;other&#39;}
{&#39;grand&#39;, &#39;other&#39;}
{&#39;grand&#39;, &#39;other&#39;}
{&#39;freelander&#39;, &#39;discovery&#39;, &#39;other&#39;}
{&#39;1_reihe&#39;, &#39;3_reihe&#39;, &#39;other&#39;, &#39;5_reihe&#39;}
{&#39;1_reihe&#39;, &#39;3_reihe&#39;, &#39;other&#39;, &#39;5_reihe&#39;}
{&#39;freelander&#39;, &#39;discovery&#39;, &#39;other&#39;}
{&#39;grand&#39;, &#39;other&#39;}
{&#39;grand&#39;, &#39;other&#39;}
</pre></div>
</div>
</div>
</div>
<p>By and large, the models don’t overlap. The question is whether to use them in training or make do with the brand. I think it is better not to take it because it will encourage overtraining.</p>
</section>
<section id="id6">
<h3>Mileage<a class="headerlink" href="#id6" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">km_stat</span> <span class="o">=</span> <span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;km&#39;</span><span class="p">)[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;median&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_index</span><span class="p">())</span>
<span class="n">km_stat</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>median</th>
    </tr>
    <tr>
      <th>km</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>5000</th>
      <td>331</td>
      <td>4160.265861</td>
      <td>1700.0</td>
    </tr>
    <tr>
      <th>10000</th>
      <td>80</td>
      <td>11537.625000</td>
      <td>12110.5</td>
    </tr>
    <tr>
      <th>20000</th>
      <td>367</td>
      <td>9311.476839</td>
      <td>9000.0</td>
    </tr>
    <tr>
      <th>30000</th>
      <td>418</td>
      <td>10108.069378</td>
      <td>9900.0</td>
    </tr>
    <tr>
      <th>40000</th>
      <td>451</td>
      <td>9965.481153</td>
      <td>9300.0</td>
    </tr>
    <tr>
      <th>50000</th>
      <td>559</td>
      <td>9393.166369</td>
      <td>8500.0</td>
    </tr>
    <tr>
      <th>60000</th>
      <td>754</td>
      <td>9143.026525</td>
      <td>8100.0</td>
    </tr>
    <tr>
      <th>70000</th>
      <td>752</td>
      <td>8275.559840</td>
      <td>7145.0</td>
    </tr>
    <tr>
      <th>80000</th>
      <td>940</td>
      <td>7433.852128</td>
      <td>6400.0</td>
    </tr>
    <tr>
      <th>90000</th>
      <td>1073</td>
      <td>7013.849021</td>
      <td>5999.0</td>
    </tr>
    <tr>
      <th>100000</th>
      <td>1332</td>
      <td>6306.957207</td>
      <td>5000.0</td>
    </tr>
    <tr>
      <th>125000</th>
      <td>3304</td>
      <td>5356.416162</td>
      <td>3800.0</td>
    </tr>
    <tr>
      <th>150000</th>
      <td>20989</td>
      <td>3623.120444</td>
      <td>2250.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">km_stat</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">km_stat</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">km_stat</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">km_stat</span><span class="p">[</span><span class="s1">&#39;median&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;median&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/efc30d728899538d42da9a1ec5c218eaaebb5b650a049b327aaffc7bf387e1aa.png" src="_images/efc30d728899538d42da9a1ec5c218eaaebb5b650a049b327aaffc7bf387e1aa.png" />
</div>
</div>
<p>It turns out that almost unused cars are valued low. This may be due to the year of manufacture.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">km_by_year</span> <span class="o">=</span> <span class="n">sample</span><span class="p">[</span><span class="n">sample</span><span class="p">[</span><span class="s1">&#39;km&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">5000</span><span class="p">][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">km_by_year</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">km_by_year</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;5000 km&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/369a93907d9ed99b79aa5c00d646068a7c30f30f791642ac66f516373995750f.png" src="_images/369a93907d9ed99b79aa5c00d646068a7c30f30f791642ac66f516373995750f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">km_by_year_total</span> <span class="o">=</span> <span class="n">sample</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">km_by_year_total</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">km_by_year_total</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;All&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d3592f384707db3431d95f4ea1886a27c163b09eac56f66c4c84ee5d493cb639.png" src="_images/d3592f384707db3431d95f4ea1886a27c163b09eac56f66c4c84ee5d493cb639.png" />
</div>
</div>
<p>No, it doesn’t look like it.</p>
</section>
<section id="month">
<h3>Month<a class="headerlink" href="#month" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">)[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pandas.core.groupby.generic.SeriesGroupBy object at 0x7327db9c20d0&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">month_stat</span> <span class="o">=</span> <span class="p">(</span><span class="n">sample</span>
             <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">)[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span>
             <span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;median&#39;</span><span class="p">])</span>
             <span class="o">.</span><span class="n">sort_index</span><span class="p">())</span>
<span class="n">month_stat</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>median</th>
    </tr>
    <tr>
      <th>month</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2153</td>
      <td>2375.229447</td>
      <td>1300</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2048</td>
      <td>4733.095703</td>
      <td>2999</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1902</td>
      <td>4789.637224</td>
      <td>3000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3224</td>
      <td>4755.536290</td>
      <td>2999</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2729</td>
      <td>5059.130817</td>
      <td>3400</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2690</td>
      <td>4927.915613</td>
      <td>3350</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2827</td>
      <td>4869.239830</td>
      <td>3100</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2506</td>
      <td>5104.338787</td>
      <td>3500</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2123</td>
      <td>4709.706076</td>
      <td>2990</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2220</td>
      <td>5188.923423</td>
      <td>3500</td>
    </tr>
    <tr>
      <th>10</th>
      <td>2407</td>
      <td>5014.046115</td>
      <td>3400</td>
    </tr>
    <tr>
      <th>11</th>
      <td>2320</td>
      <td>5215.491379</td>
      <td>3550</td>
    </tr>
    <tr>
      <th>12</th>
      <td>2201</td>
      <td>4955.707406</td>
      <td>3300</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">month_stat</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">month_stat</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">month_stat</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">month_stat</span><span class="p">[</span><span class="s1">&#39;median&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;median&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Price by month of registration&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/9c8817a78043c4f49456048ea2050fd5fb3d7263e0b9477ea751e628a6c10583.png" src="_images/9c8817a78043c4f49456048ea2050fd5fb3d7263e0b9477ea751e628a6c10583.png" />
</div>
</div>
<p>Seems like this column does not affect the price.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">sample</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.08204929198706952
</pre></div>
</div>
</div>
</div>
<p>Apparently not. Let’s not train on it.</p>
</section>
<section id="id7">
<h3>Fuel type<a class="headerlink" href="#id7" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fuel_stat</span> <span class="o">=</span> <span class="p">(</span><span class="n">sample</span>
             <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;fuel_type&#39;</span><span class="p">)[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span>
             <span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;median&#39;</span><span class="p">])</span>
             <span class="o">.</span><span class="n">sort_index</span><span class="p">())</span>
<span class="n">fuel_stat</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>median</th>
    </tr>
    <tr>
      <th>fuel_type</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>cng</th>
      <td>57</td>
      <td>4819.192982</td>
      <td>4500</td>
    </tr>
    <tr>
      <th>electric</th>
      <td>4</td>
      <td>10912.500000</td>
      <td>10375</td>
    </tr>
    <tr>
      <th>gasoline</th>
      <td>9350</td>
      <td>6892.283850</td>
      <td>5699</td>
    </tr>
    <tr>
      <th>hybrid</th>
      <td>23</td>
      <td>9472.130435</td>
      <td>10900</td>
    </tr>
    <tr>
      <th>lpg</th>
      <td>454</td>
      <td>4478.830396</td>
      <td>3333</td>
    </tr>
    <tr>
      <th>other</th>
      <td>1481</td>
      <td>2882.409183</td>
      <td>1500</td>
    </tr>
    <tr>
      <th>petrol</th>
      <td>19981</td>
      <td>3912.784445</td>
      <td>2250</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fuel_stat</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_axis</span> <span class="o">-</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">fuel_stat</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_axis</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">fuel_stat</span><span class="p">[</span><span class="s1">&#39;median&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;median&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">x_axis</span><span class="p">,</span> <span class="n">fuel_stat</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Price by fuel type&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3f1ae53b1f33e57569b27a5fef0c668576a143e00725ccb78105e973745bf3ac.png" src="_images/3f1ae53b1f33e57569b27a5fef0c668576a143e00725ccb78105e973745bf3ac.png" />
</div>
</div>
<p>There is little data for electric and hybrid-fueled vehicles, but there appears to be a correlation.</p>
</section>
<section id="brand">
<h3>Brand<a class="headerlink" href="#brand" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">brand_stat</span> <span class="o">=</span> <span class="p">(</span><span class="n">sample</span>
             <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;brand&#39;</span><span class="p">)[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span>
             <span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;median&#39;</span><span class="p">])</span>
             <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">))</span>
<span class="n">brand_stat</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>median</th>
    </tr>
    <tr>
      <th>brand</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>daewoo</th>
      <td>45</td>
      <td>977.800000</td>
      <td>900.0</td>
    </tr>
    <tr>
      <th>rover</th>
      <td>36</td>
      <td>1480.666667</td>
      <td>950.0</td>
    </tr>
    <tr>
      <th>daihatsu</th>
      <td>61</td>
      <td>2081.918033</td>
      <td>1300.0</td>
    </tr>
    <tr>
      <th>trabant</th>
      <td>9</td>
      <td>2097.000000</td>
      <td>2000.0</td>
    </tr>
    <tr>
      <th>renault</th>
      <td>1576</td>
      <td>2401.462563</td>
      <td>1350.0</td>
    </tr>
    <tr>
      <th>lancia</th>
      <td>37</td>
      <td>2486.270270</td>
      <td>1300.0</td>
    </tr>
    <tr>
      <th>fiat</th>
      <td>805</td>
      <td>2903.925466</td>
      <td>1750.0</td>
    </tr>
    <tr>
      <th>opel</th>
      <td>3534</td>
      <td>3017.632428</td>
      <td>1700.0</td>
    </tr>
    <tr>
      <th>mitsubishi</th>
      <td>264</td>
      <td>3332.837121</td>
      <td>1600.0</td>
    </tr>
    <tr>
      <th>ford</th>
      <td>2263</td>
      <td>3393.979231</td>
      <td>1800.0</td>
    </tr>
    <tr>
      <th>peugeot</th>
      <td>972</td>
      <td>3426.346708</td>
      <td>2449.5</td>
    </tr>
    <tr>
      <th>chrysler</th>
      <td>133</td>
      <td>3527.052632</td>
      <td>1990.0</td>
    </tr>
    <tr>
      <th>subaru</th>
      <td>57</td>
      <td>3576.000000</td>
      <td>1700.0</td>
    </tr>
    <tr>
      <th>citroen</th>
      <td>421</td>
      <td>3770.857482</td>
      <td>2650.0</td>
    </tr>
    <tr>
      <th>smart</th>
      <td>431</td>
      <td>3777.895592</td>
      <td>3100.0</td>
    </tr>
    <tr>
      <th>mazda</th>
      <td>539</td>
      <td>3794.000000</td>
      <td>2500.0</td>
    </tr>
    <tr>
      <th>alfa_romeo</th>
      <td>213</td>
      <td>3824.582160</td>
      <td>2400.0</td>
    </tr>
    <tr>
      <th>lada</th>
      <td>24</td>
      <td>4133.625000</td>
      <td>3499.5</td>
    </tr>
    <tr>
      <th>honda</th>
      <td>277</td>
      <td>4185.050542</td>
      <td>2950.0</td>
    </tr>
    <tr>
      <th>suzuki</th>
      <td>219</td>
      <td>4293.141553</td>
      <td>3000.0</td>
    </tr>
    <tr>
      <th>seat</th>
      <td>616</td>
      <td>4425.188312</td>
      <td>2750.0</td>
    </tr>
    <tr>
      <th>nissan</th>
      <td>429</td>
      <td>4457.016317</td>
      <td>2350.0</td>
    </tr>
    <tr>
      <th>saab</th>
      <td>44</td>
      <td>4657.363636</td>
      <td>2800.0</td>
    </tr>
    <tr>
      <th>volkswagen</th>
      <td>6631</td>
      <td>4747.163022</td>
      <td>2990.0</td>
    </tr>
    <tr>
      <th>toyota</th>
      <td>435</td>
      <td>4771.425287</td>
      <td>3990.0</td>
    </tr>
    <tr>
      <th>volvo</th>
      <td>279</td>
      <td>4807.139785</td>
      <td>3100.0</td>
    </tr>
    <tr>
      <th>kia</th>
      <td>210</td>
      <td>5155.023810</td>
      <td>3325.0</td>
    </tr>
    <tr>
      <th>hyundai</th>
      <td>329</td>
      <td>5383.458967</td>
      <td>3900.0</td>
    </tr>
    <tr>
      <th>chevrolet</th>
      <td>145</td>
      <td>5511.310345</td>
      <td>4000.0</td>
    </tr>
    <tr>
      <th>dacia</th>
      <td>75</td>
      <td>5615.960000</td>
      <td>4250.0</td>
    </tr>
    <tr>
      <th>mercedes_benz</th>
      <td>2953</td>
      <td>6136.944802</td>
      <td>4500.0</td>
    </tr>
    <tr>
      <th>skoda</th>
      <td>521</td>
      <td>6298.978887</td>
      <td>5300.0</td>
    </tr>
    <tr>
      <th>bmw</th>
      <td>3300</td>
      <td>6494.579091</td>
      <td>5250.0</td>
    </tr>
    <tr>
      <th>jaguar</th>
      <td>58</td>
      <td>6699.724138</td>
      <td>5500.0</td>
    </tr>
    <tr>
      <th>audi</th>
      <td>2736</td>
      <td>6731.476243</td>
      <td>5500.0</td>
    </tr>
    <tr>
      <th>sonstige_autos</th>
      <td>185</td>
      <td>7300.281081</td>
      <td>6000.0</td>
    </tr>
    <tr>
      <th>jeep</th>
      <td>62</td>
      <td>7392.354839</td>
      <td>6374.5</td>
    </tr>
    <tr>
      <th>mini</th>
      <td>299</td>
      <td>9378.066890</td>
      <td>8550.0</td>
    </tr>
    <tr>
      <th>land_rover</th>
      <td>68</td>
      <td>10315.044118</td>
      <td>10375.0</td>
    </tr>
    <tr>
      <th>porsche</th>
      <td>59</td>
      <td>12445.237288</td>
      <td>13500.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">brand_stat</span><span class="p">))</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">x_axis</span><span class="p">,</span> <span class="n">brand_stat</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">],</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">x_axis</span> <span class="o">+</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">brand_stat</span><span class="p">[</span><span class="s1">&#39;median&#39;</span><span class="p">],</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;median&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">yticks</span><span class="o">=</span><span class="n">x_axis</span> <span class="o">+</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">brand_stat</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="mf">0.4</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">brand_stat</span><span class="p">)])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Price by brand (euros)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/61ea328bc535db417c3907dde07f622b0c46261544b87dedeadf8a014affdc32.png" src="_images/61ea328bc535db417c3907dde07f622b0c46261544b87dedeadf8a014affdc32.png" />
</div>
</div>
<p>Not surprisingly, there’s a dependency here.</p>
</section>
<section id="id8">
<h3>Breakdown history<a class="headerlink" href="#id8" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">repair_stat</span> <span class="o">=</span> <span class="p">(</span><span class="n">sample</span>
             <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;repaired&#39;</span><span class="p">)[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span>
             <span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;median&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">])</span>
             <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">))</span>
<span class="n">repair_stat</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>median</th>
      <th>std</th>
    </tr>
    <tr>
      <th>repaired</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>yes</th>
      <td>3190</td>
      <td>2158.423511</td>
      <td>1000</td>
      <td>2909.581567</td>
    </tr>
    <tr>
      <th>unknown</th>
      <td>4807</td>
      <td>3133.212191</td>
      <td>1800</td>
      <td>3558.690219</td>
    </tr>
    <tr>
      <th>no</th>
      <td>23353</td>
      <td>5460.365606</td>
      <td>3850</td>
      <td>4753.213788</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>I wonder if the price depends on the year the application was created.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sb</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">sample</span><span class="p">[</span><span class="n">sample</span><span class="p">[</span><span class="s1">&#39;repaired&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">][</span><span class="s1">&#39;created&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">),</span> 
            <span class="n">y</span><span class="o">=</span><span class="n">sample</span><span class="p">[</span><span class="n">sample</span><span class="p">[</span><span class="s1">&#39;repaired&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">][</span><span class="s1">&#39;price&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;yes&#39;</span><span class="p">)</span>
<span class="n">sb</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">sample</span><span class="p">[</span><span class="n">sample</span><span class="p">[</span><span class="s1">&#39;repaired&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;no&#39;</span><span class="p">][</span><span class="s1">&#39;created&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">),</span> 
            <span class="n">y</span><span class="o">=</span><span class="n">sample</span><span class="p">[</span><span class="n">sample</span><span class="p">[</span><span class="s1">&#39;repaired&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;no&#39;</span><span class="p">][</span><span class="s1">&#39;price&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;no&#39;</span><span class="p">)</span>
<span class="n">sb</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">sample</span><span class="p">[</span><span class="n">sample</span><span class="p">[</span><span class="s1">&#39;repaired&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;unknown&#39;</span><span class="p">][</span><span class="s1">&#39;created&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">),</span> 
            <span class="n">y</span><span class="o">=</span><span class="n">sample</span><span class="p">[</span><span class="n">sample</span><span class="p">[</span><span class="s1">&#39;repaired&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;unknown&#39;</span><span class="p">][</span><span class="s1">&#39;price&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;unknown&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/359d803cc26996159e0b83b351fcec9856af76d61d53bc99c648e84eae76797f.png" src="_images/359d803cc26996159e0b83b351fcec9856af76d61d53bc99c648e84eae76797f.png" />
</div>
</div>
<p>If we put a standard deviation instead of a confidence interval, it’s not so pretty.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sb</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">sample</span><span class="p">[</span><span class="n">sample</span><span class="p">[</span><span class="s1">&#39;repaired&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">][</span><span class="s1">&#39;created&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">),</span> 
            <span class="n">y</span><span class="o">=</span><span class="n">sample</span><span class="p">[</span><span class="n">sample</span><span class="p">[</span><span class="s1">&#39;repaired&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">][</span><span class="s1">&#39;price&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="n">errorbar</span><span class="o">=</span><span class="s1">&#39;sd&#39;</span><span class="p">)</span>
<span class="n">sb</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">sample</span><span class="p">[</span><span class="n">sample</span><span class="p">[</span><span class="s1">&#39;repaired&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;no&#39;</span><span class="p">][</span><span class="s1">&#39;created&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">),</span> 
            <span class="n">y</span><span class="o">=</span><span class="n">sample</span><span class="p">[</span><span class="n">sample</span><span class="p">[</span><span class="s1">&#39;repaired&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;no&#39;</span><span class="p">][</span><span class="s1">&#39;price&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="n">errorbar</span><span class="o">=</span><span class="s1">&#39;sd&#39;</span><span class="p">)</span>
<span class="n">sb</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">sample</span><span class="p">[</span><span class="n">sample</span><span class="p">[</span><span class="s1">&#39;repaired&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;unknown&#39;</span><span class="p">][</span><span class="s1">&#39;created&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">),</span> 
            <span class="n">y</span><span class="o">=</span><span class="n">sample</span><span class="p">[</span><span class="n">sample</span><span class="p">[</span><span class="s1">&#39;repaired&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;unknown&#39;</span><span class="p">][</span><span class="s1">&#39;price&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span> <span class="n">errorbar</span><span class="o">=</span><span class="s1">&#39;sd&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/8d47daaa1ea7b295f54cd7bfdccc4242129e20cdbf4ae254258aac5bfcccbf0c.png" src="_images/8d47daaa1ea7b295f54cd7bfdccc4242129e20cdbf4ae254258aac5bfcccbf0c.png" />
</div>
</div>
<p>That’s essentially how it should be though. Unbroken cars of different price ranges can be sold on the same day, so nothing strange here. The sign is significant, even if it doesn’t reflect reality.</p>
</section>
<section id="relationship-of-attributes">
<h3>Relationship of attributes<a class="headerlink" href="#relationship-of-attributes" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">sb</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;flare&#39;</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c5546e201823b4017af881e5989407abc2670ef0e204ceef7a007e0335035ca1.png" src="_images/c5546e201823b4017af881e5989407abc2670ef0e204ceef7a007e0335035ca1.png" />
</div>
</div>
<p>The price is dependent on a number of attributes, which cannot but rejoice. As for the attributes for training, there is no multicollinearity between them. Except for a little bit between year and mileage.</p>
</section>
</section>
<section id="samples">
<h2>Samples<a class="headerlink" href="#samples" title="Link to this heading">#</a></h2>
<p>Since ~350,000 objects can take a long time to process, let’s take 25% of this data.</p>
<p>For them we also need to:</p>
<ol class="arabic simple">
<li><p>select the features for the training</p></li>
<li><p>conduct OHE for categorical variables</p></li>
<li><p>conduct scaling for numerical variables</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">57</span><span class="p">)</span>
<span class="n">sample</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>downloaded      datetime64[ns]
price                    int64
vehicle_type            object
year                     int64
gearbox                 object
power                    int64
model                   object
km                       int64
month                    int64
fuel_type               object
brand                   object
repaired                object
created         datetime64[ns]
postal_code              int64
visited         datetime64[ns]
dtype: object
</pre></div>
</div>
</div>
</div>
<section id="features-for-training">
<h3>Features for training<a class="headerlink" href="#features-for-training" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features</span> <span class="o">=</span> <span class="n">sample</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;downloaded&#39;</span><span class="p">,</span> 
                        <span class="s1">&#39;price&#39;</span><span class="p">,</span> 
                        <span class="s1">&#39;model&#39;</span><span class="p">,</span> 
                        <span class="s1">&#39;month&#39;</span><span class="p">,</span> 
                        <span class="s1">&#39;created&#39;</span><span class="p">,</span> 
                        <span class="s1">&#39;postal_code&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">target</span> <span class="o">=</span> <span class="n">sample</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(78374, 9)
(78374,)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>vehicle_type</th>
      <th>year</th>
      <th>gearbox</th>
      <th>power</th>
      <th>km</th>
      <th>fuel_type</th>
      <th>brand</th>
      <th>repaired</th>
      <th>visited</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>262452</th>
      <td>wagon</td>
      <td>1999</td>
      <td>manual</td>
      <td>125</td>
      <td>150000</td>
      <td>petrol</td>
      <td>volkswagen</td>
      <td>unknown</td>
      <td>2016-04-05 12:17:29</td>
    </tr>
    <tr>
      <th>323263</th>
      <td>wagon</td>
      <td>1996</td>
      <td>manual</td>
      <td>116</td>
      <td>150000</td>
      <td>petrol</td>
      <td>bmw</td>
      <td>no</td>
      <td>2016-04-06 15:18:01</td>
    </tr>
    <tr>
      <th>139907</th>
      <td>small</td>
      <td>2009</td>
      <td>manual</td>
      <td>69</td>
      <td>60000</td>
      <td>petrol</td>
      <td>ford</td>
      <td>unknown</td>
      <td>2016-04-06 00:44:44</td>
    </tr>
    <tr>
      <th>112881</th>
      <td>sedan</td>
      <td>2002</td>
      <td>manual</td>
      <td>163</td>
      <td>150000</td>
      <td>petrol</td>
      <td>mercedes_benz</td>
      <td>no</td>
      <td>2016-04-01 16:55:42</td>
    </tr>
    <tr>
      <th>72971</th>
      <td>wagon</td>
      <td>2006</td>
      <td>manual</td>
      <td>116</td>
      <td>150000</td>
      <td>gasoline</td>
      <td>audi</td>
      <td>no</td>
      <td>2016-03-07 15:45:13</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>172674</th>
      <td>wagon</td>
      <td>2005</td>
      <td>manual</td>
      <td>116</td>
      <td>150000</td>
      <td>gasoline</td>
      <td>bmw</td>
      <td>no</td>
      <td>2016-03-13 01:17:49</td>
    </tr>
    <tr>
      <th>162873</th>
      <td>convertible</td>
      <td>2005</td>
      <td>manual</td>
      <td>101</td>
      <td>150000</td>
      <td>petrol</td>
      <td>opel</td>
      <td>no</td>
      <td>2016-03-12 21:46:56</td>
    </tr>
    <tr>
      <th>37884</th>
      <td>sedan</td>
      <td>2007</td>
      <td>manual</td>
      <td>224</td>
      <td>150000</td>
      <td>gasoline</td>
      <td>mercedes_benz</td>
      <td>no</td>
      <td>2016-04-05 16:46:24</td>
    </tr>
    <tr>
      <th>178618</th>
      <td>wagon</td>
      <td>2002</td>
      <td>auto</td>
      <td>143</td>
      <td>150000</td>
      <td>gasoline</td>
      <td>mercedes_benz</td>
      <td>unknown</td>
      <td>2016-03-27 18:44:43</td>
    </tr>
    <tr>
      <th>121151</th>
      <td>wagon</td>
      <td>1999</td>
      <td>manual</td>
      <td>110</td>
      <td>150000</td>
      <td>gasoline</td>
      <td>volkswagen</td>
      <td>yes</td>
      <td>2016-04-05 13:18:27</td>
    </tr>
  </tbody>
</table>
<p>78374 rows × 9 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;visited&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>vehicle_type</th>
      <th>year</th>
      <th>gearbox</th>
      <th>power</th>
      <th>km</th>
      <th>fuel_type</th>
      <th>brand</th>
      <th>repaired</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>262452</th>
      <td>wagon</td>
      <td>1999</td>
      <td>manual</td>
      <td>125</td>
      <td>150000</td>
      <td>petrol</td>
      <td>volkswagen</td>
      <td>unknown</td>
    </tr>
    <tr>
      <th>323263</th>
      <td>wagon</td>
      <td>1996</td>
      <td>manual</td>
      <td>116</td>
      <td>150000</td>
      <td>petrol</td>
      <td>bmw</td>
      <td>no</td>
    </tr>
    <tr>
      <th>139907</th>
      <td>small</td>
      <td>2009</td>
      <td>manual</td>
      <td>69</td>
      <td>60000</td>
      <td>petrol</td>
      <td>ford</td>
      <td>unknown</td>
    </tr>
    <tr>
      <th>112881</th>
      <td>sedan</td>
      <td>2002</td>
      <td>manual</td>
      <td>163</td>
      <td>150000</td>
      <td>petrol</td>
      <td>mercedes_benz</td>
      <td>no</td>
    </tr>
    <tr>
      <th>72971</th>
      <td>wagon</td>
      <td>2006</td>
      <td>manual</td>
      <td>116</td>
      <td>150000</td>
      <td>gasoline</td>
      <td>audi</td>
      <td>no</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>172674</th>
      <td>wagon</td>
      <td>2005</td>
      <td>manual</td>
      <td>116</td>
      <td>150000</td>
      <td>gasoline</td>
      <td>bmw</td>
      <td>no</td>
    </tr>
    <tr>
      <th>162873</th>
      <td>convertible</td>
      <td>2005</td>
      <td>manual</td>
      <td>101</td>
      <td>150000</td>
      <td>petrol</td>
      <td>opel</td>
      <td>no</td>
    </tr>
    <tr>
      <th>37884</th>
      <td>sedan</td>
      <td>2007</td>
      <td>manual</td>
      <td>224</td>
      <td>150000</td>
      <td>gasoline</td>
      <td>mercedes_benz</td>
      <td>no</td>
    </tr>
    <tr>
      <th>178618</th>
      <td>wagon</td>
      <td>2002</td>
      <td>auto</td>
      <td>143</td>
      <td>150000</td>
      <td>gasoline</td>
      <td>mercedes_benz</td>
      <td>unknown</td>
    </tr>
    <tr>
      <th>121151</th>
      <td>wagon</td>
      <td>1999</td>
      <td>manual</td>
      <td>110</td>
      <td>150000</td>
      <td>gasoline</td>
      <td>volkswagen</td>
      <td>yes</td>
    </tr>
  </tbody>
</table>
<p>78374 rows × 8 columns</p>
</div></div></div>
</div>
<p>This is the form in which the data will come into work.</p>
</section>
<section id="splitting">
<h3>Splitting<a class="headerlink" href="#splitting" title="Link to this heading">#</a></h3>
<p>Let’s divide the samples into training, validation and test samples. This is necessary even for models with cross-validation, because we will need to conduct a mini-test after parameter selection.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features_train</span><span class="p">,</span> <span class="n">features_valid</span><span class="p">,</span> <span class="n">features_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
    <span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">57</span><span class="p">),[</span><span class="nb">int</span><span class="p">(</span><span class="mf">0.6</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.8</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">))])</span>
<span class="n">target_train</span><span class="p">,</span> <span class="n">target_valid</span><span class="p">,</span> <span class="n">target_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
    <span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">57</span><span class="p">),[</span><span class="nb">int</span><span class="p">(</span><span class="mf">0.6</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">target</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.8</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">target</span><span class="p">))])</span>
<span class="c1"># .sample(frac=1) to mix the dataframe, then the indexes by which we split the data</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">features_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">features_valid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">features_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">target_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">target_valid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">target_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(47024, 8)
(15675, 8)
(15675, 8)
(47024,)
(15675,)
(15675,)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features_train</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>vehicle_type</th>
      <th>year</th>
      <th>gearbox</th>
      <th>power</th>
      <th>km</th>
      <th>fuel_type</th>
      <th>brand</th>
      <th>repaired</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>159639</th>
      <td>wagon</td>
      <td>2005</td>
      <td>auto</td>
      <td>140</td>
      <td>150000</td>
      <td>gasoline</td>
      <td>audi</td>
      <td>no</td>
    </tr>
    <tr>
      <th>34735</th>
      <td>sedan</td>
      <td>2003</td>
      <td>manual</td>
      <td>150</td>
      <td>90000</td>
      <td>gasoline</td>
      <td>mercedes_benz</td>
      <td>no</td>
    </tr>
    <tr>
      <th>313161</th>
      <td>other</td>
      <td>2000</td>
      <td>manual</td>
      <td>105</td>
      <td>100000</td>
      <td>petrol</td>
      <td>fiat</td>
      <td>unknown</td>
    </tr>
    <tr>
      <th>263346</th>
      <td>bus</td>
      <td>2002</td>
      <td>manual</td>
      <td>147</td>
      <td>150000</td>
      <td>petrol</td>
      <td>opel</td>
      <td>no</td>
    </tr>
    <tr>
      <th>126860</th>
      <td>sedan</td>
      <td>1998</td>
      <td>manual</td>
      <td>101</td>
      <td>150000</td>
      <td>other</td>
      <td>volkswagen</td>
      <td>no</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>69954</th>
      <td>sedan</td>
      <td>1991</td>
      <td>manual</td>
      <td>105</td>
      <td>150000</td>
      <td>other</td>
      <td>opel</td>
      <td>no</td>
    </tr>
    <tr>
      <th>278609</th>
      <td>coupe</td>
      <td>1999</td>
      <td>manual</td>
      <td>150</td>
      <td>150000</td>
      <td>petrol</td>
      <td>bmw</td>
      <td>no</td>
    </tr>
    <tr>
      <th>3433</th>
      <td>sedan</td>
      <td>2004</td>
      <td>manual</td>
      <td>105</td>
      <td>125000</td>
      <td>petrol</td>
      <td>seat</td>
      <td>no</td>
    </tr>
    <tr>
      <th>43224</th>
      <td>sedan</td>
      <td>1994</td>
      <td>manual</td>
      <td>136</td>
      <td>125000</td>
      <td>petrol</td>
      <td>mercedes_benz</td>
      <td>no</td>
    </tr>
    <tr>
      <th>86464</th>
      <td>small</td>
      <td>2006</td>
      <td>manual</td>
      <td>64</td>
      <td>70000</td>
      <td>petrol</td>
      <td>volkswagen</td>
      <td>no</td>
    </tr>
  </tbody>
</table>
<p>47024 rows × 8 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">target_train</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>159639    6600
34735     8900
313161    1500
263346    2100
126860    1500
          ... 
69954      800
278609    3000
3433      3750
43224     1111
86464     5300
Name: price, Length: 47024, dtype: int64
</pre></div>
</div>
</div>
</div>
</section>
<section id="scaling">
<h3>Scaling<a class="headerlink" href="#scaling" title="Link to this heading">#</a></h3>
<p>We will scale the motor power values, as well as time in seconds, if used.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">scaler</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features_train</span><span class="p">[[</span><span class="s1">&#39;power&#39;</span><span class="p">,</span> <span class="s1">&#39;seconds&#39;</span><span class="p">]])</span>
    <span class="n">features_train</span><span class="p">[[</span><span class="s1">&#39;power&#39;</span><span class="p">,</span> <span class="s1">&#39;seconds&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
        <span class="n">features_train</span><span class="p">[[</span><span class="s1">&#39;power&#39;</span><span class="p">,</span> <span class="s1">&#39;seconds&#39;</span><span class="p">]])</span>
    <span class="n">features_valid</span><span class="p">[[</span><span class="s1">&#39;power&#39;</span><span class="p">,</span> <span class="s1">&#39;seconds&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
        <span class="n">features_valid</span><span class="p">[[</span><span class="s1">&#39;power&#39;</span><span class="p">,</span> <span class="s1">&#39;seconds&#39;</span><span class="p">]])</span>
    <span class="n">features_test</span><span class="p">[[</span><span class="s1">&#39;power&#39;</span><span class="p">,</span> <span class="s1">&#39;seconds&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
        <span class="n">features_test</span><span class="p">[[</span><span class="s1">&#39;power&#39;</span><span class="p">,</span> <span class="s1">&#39;seconds&#39;</span><span class="p">]])</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">scaler</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features_train</span><span class="p">[[</span><span class="s1">&#39;power&#39;</span><span class="p">]])</span>
    <span class="n">features_train</span><span class="p">[</span><span class="s1">&#39;power&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">features_train</span><span class="p">[[</span><span class="s1">&#39;power&#39;</span><span class="p">]])</span>
    <span class="n">features_valid</span><span class="p">[</span><span class="s1">&#39;power&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">features_valid</span><span class="p">[[</span><span class="s1">&#39;power&#39;</span><span class="p">]])</span>
    <span class="n">features_test</span><span class="p">[</span><span class="s1">&#39;power&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">features_test</span><span class="p">[[</span><span class="s1">&#39;power&#39;</span><span class="p">]])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features_train</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>vehicle_type</th>
      <th>year</th>
      <th>gearbox</th>
      <th>power</th>
      <th>km</th>
      <th>fuel_type</th>
      <th>brand</th>
      <th>repaired</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>159639</th>
      <td>wagon</td>
      <td>2005</td>
      <td>auto</td>
      <td>0.406812</td>
      <td>150000</td>
      <td>gasoline</td>
      <td>audi</td>
      <td>no</td>
    </tr>
    <tr>
      <th>34735</th>
      <td>sedan</td>
      <td>2003</td>
      <td>manual</td>
      <td>0.605208</td>
      <td>90000</td>
      <td>gasoline</td>
      <td>mercedes_benz</td>
      <td>no</td>
    </tr>
    <tr>
      <th>313161</th>
      <td>other</td>
      <td>2000</td>
      <td>manual</td>
      <td>-0.287575</td>
      <td>100000</td>
      <td>petrol</td>
      <td>fiat</td>
      <td>unknown</td>
    </tr>
    <tr>
      <th>263346</th>
      <td>bus</td>
      <td>2002</td>
      <td>manual</td>
      <td>0.545689</td>
      <td>150000</td>
      <td>petrol</td>
      <td>opel</td>
      <td>no</td>
    </tr>
    <tr>
      <th>126860</th>
      <td>sedan</td>
      <td>1998</td>
      <td>manual</td>
      <td>-0.366933</td>
      <td>150000</td>
      <td>other</td>
      <td>volkswagen</td>
      <td>no</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>69954</th>
      <td>sedan</td>
      <td>1991</td>
      <td>manual</td>
      <td>-0.287575</td>
      <td>150000</td>
      <td>other</td>
      <td>opel</td>
      <td>no</td>
    </tr>
    <tr>
      <th>278609</th>
      <td>coupe</td>
      <td>1999</td>
      <td>manual</td>
      <td>0.605208</td>
      <td>150000</td>
      <td>petrol</td>
      <td>bmw</td>
      <td>no</td>
    </tr>
    <tr>
      <th>3433</th>
      <td>sedan</td>
      <td>2004</td>
      <td>manual</td>
      <td>-0.287575</td>
      <td>125000</td>
      <td>petrol</td>
      <td>seat</td>
      <td>no</td>
    </tr>
    <tr>
      <th>43224</th>
      <td>sedan</td>
      <td>1994</td>
      <td>manual</td>
      <td>0.327453</td>
      <td>125000</td>
      <td>petrol</td>
      <td>mercedes_benz</td>
      <td>no</td>
    </tr>
    <tr>
      <th>86464</th>
      <td>small</td>
      <td>2006</td>
      <td>manual</td>
      <td>-1.100999</td>
      <td>70000</td>
      <td>petrol</td>
      <td>volkswagen</td>
      <td>no</td>
    </tr>
  </tbody>
</table>
<p>47024 rows × 8 columns</p>
</div></div></div>
</div>
</section>
<section id="samples-with-one-hot-encoding">
<h3>Samples with one-hot encoding<a class="headerlink" href="#samples-with-one-hot-encoding" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features_train</span><span class="p">[[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;km&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">features_train</span><span class="p">[[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;km&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">features_valid</span><span class="p">[[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;km&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">features_valid</span><span class="p">[[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;km&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">features_test</span><span class="p">[[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;km&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">features_test</span><span class="p">[[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;km&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features_valid</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>vehicle_type</th>
      <th>year</th>
      <th>gearbox</th>
      <th>power</th>
      <th>km</th>
      <th>fuel_type</th>
      <th>brand</th>
      <th>repaired</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>304403</th>
      <td>other</td>
      <td>2012</td>
      <td>manual</td>
      <td>-0.188377</td>
      <td>40000</td>
      <td>petrol</td>
      <td>kia</td>
      <td>unknown</td>
    </tr>
    <tr>
      <th>104873</th>
      <td>other</td>
      <td>2016</td>
      <td>manual</td>
      <td>-0.287575</td>
      <td>150000</td>
      <td>petrol</td>
      <td>opel</td>
      <td>unknown</td>
    </tr>
    <tr>
      <th>270484</th>
      <td>small</td>
      <td>2005</td>
      <td>manual</td>
      <td>-1.180358</td>
      <td>125000</td>
      <td>petrol</td>
      <td>ford</td>
      <td>no</td>
    </tr>
    <tr>
      <th>198191</th>
      <td>small</td>
      <td>1998</td>
      <td>manual</td>
      <td>-0.664528</td>
      <td>150000</td>
      <td>petrol</td>
      <td>toyota</td>
      <td>no</td>
    </tr>
    <tr>
      <th>32356</th>
      <td>small</td>
      <td>2012</td>
      <td>manual</td>
      <td>0.049699</td>
      <td>20000</td>
      <td>petrol</td>
      <td>mini</td>
      <td>no</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>16674</th>
      <td>sedan</td>
      <td>1992</td>
      <td>manual</td>
      <td>1.081359</td>
      <td>150000</td>
      <td>petrol</td>
      <td>audi</td>
      <td>no</td>
    </tr>
    <tr>
      <th>110158</th>
      <td>small</td>
      <td>2002</td>
      <td>manual</td>
      <td>-0.882763</td>
      <td>80000</td>
      <td>petrol</td>
      <td>opel</td>
      <td>no</td>
    </tr>
    <tr>
      <th>227995</th>
      <td>wagon</td>
      <td>2012</td>
      <td>manual</td>
      <td>-0.545490</td>
      <td>60000</td>
      <td>gasoline</td>
      <td>peugeot</td>
      <td>no</td>
    </tr>
    <tr>
      <th>130757</th>
      <td>wagon</td>
      <td>2012</td>
      <td>auto</td>
      <td>0.406812</td>
      <td>150000</td>
      <td>gasoline</td>
      <td>volkswagen</td>
      <td>no</td>
    </tr>
    <tr>
      <th>47062</th>
      <td>wagon</td>
      <td>2006</td>
      <td>auto</td>
      <td>1.002000</td>
      <td>150000</td>
      <td>gasoline</td>
      <td>volkswagen</td>
      <td>no</td>
    </tr>
  </tbody>
</table>
<p>15675 rows × 8 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features_train_ohe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">features_train</span><span class="p">,</span> <span class="n">drop_first</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                                    <span class="n">columns</span><span class="o">=</span><span class="n">features_train</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;power&#39;</span><span class="p">))</span>
<span class="n">features_valid_ohe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">features_valid</span><span class="p">,</span> <span class="n">drop_first</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                                    <span class="n">columns</span><span class="o">=</span><span class="n">features_valid</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;power&#39;</span><span class="p">))</span>
<span class="n">features_test_ohe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">features_test</span><span class="p">,</span> <span class="n">drop_first</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                                    <span class="n">columns</span><span class="o">=</span><span class="n">features_test</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;power&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features_train_ohe</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>power</th>
      <th>vehicle_type_convertible</th>
      <th>vehicle_type_coupe</th>
      <th>vehicle_type_other</th>
      <th>vehicle_type_sedan</th>
      <th>vehicle_type_small</th>
      <th>vehicle_type_suv</th>
      <th>vehicle_type_wagon</th>
      <th>year_1953</th>
      <th>year_1955</th>
      <th>...</th>
      <th>brand_smart</th>
      <th>brand_sonstige_autos</th>
      <th>brand_subaru</th>
      <th>brand_suzuki</th>
      <th>brand_toyota</th>
      <th>brand_trabant</th>
      <th>brand_volkswagen</th>
      <th>brand_volvo</th>
      <th>repaired_unknown</th>
      <th>repaired_yes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>159639</th>
      <td>0.406812</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>34735</th>
      <td>0.605208</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>313161</th>
      <td>-0.287575</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>263346</th>
      <td>0.545689</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>126860</th>
      <td>-0.366933</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>69954</th>
      <td>-0.287575</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>278609</th>
      <td>0.605208</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3433</th>
      <td>-0.287575</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>43224</th>
      <td>0.327453</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>86464</th>
      <td>-1.100999</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>47024 rows × 132 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features_valid_ohe</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>power</th>
      <th>vehicle_type_convertible</th>
      <th>vehicle_type_coupe</th>
      <th>vehicle_type_other</th>
      <th>vehicle_type_sedan</th>
      <th>vehicle_type_small</th>
      <th>vehicle_type_suv</th>
      <th>vehicle_type_wagon</th>
      <th>year_1955</th>
      <th>year_1958</th>
      <th>...</th>
      <th>brand_smart</th>
      <th>brand_sonstige_autos</th>
      <th>brand_subaru</th>
      <th>brand_suzuki</th>
      <th>brand_toyota</th>
      <th>brand_trabant</th>
      <th>brand_volkswagen</th>
      <th>brand_volvo</th>
      <th>repaired_unknown</th>
      <th>repaired_yes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>304403</th>
      <td>-0.188377</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>104873</th>
      <td>-0.287575</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>270484</th>
      <td>-1.180358</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>198191</th>
      <td>-0.664528</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>32356</th>
      <td>0.049699</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>16674</th>
      <td>1.081359</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>110158</th>
      <td>-0.882763</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>227995</th>
      <td>-0.545490</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>130757</th>
      <td>0.406812</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>47062</th>
      <td>1.002000</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>15675 rows × 128 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">common_columns</span> <span class="o">=</span> <span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">features_train_ohe</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">&amp;</span> 
                  <span class="nb">set</span><span class="p">(</span><span class="n">features_valid_ohe</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">&amp;</span> 
                  <span class="nb">set</span><span class="p">(</span><span class="n">features_test_ohe</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
<span class="nb">len</span><span class="p">(</span><span class="n">common_columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>126
</pre></div>
</div>
</div>
</div>
<p>The number of columns is different because not all unique values may be in the test sample, for example.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features_train_ohe</span> <span class="o">=</span> <span class="n">features_train_ohe</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">common_columns</span><span class="p">)]</span>
<span class="n">features_valid_ohe</span> <span class="o">=</span> <span class="n">features_valid_ohe</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">common_columns</span><span class="p">)]</span>
<span class="n">features_test_ohe</span> <span class="o">=</span> <span class="n">features_test_ohe</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">common_columns</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features_train_ohe</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(47024, 126)
</pre></div>
</div>
</div>
</div>
</section>
<section id="samples-with-ordinal-encoding">
<h3>Samples with ordinal encoding<a class="headerlink" href="#samples-with-ordinal-encoding" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features_train</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>vehicle_type</th>
      <th>year</th>
      <th>gearbox</th>
      <th>power</th>
      <th>km</th>
      <th>fuel_type</th>
      <th>brand</th>
      <th>repaired</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>159639</th>
      <td>wagon</td>
      <td>2005</td>
      <td>auto</td>
      <td>0.406812</td>
      <td>150000</td>
      <td>gasoline</td>
      <td>audi</td>
      <td>no</td>
    </tr>
    <tr>
      <th>34735</th>
      <td>sedan</td>
      <td>2003</td>
      <td>manual</td>
      <td>0.605208</td>
      <td>90000</td>
      <td>gasoline</td>
      <td>mercedes_benz</td>
      <td>no</td>
    </tr>
    <tr>
      <th>313161</th>
      <td>other</td>
      <td>2000</td>
      <td>manual</td>
      <td>-0.287575</td>
      <td>100000</td>
      <td>petrol</td>
      <td>fiat</td>
      <td>unknown</td>
    </tr>
    <tr>
      <th>263346</th>
      <td>bus</td>
      <td>2002</td>
      <td>manual</td>
      <td>0.545689</td>
      <td>150000</td>
      <td>petrol</td>
      <td>opel</td>
      <td>no</td>
    </tr>
    <tr>
      <th>126860</th>
      <td>sedan</td>
      <td>1998</td>
      <td>manual</td>
      <td>-0.366933</td>
      <td>150000</td>
      <td>other</td>
      <td>volkswagen</td>
      <td>no</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>69954</th>
      <td>sedan</td>
      <td>1991</td>
      <td>manual</td>
      <td>-0.287575</td>
      <td>150000</td>
      <td>other</td>
      <td>opel</td>
      <td>no</td>
    </tr>
    <tr>
      <th>278609</th>
      <td>coupe</td>
      <td>1999</td>
      <td>manual</td>
      <td>0.605208</td>
      <td>150000</td>
      <td>petrol</td>
      <td>bmw</td>
      <td>no</td>
    </tr>
    <tr>
      <th>3433</th>
      <td>sedan</td>
      <td>2004</td>
      <td>manual</td>
      <td>-0.287575</td>
      <td>125000</td>
      <td>petrol</td>
      <td>seat</td>
      <td>no</td>
    </tr>
    <tr>
      <th>43224</th>
      <td>sedan</td>
      <td>1994</td>
      <td>manual</td>
      <td>0.327453</td>
      <td>125000</td>
      <td>petrol</td>
      <td>mercedes_benz</td>
      <td>no</td>
    </tr>
    <tr>
      <th>86464</th>
      <td>small</td>
      <td>2006</td>
      <td>manual</td>
      <td>-1.100999</td>
      <td>70000</td>
      <td>petrol</td>
      <td>volkswagen</td>
      <td>no</td>
    </tr>
  </tbody>
</table>
<p>47024 rows × 8 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">encoder</span> <span class="o">=</span> <span class="n">OrdinalEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s1">&#39;use_encoded_value&#39;</span><span class="p">,</span> <span class="n">unknown_value</span><span class="o">=</span><span class="mi">999</span><span class="p">)</span>
<span class="n">cat_features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;power&#39;</span><span class="p">))</span>
<span class="n">encoder</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features_train</span><span class="p">[</span><span class="n">cat_features</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OrdinalEncoder(handle_unknown=&#39;use_encoded_value&#39;, unknown_value=999)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features_train_ord</span> <span class="o">=</span> <span class="n">features_train</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">features_valid_ord</span> <span class="o">=</span> <span class="n">features_valid</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">features_test_ord</span> <span class="o">=</span> <span class="n">features_test</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">features_train_ord</span><span class="p">[</span><span class="n">cat_features</span><span class="p">]</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">features_train_ord</span><span class="p">[</span><span class="n">cat_features</span><span class="p">])</span>
<span class="n">features_valid_ord</span><span class="p">[</span><span class="n">cat_features</span><span class="p">]</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">features_valid_ord</span><span class="p">[</span><span class="n">cat_features</span><span class="p">])</span>
<span class="n">features_test_ord</span><span class="p">[</span><span class="n">cat_features</span><span class="p">]</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">features_test_ord</span><span class="p">[</span><span class="n">cat_features</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features_train_ord</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>vehicle_type</th>
      <th>year</th>
      <th>gearbox</th>
      <th>power</th>
      <th>km</th>
      <th>fuel_type</th>
      <th>brand</th>
      <th>repaired</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>159639</th>
      <td>7.0</td>
      <td>52.0</td>
      <td>0.0</td>
      <td>0.406812</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>34735</th>
      <td>4.0</td>
      <td>50.0</td>
      <td>1.0</td>
      <td>0.605208</td>
      <td>12.0</td>
      <td>2.0</td>
      <td>20.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>313161</th>
      <td>3.0</td>
      <td>47.0</td>
      <td>1.0</td>
      <td>-0.287575</td>
      <td>1.0</td>
      <td>6.0</td>
      <td>9.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>263346</th>
      <td>0.0</td>
      <td>49.0</td>
      <td>1.0</td>
      <td>0.545689</td>
      <td>3.0</td>
      <td>6.0</td>
      <td>24.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>126860</th>
      <td>4.0</td>
      <td>45.0</td>
      <td>1.0</td>
      <td>-0.366933</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>38.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>69954</th>
      <td>4.0</td>
      <td>38.0</td>
      <td>1.0</td>
      <td>-0.287575</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>24.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>278609</th>
      <td>2.0</td>
      <td>46.0</td>
      <td>1.0</td>
      <td>0.605208</td>
      <td>3.0</td>
      <td>6.0</td>
      <td>2.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3433</th>
      <td>4.0</td>
      <td>51.0</td>
      <td>1.0</td>
      <td>-0.287575</td>
      <td>2.0</td>
      <td>6.0</td>
      <td>30.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>43224</th>
      <td>4.0</td>
      <td>41.0</td>
      <td>1.0</td>
      <td>0.327453</td>
      <td>2.0</td>
      <td>6.0</td>
      <td>20.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>86464</th>
      <td>5.0</td>
      <td>53.0</td>
      <td>1.0</td>
      <td>-1.100999</td>
      <td>10.0</td>
      <td>6.0</td>
      <td>38.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>47024 rows × 8 columns</p>
</div></div></div>
</div>
</section>
</section>
<section id="training">
<h2>Training<a class="headerlink" href="#training" title="Link to this heading">#</a></h2>
<p>Let’s try linear regression, random forest, LightGBM, CatBoost and XGBoost.</p>
<section id="linear-regression">
<h3>Linear regression<a class="headerlink" href="#linear-regression" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features_train_ohe</span><span class="p">,</span> <span class="n">target_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 705 ms, sys: 172 ms, total: 877 ms
Wall time: 293 ms
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LinearRegression()
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">features_valid_ohe</span><span class="p">)</span>
<span class="n">mse</span><span class="p">(</span><span class="n">target_valid</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 61.2 ms, sys: 6.02 ms, total: 67.2 ms
Wall time: 15.9 ms
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2181.4096215147615
</pre></div>
</div>
</div>
</div>
</section>
<section id="random-forest">
<h3>Random forest<a class="headerlink" href="#random-forest" title="Link to this heading">#</a></h3>
<p>For decision trees, we will use ordinal encoded samples.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">grid_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">300</span><span class="p">],</span> 
               <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">]}</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">57</span><span class="p">),</span> 
                     <span class="n">param_grid</span><span class="o">=</span><span class="n">grid_params</span><span class="p">,</span> 
                     <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_squared_error&#39;</span><span class="p">)</span>

<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features_train_ord</span><span class="p">,</span> <span class="n">target_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;max_depth&#39;: 9, &#39;n_estimators&#39;: 300}
CPU times: user 5min 6s, sys: 195 ms, total: 5min 6s
Wall time: 5min 6s
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">57</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features_train_ord</span><span class="p">,</span> <span class="n">target_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 19.4 s, sys: 2.87 ms, total: 19.4 s
Wall time: 19.4 s
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RandomForestRegressor(max_depth=9, n_estimators=300, random_state=57)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">features_valid_ord</span><span class="p">)</span>
<span class="n">mse</span><span class="p">(</span><span class="n">target_valid</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 498 ms, sys: 2.01 ms, total: 500 ms
Wall time: 497 ms
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2006.486230433868
</pre></div>
</div>
</div>
</div>
</section>
<section id="lightgbm">
<h3>LightGBM<a class="headerlink" href="#lightgbm" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">params_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span> 
               <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">200</span><span class="p">],</span> 
               <span class="s1">&#39;colsample_bytree&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]}</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">lgb</span><span class="o">.</span><span class="n">LGBMRegressor</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="s1">&#39;regression&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">57</span><span class="p">),</span> 
                     <span class="n">param_grid</span><span class="o">=</span><span class="n">params_grid</span><span class="p">,</span> 
                     <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_squared_error&#39;</span><span class="p">)</span>

<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features_train_ohe</span><span class="p">,</span> <span class="n">target_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;colsample_bytree&#39;: 1.0, &#39;learning_rate&#39;: 0.2, &#39;n_estimators&#39;: 200}
CPU times: user 16min 34s, sys: 56.5 s, total: 17min 30s
Wall time: 2min 21s
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">lgb</span><span class="o">.</span><span class="n">LGBMRegressor</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="s1">&#39;regression&#39;</span><span class="p">,</span> 
                          <span class="n">colsample_bytree</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> 
                          <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> 
                          <span class="n">n_estimators</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
                          <span class="n">random_state</span><span class="o">=</span><span class="mi">57</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features_train_ohe</span><span class="p">,</span> <span class="n">target_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 7.51 s, sys: 401 ms, total: 7.91 s
Wall time: 1.03 s
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LGBMRegressor(learning_rate=0.2, n_estimators=200, objective=&#39;regression&#39;,
              random_state=57)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">features_valid_ohe</span><span class="p">)</span>
<span class="n">mse</span><span class="p">(</span><span class="n">target_valid</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 1.1 s, sys: 58.8 ms, total: 1.16 s
Wall time: 158 ms
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1782.2125817272529
</pre></div>
</div>
</div>
</div>
<p>Let’s also try to train with categories.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features_train</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>vehicle_type</th>
      <th>year</th>
      <th>gearbox</th>
      <th>power</th>
      <th>km</th>
      <th>fuel_type</th>
      <th>brand</th>
      <th>repaired</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>159639</th>
      <td>wagon</td>
      <td>2005</td>
      <td>auto</td>
      <td>0.406812</td>
      <td>150000</td>
      <td>gasoline</td>
      <td>audi</td>
      <td>no</td>
    </tr>
    <tr>
      <th>34735</th>
      <td>sedan</td>
      <td>2003</td>
      <td>manual</td>
      <td>0.605208</td>
      <td>90000</td>
      <td>gasoline</td>
      <td>mercedes_benz</td>
      <td>no</td>
    </tr>
    <tr>
      <th>313161</th>
      <td>other</td>
      <td>2000</td>
      <td>manual</td>
      <td>-0.287575</td>
      <td>100000</td>
      <td>petrol</td>
      <td>fiat</td>
      <td>unknown</td>
    </tr>
    <tr>
      <th>263346</th>
      <td>bus</td>
      <td>2002</td>
      <td>manual</td>
      <td>0.545689</td>
      <td>150000</td>
      <td>petrol</td>
      <td>opel</td>
      <td>no</td>
    </tr>
    <tr>
      <th>126860</th>
      <td>sedan</td>
      <td>1998</td>
      <td>manual</td>
      <td>-0.366933</td>
      <td>150000</td>
      <td>other</td>
      <td>volkswagen</td>
      <td>no</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>69954</th>
      <td>sedan</td>
      <td>1991</td>
      <td>manual</td>
      <td>-0.287575</td>
      <td>150000</td>
      <td>other</td>
      <td>opel</td>
      <td>no</td>
    </tr>
    <tr>
      <th>278609</th>
      <td>coupe</td>
      <td>1999</td>
      <td>manual</td>
      <td>0.605208</td>
      <td>150000</td>
      <td>petrol</td>
      <td>bmw</td>
      <td>no</td>
    </tr>
    <tr>
      <th>3433</th>
      <td>sedan</td>
      <td>2004</td>
      <td>manual</td>
      <td>-0.287575</td>
      <td>125000</td>
      <td>petrol</td>
      <td>seat</td>
      <td>no</td>
    </tr>
    <tr>
      <th>43224</th>
      <td>sedan</td>
      <td>1994</td>
      <td>manual</td>
      <td>0.327453</td>
      <td>125000</td>
      <td>petrol</td>
      <td>mercedes_benz</td>
      <td>no</td>
    </tr>
    <tr>
      <th>86464</th>
      <td>small</td>
      <td>2006</td>
      <td>manual</td>
      <td>-1.100999</td>
      <td>70000</td>
      <td>petrol</td>
      <td>volkswagen</td>
      <td>no</td>
    </tr>
  </tbody>
</table>
<p>47024 rows × 8 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features_train_cat</span> <span class="o">=</span> <span class="n">features_train</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">features_valid_cat</span> <span class="o">=</span> <span class="n">features_valid</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">features_test_cat</span> <span class="o">=</span> <span class="n">features_test</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">features_train_cat</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">features_train_cat</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span><span class="p">:</span>
        <span class="n">features_train_cat</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">features_train_cat</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">features_valid_cat</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">features_valid_cat</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span><span class="p">:</span>
        <span class="n">features_valid_cat</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">features_valid_cat</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">features_test_cat</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">features_test_cat</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span><span class="p">:</span>
        <span class="n">features_test_cat</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">features_test_cat</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features_valid_cat</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>vehicle_type    category
year            category
gearbox         category
power            float64
km              category
fuel_type       category
brand           category
repaired        category
dtype: object
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">params_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span> 
               <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">200</span><span class="p">],</span> 
               <span class="s1">&#39;colsample_bytree&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]}</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">lgb</span><span class="o">.</span><span class="n">LGBMRegressor</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="s1">&#39;regression&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">57</span><span class="p">),</span> 
                     <span class="n">param_grid</span><span class="o">=</span><span class="n">params_grid</span><span class="p">,</span> 
                     <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_squared_error&#39;</span><span class="p">)</span>

<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features_train_cat</span><span class="p">,</span> <span class="n">target_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;colsample_bytree&#39;: 1.0, &#39;learning_rate&#39;: 0.1, &#39;n_estimators&#39;: 200}
CPU times: user 17min 16s, sys: 57.9 s, total: 18min 14s
Wall time: 2min 30s
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">lgb</span><span class="o">.</span><span class="n">LGBMRegressor</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="s1">&#39;regression&#39;</span><span class="p">,</span> 
                          <span class="n">colsample_bytree</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> 
                          <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> 
                          <span class="n">n_estimators</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
                          <span class="n">random_state</span><span class="o">=</span><span class="mi">57</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features_train_cat</span><span class="p">,</span> <span class="n">target_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 5.58 s, sys: 210 ms, total: 5.79 s
Wall time: 744 ms
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LGBMRegressor(n_estimators=200, objective=&#39;regression&#39;, random_state=57)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">features_valid_cat</span><span class="p">)</span>
<span class="n">mse</span><span class="p">(</span><span class="n">target_valid</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 1.45 s, sys: 51.9 ms, total: 1.5 s
Wall time: 199 ms
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1715.9009475795185
</pre></div>
</div>
</div>
</div>
<p>That worked out a little better.</p>
</section>
<section id="catboost">
<h3>CatBoost<a class="headerlink" href="#catboost" title="Link to this heading">#</a></h3>
<p>Let’s try CatBoost regression now.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features_train</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>vehicle_type</th>
      <th>year</th>
      <th>gearbox</th>
      <th>power</th>
      <th>km</th>
      <th>fuel_type</th>
      <th>brand</th>
      <th>repaired</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>159639</th>
      <td>wagon</td>
      <td>2005</td>
      <td>auto</td>
      <td>0.406812</td>
      <td>150000</td>
      <td>gasoline</td>
      <td>audi</td>
      <td>no</td>
    </tr>
    <tr>
      <th>34735</th>
      <td>sedan</td>
      <td>2003</td>
      <td>manual</td>
      <td>0.605208</td>
      <td>90000</td>
      <td>gasoline</td>
      <td>mercedes_benz</td>
      <td>no</td>
    </tr>
    <tr>
      <th>313161</th>
      <td>other</td>
      <td>2000</td>
      <td>manual</td>
      <td>-0.287575</td>
      <td>100000</td>
      <td>petrol</td>
      <td>fiat</td>
      <td>unknown</td>
    </tr>
    <tr>
      <th>263346</th>
      <td>bus</td>
      <td>2002</td>
      <td>manual</td>
      <td>0.545689</td>
      <td>150000</td>
      <td>petrol</td>
      <td>opel</td>
      <td>no</td>
    </tr>
    <tr>
      <th>126860</th>
      <td>sedan</td>
      <td>1998</td>
      <td>manual</td>
      <td>-0.366933</td>
      <td>150000</td>
      <td>other</td>
      <td>volkswagen</td>
      <td>no</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>69954</th>
      <td>sedan</td>
      <td>1991</td>
      <td>manual</td>
      <td>-0.287575</td>
      <td>150000</td>
      <td>other</td>
      <td>opel</td>
      <td>no</td>
    </tr>
    <tr>
      <th>278609</th>
      <td>coupe</td>
      <td>1999</td>
      <td>manual</td>
      <td>0.605208</td>
      <td>150000</td>
      <td>petrol</td>
      <td>bmw</td>
      <td>no</td>
    </tr>
    <tr>
      <th>3433</th>
      <td>sedan</td>
      <td>2004</td>
      <td>manual</td>
      <td>-0.287575</td>
      <td>125000</td>
      <td>petrol</td>
      <td>seat</td>
      <td>no</td>
    </tr>
    <tr>
      <th>43224</th>
      <td>sedan</td>
      <td>1994</td>
      <td>manual</td>
      <td>0.327453</td>
      <td>125000</td>
      <td>petrol</td>
      <td>mercedes_benz</td>
      <td>no</td>
    </tr>
    <tr>
      <th>86464</th>
      <td>small</td>
      <td>2006</td>
      <td>manual</td>
      <td>-1.100999</td>
      <td>70000</td>
      <td>petrol</td>
      <td>volkswagen</td>
      <td>no</td>
    </tr>
  </tbody>
</table>
<p>47024 rows × 8 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cat_features</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;vehicle_type&#39;, &#39;year&#39;, &#39;gearbox&#39;, &#39;km&#39;, &#39;fuel_type&#39;, &#39;brand&#39;, &#39;repaired&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">CatBoostRegressor</span><span class="p">(</span><span class="n">loss_function</span><span class="o">=</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="n">cat_features</span><span class="o">=</span><span class="n">cat_features</span><span class="p">,</span> <span class="n">logging_level</span><span class="o">=</span><span class="s1">&#39;Silent&#39;</span><span class="p">)</span>
<span class="n">grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;iterations&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">300</span><span class="p">],</span>
        <span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span>
        <span class="s1">&#39;depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">]}</span>
<span class="n">model</span><span class="o">.</span><span class="n">grid_search</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">features_train</span><span class="p">,</span> <span class="n">target_train</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">get_params</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;loss_function&#39;: &#39;RMSE&#39;, &#39;logging_level&#39;: &#39;Silent&#39;, &#39;cat_features&#39;: [&#39;vehicle_type&#39;, &#39;year&#39;, &#39;gearbox&#39;, &#39;km&#39;, &#39;fuel_type&#39;, &#39;brand&#39;, &#39;repaired&#39;], &#39;depth&#39;: 8, &#39;iterations&#39;: 300, &#39;learning_rate&#39;: 0.1}
CPU times: user 38min 45s, sys: 4min 54s, total: 43min 40s
Wall time: 6min 39s
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">CatBoostRegressor</span><span class="p">(</span><span class="n">loss_function</span><span class="o">=</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> 
                          <span class="n">depth</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> 
                          <span class="n">iterations</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> 
                          <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> 
                          <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                          <span class="n">cat_features</span><span class="o">=</span><span class="n">cat_features</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features_train</span><span class="p">,</span> <span class="n">target_train</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 1min 55s, sys: 13.4 s, total: 2min 9s
Wall time: 21.2 s
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;catboost.core.CatBoostRegressor at 0x7327db366df0&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">features_valid</span><span class="p">)</span>
<span class="n">rmse</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mse</span><span class="p">(</span><span class="n">target_valid</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rmse</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 1730.46
CPU times: user 191 ms, sys: 30 ms, total: 221 ms
Wall time: 61.4 ms
</pre></div>
</div>
</div>
</div>
</section>
<section id="xgboost">
<h3>XGBoost<a class="headerlink" href="#xgboost" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> 
          <span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span> 
          <span class="s1">&#39;colsample_bytree&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">]}</span>

<span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">xgboost</span><span class="o">.</span><span class="n">XGBRegressor</span><span class="p">(),</span> 
                           <span class="n">param_grid</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> 
                           <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_squared_error&#39;</span><span class="p">)</span>

<span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features_train_ohe</span><span class="p">,</span> <span class="n">target_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;colsample_bytree&#39;: 0.5, &#39;learning_rate&#39;: 0.1, &#39;max_depth&#39;: 7}
CPU times: user 2h 11min 59s, sys: 5min 13s, total: 2h 17min 13s
Wall time: 18min 40s
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">xgboost</span><span class="o">.</span><span class="n">XGBRegressor</span><span class="p">(</span><span class="n">colsample_bytree</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> 
                             <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> 
                             <span class="n">max_depth</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> 
                             <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features_train_ohe</span><span class="p">,</span> <span class="n">target_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[13:37:53] WARNING: ../src/learner.cc:767: 
Parameters: { &quot;silent&quot; } are not used.

CPU times: user 1min 30s, sys: 3.98 s, total: 1min 34s
Wall time: 13.5 s
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>XGBRegressor(base_score=None, booster=None, callbacks=None,
             colsample_bylevel=None, colsample_bynode=None,
             colsample_bytree=0.5, early_stopping_rounds=None,
             enable_categorical=False, eval_metric=None, feature_types=None,
             gamma=None, gpu_id=None, grow_policy=None, importance_type=None,
             interaction_constraints=None, learning_rate=0.1, max_bin=None,
             max_cat_threshold=None, max_cat_to_onehot=None,
             max_delta_step=None, max_depth=7, max_leaves=None,
             min_child_weight=None, missing=nan, monotone_constraints=None,
             n_estimators=100, n_jobs=None, num_parallel_tree=None,
             predictor=None, random_state=None, ...)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">features_valid_ohe</span><span class="p">)</span>
<span class="n">mse</span><span class="p">(</span><span class="n">target_valid</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 533 ms, sys: 35.3 ms, total: 568 ms
Wall time: 84.7 ms
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1887.3826840822685
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="results">
<h2>Results<a class="headerlink" href="#results" title="Link to this heading">#</a></h2>
<p>Thus, we obtain the following table.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Model</p></th>
<th class="head"><p>Hyperparameter selection</p></th>
<th class="head"><p>Training time</p></th>
<th class="head"><p>Prediction time</p></th>
<th class="head"><p>RMSE</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Linear regression</p></td>
<td><p>-</p></td>
<td><p><strong>293</strong> ms</p></td>
<td><p><strong>16</strong> ms</p></td>
<td><p>2181</p></td>
</tr>
<tr class="row-odd"><td><p>Random forest</p></td>
<td><p>5 minutes 6 seconds</p></td>
<td><p>19 seconds</p></td>
<td><p>497 ms</p></td>
<td><p>2006</p></td>
</tr>
<tr class="row-even"><td><p>LightGBM</p></td>
<td><p><strong>2 minutes 30 seconds</strong></p></td>
<td><p>744 ms</p></td>
<td><p>199 ms</p></td>
<td><p><strong>1716</strong></p></td>
</tr>
<tr class="row-odd"><td><p>CatBoost</p></td>
<td><p>6 minutes 39 seconds</p></td>
<td><p>21 seconds</p></td>
<td><p>61 ms</p></td>
<td><p>1730</p></td>
</tr>
<tr class="row-even"><td><p>XGBoost</p></td>
<td><p>18 minutes 40 seconds</p></td>
<td><p>14 seconds</p></td>
<td><p>85 ms</p></td>
<td><p>1887</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="sanity-check">
<h2>Sanity check<a class="headerlink" href="#sanity-check" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">DummyRegressor</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features_train_ohe</span><span class="p">,</span> <span class="n">target_train</span><span class="p">)</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">features_valid_ohe</span><span class="p">)</span>
<span class="n">mse</span><span class="p">(</span><span class="n">target_valid</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 23 ms, sys: 3.94 ms, total: 26.9 ms
Wall time: 5.75 ms
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4586.095252190357
</pre></div>
</div>
</div>
</div>
<p>All of our models pass this minimum.</p>
</section>
<section id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Link to this heading">#</a></h2>
<p>We test LightGBM with parameters ‘colsample_bytree’: 1.0, ‘learning_rate’: 0.1, ‘n_estimators’: 200.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features_test_cat</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>vehicle_type</th>
      <th>year</th>
      <th>gearbox</th>
      <th>power</th>
      <th>km</th>
      <th>fuel_type</th>
      <th>brand</th>
      <th>repaired</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>49749</th>
      <td>wagon</td>
      <td>2006</td>
      <td>manual</td>
      <td>0.406812</td>
      <td>150000</td>
      <td>other</td>
      <td>volkswagen</td>
      <td>no</td>
    </tr>
    <tr>
      <th>161214</th>
      <td>small</td>
      <td>1997</td>
      <td>manual</td>
      <td>-0.882763</td>
      <td>150000</td>
      <td>petrol</td>
      <td>volkswagen</td>
      <td>no</td>
    </tr>
    <tr>
      <th>244831</th>
      <td>wagon</td>
      <td>2008</td>
      <td>manual</td>
      <td>1.180557</td>
      <td>150000</td>
      <td>gasoline</td>
      <td>audi</td>
      <td>no</td>
    </tr>
    <tr>
      <th>211493</th>
      <td>convertible</td>
      <td>2002</td>
      <td>manual</td>
      <td>4.434254</td>
      <td>150000</td>
      <td>petrol</td>
      <td>bmw</td>
      <td>no</td>
    </tr>
    <tr>
      <th>52708</th>
      <td>small</td>
      <td>2003</td>
      <td>manual</td>
      <td>-1.220037</td>
      <td>125000</td>
      <td>petrol</td>
      <td>renault</td>
      <td>no</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>287496</th>
      <td>small</td>
      <td>2010</td>
      <td>auto</td>
      <td>-1.299395</td>
      <td>90000</td>
      <td>gasoline</td>
      <td>smart</td>
      <td>no</td>
    </tr>
    <tr>
      <th>202431</th>
      <td>wagon</td>
      <td>2011</td>
      <td>manual</td>
      <td>-0.069339</td>
      <td>80000</td>
      <td>gasoline</td>
      <td>ford</td>
      <td>no</td>
    </tr>
    <tr>
      <th>236513</th>
      <td>small</td>
      <td>1996</td>
      <td>manual</td>
      <td>-0.585169</td>
      <td>150000</td>
      <td>petrol</td>
      <td>opel</td>
      <td>no</td>
    </tr>
    <tr>
      <th>319004</th>
      <td>wagon</td>
      <td>2003</td>
      <td>auto</td>
      <td>0.863123</td>
      <td>150000</td>
      <td>gasoline</td>
      <td>audi</td>
      <td>no</td>
    </tr>
    <tr>
      <th>27170</th>
      <td>sedan</td>
      <td>2003</td>
      <td>manual</td>
      <td>-0.327254</td>
      <td>150000</td>
      <td>petrol</td>
      <td>fiat</td>
      <td>no</td>
    </tr>
  </tbody>
</table>
<p>15675 rows × 8 columns</p>
</div></div></div>
</div>
<p>We will train on both the training and validation dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features_for_test_training</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">features_train_cat</span><span class="p">,</span> <span class="n">features_valid_cat</span><span class="p">])</span>
<span class="n">target_for_test_training</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">target_train</span><span class="p">,</span> <span class="n">target_valid</span><span class="p">])</span>
<span class="n">features_for_test_training</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>vehicle_type</th>
      <th>year</th>
      <th>gearbox</th>
      <th>power</th>
      <th>km</th>
      <th>fuel_type</th>
      <th>brand</th>
      <th>repaired</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>159639</th>
      <td>wagon</td>
      <td>2005</td>
      <td>auto</td>
      <td>0.406812</td>
      <td>150000</td>
      <td>gasoline</td>
      <td>audi</td>
      <td>no</td>
    </tr>
    <tr>
      <th>34735</th>
      <td>sedan</td>
      <td>2003</td>
      <td>manual</td>
      <td>0.605208</td>
      <td>90000</td>
      <td>gasoline</td>
      <td>mercedes_benz</td>
      <td>no</td>
    </tr>
    <tr>
      <th>313161</th>
      <td>other</td>
      <td>2000</td>
      <td>manual</td>
      <td>-0.287575</td>
      <td>100000</td>
      <td>petrol</td>
      <td>fiat</td>
      <td>unknown</td>
    </tr>
    <tr>
      <th>263346</th>
      <td>bus</td>
      <td>2002</td>
      <td>manual</td>
      <td>0.545689</td>
      <td>150000</td>
      <td>petrol</td>
      <td>opel</td>
      <td>no</td>
    </tr>
    <tr>
      <th>126860</th>
      <td>sedan</td>
      <td>1998</td>
      <td>manual</td>
      <td>-0.366933</td>
      <td>150000</td>
      <td>other</td>
      <td>volkswagen</td>
      <td>no</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>16674</th>
      <td>sedan</td>
      <td>1992</td>
      <td>manual</td>
      <td>1.081359</td>
      <td>150000</td>
      <td>petrol</td>
      <td>audi</td>
      <td>no</td>
    </tr>
    <tr>
      <th>110158</th>
      <td>small</td>
      <td>2002</td>
      <td>manual</td>
      <td>-0.882763</td>
      <td>80000</td>
      <td>petrol</td>
      <td>opel</td>
      <td>no</td>
    </tr>
    <tr>
      <th>227995</th>
      <td>wagon</td>
      <td>2012</td>
      <td>manual</td>
      <td>-0.545490</td>
      <td>60000</td>
      <td>gasoline</td>
      <td>peugeot</td>
      <td>no</td>
    </tr>
    <tr>
      <th>130757</th>
      <td>wagon</td>
      <td>2012</td>
      <td>auto</td>
      <td>0.406812</td>
      <td>150000</td>
      <td>gasoline</td>
      <td>volkswagen</td>
      <td>no</td>
    </tr>
    <tr>
      <th>47062</th>
      <td>wagon</td>
      <td>2006</td>
      <td>auto</td>
      <td>1.002000</td>
      <td>150000</td>
      <td>gasoline</td>
      <td>volkswagen</td>
      <td>no</td>
    </tr>
  </tbody>
</table>
<p>62699 rows × 8 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">target_for_test_training</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(62699,)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features_valid_cat</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>vehicle_type    category
year            category
gearbox         category
power            float64
km              category
fuel_type       category
brand           category
repaired        category
dtype: object
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">features_for_test_training</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">features_for_test_training</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span><span class="p">:</span>
        <span class="n">features_for_test_training</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">features_for_test_training</span><span class="p">[</span><span class="n">column</span><span class="p">]</span>
                                              <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features_for_test_training</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>vehicle_type    category
year            category
gearbox         category
power            float64
km              category
fuel_type       category
brand           category
repaired        category
dtype: object
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">lgb</span><span class="o">.</span><span class="n">LGBMRegressor</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="s1">&#39;regression&#39;</span><span class="p">,</span> 
                          <span class="n">colsample_bytree</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> 
                          <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> 
                          <span class="n">n_estimators</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
                          <span class="n">random_state</span><span class="o">=</span><span class="mi">57</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features_for_test_training</span><span class="p">,</span> <span class="n">target_for_test_training</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 9.29 s, sys: 487 ms, total: 9.78 s
Wall time: 1.33 s
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LGBMRegressor(n_estimators=200, objective=&#39;regression&#39;, random_state=57)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">features_test_cat</span><span class="p">)</span>
<span class="n">mse</span><span class="p">(</span><span class="n">target_test</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 1.51 s, sys: 81 ms, total: 1.59 s
Wall time: 212 ms
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1673.3438690669009
</pre></div>
</div>
</div>
</div>
<p>The result is better than before because of the added validation data.</p>
</section>
<section id="conclusions">
<h2>Conclusions<a class="headerlink" href="#conclusions" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Data Features</p>
<ul class="simple">
<li><p>The table has data on nearly 350 thousand offers during one month in 2016</p></li>
<li><p>All the missing values came from categorical data types and were replaced with objects of unknown category</p></li>
<li><p>There were a few anomalies in the data. Mainly, they were removed, but for too high engine power figures, their order was downgraded.</p></li>
<li><p>Car model, postal code, month of car registration, and dates of downloading the questionnaire and registering the offer have not been used in the training. The rest of the data has.</p></li>
</ul>
</li>
<li><p>Training</p>
<ul class="simple">
<li><p>Before training, original encoding was used for categorical data types and scaling for quantitative data types.</p></li>
<li><p>The models considered were linear regression, random forest, and three boosting models.</p></li>
</ul>
</li>
<li><p>Results</p>
<ul class="simple">
<li><p>All models passed the sanity check.</p></li>
<li><p>The linear regression performed the worst. Its RMSE amounted to 2181.</p></li>
<li><p>The random forest with RMSE 2006 was slightly better.</p></li>
<li><p>The best performing models turned out to be the bousting models. RMSE was 1887, 1730 and 1716 for XGBoost, CatBoost and LightGBM respectively.</p></li>
<li><p>During testing LightGBM showed even higher accuracy - 1673. This may be because the model was trained on a larger amount of data.</p></li>
</ul>
</li>
</ol>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="data_transformation.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Protection of customers’ personal data</p>
      </div>
    </a>
    <a class="right-next"
       href="taxi_time_series.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Taxi orders prediction</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#primary-data-analysis">Primary data analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#qualitative-variables">Qualitative variables</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#vehicle-body-type">Vehicle body type</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#gearbox">Gearbox</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#car-model">Car model</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#month-of-registration">Month of registration</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#fuel-type">Fuel type</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#car-brand">Car brand</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#breakdown-history">Breakdown history</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#postal-code">Postal code</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#quantitative-variables">Quantitative variables</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#price">Price</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-year-of-registration">The year of registration</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#engine-power">Engine power</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#mileage">Mileage</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#number-of-photos">Number of photos</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#price-dynamics">Price dynamics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#duplicates">Duplicates</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preprocessing">Data preprocessing.</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#renaming">Renaming</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#deduplication">Deduplication</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-types">Data types</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#missing-values">Missing values</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#anomalies">Anomalies</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exploratory-data-analysis">Exploratory data analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#period">Period</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Postal code</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Vehicle body type</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#registration-year">Registration year</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Gearbox</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Engine power</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Car model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Mileage</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#month">Month</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Fuel type</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#brand">Brand</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Breakdown history</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#relationship-of-attributes">Relationship of attributes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#samples">Samples</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#features-for-training">Features for training</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#splitting">Splitting</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#scaling">Scaling</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#samples-with-one-hot-encoding">Samples with one-hot encoding</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#samples-with-ordinal-encoding">Samples with ordinal encoding</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#training">Training</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-regression">Linear regression</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#random-forest">Random forest</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lightgbm">LightGBM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#catboost">CatBoost</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#xgboost">XGBoost</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#results">Results</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sanity-check">Sanity check</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing">Testing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusions">Conclusions</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Leonid Dybovskii
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>